# Chapter 28. 테스트 경계

## 시스템 컴포넌트인 테스트

---

- 테스트는 태생적으로 의존성 규칙을 따른다.
    - 테스트는 세부적이며 구체적인 것으로, 의존성은 항상 테스트 대상이 되는 코드를 향한다. 실제로 테스트는 아키텍처에서 가장 바깥쪽 원으로 생각할 수 있다.
        - 시스템 내부의 어떤 것도 테스트에는 의존하지 않음
    - 테스트는 독립적으로 배포 가능하다.
        - 상용 시스템에는 배포하지 않는다.
    - 테스트는 시스템 컴포넌트 중에서 가장 고립되어 있다.
        - 어떤 사용자도 테스트에 의존하지 않는다.

## 테스트를 고려한 설계

---

- 테스트가 지닌 극단적인 고립성이 테스트는 대체로 배포하지 않는다는 사실과 어우러지며, 개발자는 종종 테스트가 시스템의 설계 범위 밖에 있다고 여긴다.
    - 테스트가 시스템의 설계와 잘 통합되지 않으면, 테스트는 깨지기 쉬워지고, 시스템은 뻣뻣해져서 변경하기가 어려워진다.
- 깨지기 쉬운 테스트 문제: 시스템의 공통 컴포넌트가 변경되면 수백, 심지어 수천 개의 테스트가 망가진다.
- 이 문제를 해결하려면 테스트를 고려해서 설계해야 한다.
    - 변동성이 있는 것에 의존하지 말라.

## 테스트 API

---

- 이 목표를 달성하려면 테스트가 모든 업무 규칙을 검증하는 데 사용할 수 있도록 특화된 API를 만들면 된다.
    - 이 API는 사용자 인터페이스가 사용하는 인터랙터(interactor)와 인터페이스 어댑터들의 상위 집합이 될 것이다.
- 테스트 API는 테스트를 애플리케이션으로부터 분리할 목적으로 사용한다.
    - 테스트 구조를 애플리케이션 구조로부터 결합을 분리하는 게 목표

### 구조적 결합

---

- 구조적 결합은 테스트 결합 중에서 가장 강하며, 가장 은밀하게 퍼져 나가는 유형이다.
    - 모든 상용 클래스에 테스트 클래스가 각각 존재하고, 또 모든 상용 메서드에 테스트 메서드 집합이 각각 존재하는 테스트 스위트가 있다 → 애플리케이션 구조에 강하게 결합되어 있다.
- 테스트 API의 역할은 애플리케이션의 구조를 테스트로부터 숨기는 데 있다.
- 따로따로 진화할 수 있다는 점은 필수적
    - 시간이 지날수록 테스트는 계속해서 더 구체적이고 더 특화된 형태로 변할 것이고, 반대로 상용 코드는 더 추상적이고 더 범용적인 형태로 변할 것이기 때문이다.
        - 구조적 결합이 강하면 필수적인 진화 과정을 방해할(또는 지연시킬) 뿐만 아니라, 상용 코드의 범용성과 유연성이 충분히 좋아지지 못하게 막는다.

### 보안

---

- 테스트 API 자체와 테스트 API 중 위험한 부분의 구현부는 독립적으로 배포할 수 있는 컴포넌트로 분리해야 한다.

## 결론

---

- 테스트는 시스템 외부에 있지 않다. 오히려 시스템의 일부다.
    - 테스트를 시스템의 일부로 설계하지 않으면 테스트는 깨지기 쉽고 유지보수하기 어려워지는 경향이 있다.