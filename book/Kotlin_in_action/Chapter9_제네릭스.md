# Chapter 9. μ λ„¤λ¦­μ¤

## 1. μ λ„¤λ¦­ νƒ€μ… νλΌλ―Έν„°

---

- μ½”ν‹€λ¦° μ»΄νμΌλ¬λ” λ³΄ν†µ νƒ€μ…κ³Ό λ§μ°¬κ°€μ§€λ΅ νƒ€μ… μΈμλ„ μ¶”λ΅ ν•  μ μλ‹¤.
    
    ```kotlin
    val authors = listOf("Dmitry", "Svetlana")
    ```
    
- λΉ λ¦¬μ¤νΈλ¥Ό λ§λ“¤μ–΄μ•Ό ν•λ‹¤λ©΄ νƒ€μ… μΈμλ¥Ό μ¶”λ΅ ν•  κ·Όκ±°κ°€ μ—†κΈ° λ•λ¬Έμ— μ§μ ‘ νƒ€μ… μΈμλ¥Ό λ…μ‹ν•΄μ•Ό ν•λ‹¤.
    - λ³€μμ νƒ€μ…μ„ μ§€μ •
        
        ```kotlin
        val readers: MutableList<String> = mutableListOf()
        ```
        
    - λ³€μλ¥Ό λ§λ“λ” ν•¨μμ νƒ€μ… μΈμλ¥Ό μ§€μ •
        
        ```kotlin
        val readers = mutableListOf<String>()
        ```
        
- μλ°”μ™€ λ‹¬λ¦¬ μ½”ν‹€λ¦°μ—μ„λ” μ λ„¤λ¦­ νƒ€μ…μ νƒ€μ… μΈμλ¥Ό ν”„λ΅κ·Έλλ¨Έκ°€ λ…μ‹ν•κ±°λ‚ μ»΄νμΌλ¬κ°€ μ¶”λ΅ ν•  μ μμ–΄μ•Ό ν•λ‹¤.
    - μλ°”λ” λ§¨ μ²μμ— μ λ„¤λ¦­ μ§€μ›μ΄ μ—†μ—κ³  μλ°” 1.5μ— λ’¤λ¦κ² μ λ„¤λ¦­μ„ λ„μ…ν–κΈ° λ•λ¬Έμ— μ΄μ „ λ²„μ „κ³Ό νΈν™μ„±μ„ μ μ§€ν•κΈ° μ„ν•΄ νƒ€μ… μΈμκ°€ μ—†λ” μ λ„¤λ¦­ νƒ€μ…(raw)μ„ ν—μ©ν•λ‹¤.

### 1-1. μ λ„¤λ¦­ ν•¨μμ™€ ν”„λ΅νΌν‹°

---

- λ¦¬μ¤νΈλ¥Ό λ‹¤λ£¨λ” ν•¨μλ¥Ό μ‘μ„±ν•λ‹¤λ©΄ μ–΄λ–¤ νΉμ • νƒ€μ…μ„ μ €μ¥ν•λ” λ¦¬μ¤νΈλΏ μ•„λ‹λΌ λ¨λ“  λ¦¬μ¤νΈλ¥Ό λ‹¤λ£° μ μλ” ν•¨μλ¥Ό μ›ν•  κ²ƒμ΄λ‹¤. μ΄λ΄λ• μ λ„¤λ¦­ ν•¨μλ¥Ό μ‘μ„±ν•΄μ•Ό ν•λ‹¤.
    
    ![9.1 μ λ„¤λ¦­ ν•¨μμΈ `slice`λ” T λ¥Ό νƒ€μ… νλΌλ―Έν„°λ΅ λ°›λ”λ‹¤.](./image/9/Untitled.png)
    
    9.1 μ λ„¤λ¦­ ν•¨μμΈ `slice`λ” T λ¥Ό νƒ€μ… νλΌλ―Έν„°λ΅ λ°›λ”λ‹¤.
    
- μ΄λ° ν•¨μλ¥Ό κµ¬μ²΄μ μΈ λ¦¬μ¤νΈμ— λ€ν•΄ νΈμ¶ν•  λ• νƒ€μ… μΈμλ¥Ό λ…μ‹μ μΌλ΅ μ§€μ •ν•  μ μλ‹¤. ν•μ§€λ§ μ‹¤μ λ΅λ” λ€λ¶€λ¶„ μ»΄νμΌλ¬κ°€ νƒ€μ… μΈμλ¥Ό μ¶”λ΅ ν•  μ μμΌλ―€λ΅ κ·Έλ΄ ν•„μ”κ°€ μ—†λ‹¤.
    
    ```kotlin
    val letters = ('a'..'z').toList()
    
    println(letters.slice<Char>(0..2)) // νƒ€μ… μΈμλ¥Ό λ…μ‹μ μΌλ΅ μ§€μ •ν•λ‹¤.
    println(letters.slice(0..2)) // μ»΄νμΌλ¬λ” μ—¬κΈ°μ„ Tκ°€ CharλΌλ” μ‚¬μ‹¤μ„ μ¶”λ΅ ν•λ‹¤.
    ```
    

### 1-2. μ λ„¤λ¦­ ν΄λμ¤ μ„ μ–Έ

---

- μλ°”μ™€ λ§μ°¬κ°€μ§€λ΅ μ½”ν‹€λ¦°μ—μ„λ„ νƒ€μ… νλΌλ―Έν„°λ¥Ό λ„£μ€ κΊ½μ‡  κΈ°νΈ(<>)λ¥Ό ν΄λμ¤ μ΄λ¦„ λ’¤μ— λ¶™μ΄λ©΄ ν΄λμ¤λ¥Ό μ λ„¤λ¦­ν•κ² λ§λ“¤ μ μλ‹¤. νƒ€μ… νλΌλ―Έν„°λ¥Ό μ΄λ¦„ λ’¤μ— λ¶™μ΄κ³  λ‚λ©΄ ν΄λμ¤ λ³Έλ¬Έ μ•μ—μ„ νƒ€μ… νλΌλ―Έν„°λ¥Ό λ‹¤λ¥Έ μΌλ° νƒ€μ…μ²λΌ μ‚¬μ©ν•  μ μλ‹¤.
    
    ```kotlin
    interface List<T> { // List μΈν„°νμ΄μ¤μ— TλΌλ” νƒ€μ… νλΌλ―Έν„°λ¥Ό μ •μν•λ‹¤.
        operator fun get(index: Int): T // μΈν„°νμ΄μ¤ μ•μ—μ„ Tλ¥Ό μΌλ° νƒ€μ…μ²λΌ μ‚¬μ©ν•  μ μλ‹¤.
    }
    ```
    
- μ λ„¤λ¦­ ν΄λμ¤λ¥Ό ν™•μ¥ν•λ” ν΄λμ¤λ¥Ό μ •μν•λ ¤λ©΄ κΈ°λ° νƒ€μ…μ μ λ„¤λ¦­ νλΌλ―Έν„°μ— λ€ν•΄ νƒ€μ… μΈμλ¥Ό μ§€μ •ν•΄μ•Ό ν•λ‹¤.
    - κµ¬μ²΄μ μΈ νƒ€μ…μ„ λ„κΈΈ μλ„ μκ³  (ν•μ„ ν΄λμ¤λ„ μ λ„¤λ¦­ ν΄λμ¤λΌλ©΄) νƒ€μ… νλΌλ―Έν„°λ΅ λ°›μ€ νƒ€μ…μ„ λ„κΈΈμλ„ μλ‹¤.
    
    ```kotlin
    class StringList: List<String> { // μ΄ ν΄λμ¤λ” κµ¬μ²΄μ μΈ νƒ€μ… μΈμλ΅ String μ„ μ§€μ •ν•΄ List λ¥Ό κµ¬ν„ν•λ‹¤.
        override fun get(index: Int): String = ...
    }
    class ArrayList<T>: List<T> { // ArrayList μ μ λ„¤λ¦­ νƒ€μ… νλΌλ―Έν„° T λ¥Ό List μ νƒ€μ… μΈμλ΅ λ„κΈ΄λ‹¤.
        override fun get(index: Int): T = ...
    }
    ```
    
- ν΄λμ¤κ°€ μκΈ° μμ‹ μ„ νƒ€μ… μΈμλ΅ μ°Έμ΅°ν•  μλ„ μλ‹¤. ex> κµ¬ν„ν•λ” ν΄λμ¤
    - λΉ„κµ κ°€λ¥ν• λ¨λ“  κ°’μ€ μμ‹ μ„ κ°™μ€ νƒ€μ…μ λ‹¤λ¥Έ κ°’κ³Ό λΉ„κµν•λ” λ°©λ²•μ„ μ κ³µν•΄μ•Όλ§ ν•λ‹¤.
    
    ```kotlin
    interface Comparable<T> {
        fun compareTo(other: T): Int
    }
    class String: Comparable<String> {
        override fun compareTo(other: String): Int = /*...*/
    }
    ```
    

### 1-3. νƒ€μ… νλΌλ―Έν„° μ μ•½

---

- νƒ€μ… νλΌλ―Έν„° μ μ•½: ν΄λμ¤λ‚ ν•¨μμ— μ‚¬μ©ν•  μ μλ” νƒ€μ… μΈμλ¥Ό μ ν•ν•λ” κΈ°λ¥
- μ–΄λ–¤ νƒ€μ…μ„ μ λ„¤λ¦­ νƒ€μ…μ νƒ€μ… νλΌλ―Έν„°μ— λ€ν• μƒν•(upper bound)μΌλ΅ μ§€μ •ν•λ©΄ κ·Έ μ λ„¤λ¦­ νƒ€μ…μ„ μΈμ¤ν„΄μ¤ν™”ν•  λ• μ‚¬μ©ν•λ” νƒ€μ… μΈμλ” λ°λ“μ‹ κ·Έ μƒν• νƒ€μ…μ΄κ±°λ‚ κ·Έ μƒν• νƒ€μ…μ ν•μ„ νƒ€μ…μ΄μ–΄μ•Ό ν•λ‹¤.
    - μ μ•½μ„ κ°€ν•λ ¤λ©΄ νƒ€μ… νλΌλ―Έν„° μ΄λ¦„ λ’¤μ— μ½λ΅ (`:`)μ„ ν‘μ‹ν•κ³  κ·Έ λ’¤μ— μƒν• νƒ€μ…μ„ μ μΌλ©΄ λλ‹¤.
    
    ![9.2 νƒ€μ… νλΌλ―Έν„° λ’¤μ— μƒν•μ„ μ§€μ •ν•¨μΌλ΅μ¨ μ μ•½μ„ μ •μν•  μ μλ‹¤.](./image/9/Untitled%201.png)
    
    9.2 νƒ€μ… νλΌλ―Έν„° λ’¤μ— μƒν•μ„ μ§€μ •ν•¨μΌλ΅μ¨ μ μ•½μ„ μ •μν•  μ μλ‹¤.
    
- νƒ€μ… νλΌλ―Έν„° T μ— λ€ν• μƒν•μ„ μ •ν•κ³  λ‚λ©΄ T νƒ€μ…μ κ°’μ„ κ·Έ μƒν• νƒ€μ…μ κ°’μΌλ΅ μ·¨κΈ‰ν•  μ μλ‹¤.
    
    ```kotlin
    fun <T : Number> oneHalf(value: T): Double { // Numberλ¥Ό νƒ€μ… νλΌλ―Έν„° μƒν•μΌλ΅ μ •ν•λ‹¤. 
        return value.toDouble() / 2.0 // Number ν΄λμ¤μ— μ •μλ λ©”μ†λ“λ¥Ό νΈμ¶ν•λ‹¤. 
    }
    >>> println(oneHalf(3)) // 1.5
    ```
    
- νƒ€μ… νλΌλ―Έν„°μ— μ—¬λ¬ μ μ•½μ„ κ°€ν•κΈ°
    
    ```kotlin
    fun <T> ensureTrailingPeriod(seq: T) where T : CharSequence, T : Appendable { // νƒ€μ… νλΌλ―Έν„° μ μ•½ λ©λ΅
        if (!seq.endsWith('.')) { // CharSequence μΈν„°νμ΄μ¤μ ν™•μ¥ ν•¨μλ¥Ό νΈμ¶
            seq.append('.') // Appendable μΈν„°νμ΄μ¤μ λ©”μ†λ“λ¥Ό νΈμ¶
        }
    }
    
    fun main() {
        val helloWorld = StringBuilder("Hello World")
        ensureTrailingPeriod(helloWorld)
        println(helloWorld) // Hello World.
    }
    ```
    
    β†’ νƒ€μ… μΈμκ°€ `CharSequence`μ™€ `Appendable` μΈν„°νμ΄μ¤λ¥Ό λ°λ“μ‹ κµ¬ν„ν•΄μ•Ό ν•λ‹¤.
    

### 1-4. νƒ€μ… νλΌλ―Έν„°λ¥Ό λ„μ΄ λ  μ μ—†λ” νƒ€μ…μΌλ΅ ν•μ •

---

- μ•„λ¬΄λ° μƒν•μ„ μ •ν•μ§€ μ•μ€ νƒ€μ… νλΌλ―Έν„°λ” κ²°κ³Όμ μΌλ΅ `Any?`λ¥Ό μƒν•μΌλ΅ μ •ν• νλΌλ―Έν„°μ™€ κ°™λ‹¤.
    
    ```kotlin
    class Processor<T> {
        fun process(value: T) {
            value?.hashCode() // "value"λ” λ„μ΄ λ  μ μλ‹¤. λ”°λΌμ„ μ•μ „ν• νΈμ¶μ„ μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.
        }
    }
    ```
    
- `<T : Any>`λΌλ” μ μ•½μ€ T νƒ€μ…μ΄ ν•­μƒ λ„μ΄ λ  μ μ—†λ” νƒ€μ…μ΄ λλ„λ΅ λ³΄μ¥ν•λ‹¤.
    
    ```kotlin
    class Processor<T : Any> {
        fun process(value: T) {
            value.hashCode()
        }
    }
    ```
    
- νƒ€μ… νλΌλ―Έν„°λ¥Ό λ„μ΄ λ  μ μ—†λ” νƒ€μ…μΌλ΅ μ μ•½ν•κΈ°λ§ ν•λ©΄ νƒ€μ… μΈμλ΅ λ„μ΄ λ  μ μλ” νƒ€μ…μ΄ λ“¤μ–΄μ¤λ” μΌμ„ λ§‰μ„ μ μλ‹¤.****

## 2. μ‹¤ν–‰ μ‹ μ λ„¤λ¦­μ¤μ λ™μ‘: μ†κ±°λ νƒ€μ… νλΌλ―Έν„°μ™€ μ‹¤μ²΄ν™”λ νƒ€μ… νλΌλ―Έν„°

---

- JVM μ μ λ„¤λ¦­μ¤λ” λ³΄ν†µ νƒ€μ… μ†κ±°λ¥Ό μ‚¬μ©ν•΄ κµ¬ν„λλ‹¤ β†’ μ‹¤ν–‰ μ‹μ μ— μ λ„¤λ¦­ ν΄λμ¤μ μΈμ¤ν„΄μ¤μ— νƒ€μ… μΈμ μ •λ³΄κ°€ λ“¤μ–΄μμ§€ μ•λ‹¤.
    
    ![Untitled](./image/9/Untitled%202.png)
    

### 2-1. μ‹¤ν–‰ μ‹μ μ μ λ„¤λ¦­: νƒ€μ… κ²€μ‚¬μ™€ μΊμ¤νΈ

---

- μλ°”μ™€ λ§μ°¬κ°€μ§€λ΅ μ½”ν‹€λ¦° μ λ„¤λ¦­ νƒ€μ… μΈμ μ •λ³΄λ” λ°νƒ€μ„μ— μ§€μ›μ§„λ‹¤ β†’ μ λ„¤λ¦­ ν΄λμ¤ μΈμ¤ν„΄μ¤κ°€ κ·Έ μΈμ¤ν„΄μ¤λ¥Ό μƒμ„±ν•  λ• μ“°μΈ νƒ€μ… μΈμμ— λ€ν• μ •λ³΄λ¥Ό μ μ§€ν•μ§€ μ•λ”λ‹¤.
    
    ```kotlin
    val list1: List<String> = listOf("a", "b")
    val list2: List<Int> = listOf(1, 2, 3)
    ```
    
    ![9.3 μ‹¤ν–‰ μ‹μ μ— list1 μ΄λ‚ list2 κ°€ μ •μμ λ¦¬μ¤νΈλ΅ μ„ μ–Έλλ‹¤λ” μ‚¬μ‹¤μ„ μ• μ μ—†λ‹¤. κ° κ°μ²΄λ” λ‹¨μ§€ `List` μΌ λΏμ΄λ‹¤.](./image/9/Untitled%203.png)
    
    9.3 μ‹¤ν–‰ μ‹μ μ— list1 μ΄λ‚ list2 κ°€ μ •μμ λ¦¬μ¤νΈλ΅ μ„ μ–Έλλ‹¤λ” μ‚¬μ‹¤μ„ μ• μ μ—†λ‹¤. κ° κ°μ²΄λ” λ‹¨μ§€ `List` μΌ λΏμ΄λ‹¤.
    
    - μ»΄νμΌλ¬λ” λ‘ λ¦¬μ¤νΈλ¥Ό μ„λ΅ λ‹¤λ¥Έ νƒ€μ…μΌλ΅ μΈμ‹ν•μ§€λ§ μ‹¤ν–‰ μ‹μ μ— κ·Έ λ‘μ€ μ™„μ „ν κ°™μ€ νƒ€μ…μ κ°μ²΄λ‹¤.
- νƒ€μ… μ†κ±°λ΅ μΈν•΄ μƒκΈ°λ” ν•κ³„ β†’ `is` κ²€μ‚¬μ—μ„ νƒ€μ… μΈμλ΅ μ§€μ •ν• νƒ€μ…μ„ κ²€μ‚¬ν•  μλ” μ—†λ‹¤.
    
    ```kotlin
    if (value is List<String>) {...}
    // ERROR: Cannot check for instance of erased type
    ```
    
- μ λ„¤λ¦­ νƒ€μ… μ†κ±° μ¥μ : μ €μ¥ν•΄μ•Ό ν•λ” νƒ€μ… μ •λ³΄μ ν¬κΈ°κ°€ μ¤„μ–΄λ“¤μ–΄μ„ μ „λ°μ μΈ λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ΄ μ¤„μ–΄λ“ λ‹¤.
- μ¤νƒ€ ν”„λ΅μ μ…(`*`): νƒ€μ… νλΌλ―Έν„°κ°€ 2κ° μ΄μƒμ΄λΌλ©΄ λ¨λ“  νƒ€μ… νλΌλ―Έν„°μ— `*`λ¥Ό ν¬ν•¨μ‹μΌμ•Ό ν•λ‹¤ β†’ μΈμλ¥Ό μ• μ μ—†λ” μ λ„¤λ¦­ νƒ€μ…μ„ ν‘ν„ν•  λ• μ‚¬μ©

- μ‹¤ν–‰ μ‹μ μ—λ” μ λ„¤λ¦­ νƒ€μ…μ νƒ€μ… μΈμλ¥Ό μ• μ μ—†μΌλ―€λ΅ μΊμ¤ν…μ€ ν•­μƒ μ„±κ³µν•λ‹¤. κ·Έλ° νƒ€μ… μΊμ¤ν…μ„ μ‚¬μ©ν•λ©΄ μ»΄νμΌλ¬κ°€ "`unchecked cast`(κ²€μ‚¬ν•  μ μ—†λ” μΊμ¤ν…)"μ΄λΌλ” κ²½κ³ λ¥Ό ν•΄μ¤€λ‹¤. ν•μ§€λ§ μ»΄νμΌλ¬λ” λ‹¨μν κ²½κ³ λ§ ν•κ³  μ»΄νμΌμ„ μ§„ν–‰ν•λ‹¤.
    
    ```kotlin
    fun printSum(c: Collection<*>) {
        val intList = c as? List<Int> ?: throw IllegalArgumentException("List is expected")
        println(intList.sum())
    }
    
    fun main() {
        printSum(listOf(1, 2, 3)) // 6
    }
    ```
    
    ![Untitled](./image/9/Untitled%204.png)
    
- ν•μ§€λ§ μλ»λ νƒ€μ…μ μ›μ†κ°€ λ“¤μ–΄μλ” λ¦¬μ¤νΈλ¥Ό μ „λ‹¬ν•λ©΄ μ‹¤ν–‰ μ‹μ μ— `ClassCastException`μ΄ λ°μƒν•λ‹¤.
    
    ```kotlin
    fun main() {
        printSum(listOf("a", "b"))
        // Exception in thread "main" java.lang.ClassCastException: java.lang.String incompatible with java.lang.Number
    }
    ```
    
    - μ–΄λ–¤ κ°’μ΄ `List<Int>`μΈμ§€ κ²€μ‚¬ν•  μλ” μ—†μΌλ―€λ΅ `IllegalArgumentException`μ΄ λ°μƒν•μ§€λ” μ•λ”λ‹¤ β†’ `as?` μΊμ¤νΈκ°€ μ„±κ³µν•κ³  λ¬Έμμ—΄ λ¦¬μ¤νΈμ— λ€ν•΄ `sum` ν•¨μκ°€ νΈμ¶λλ‹¤. `sum`μ΄ μ‹¤ν–‰λλ” λ„μ¤‘μ— μμ™Έκ°€ λ°μƒν•λ‹¤.
- μ½”ν‹€λ¦° μ»΄νμΌλ¬λ” μ»΄νμΌ μ‹μ μ— νƒ€μ… μ •λ³΄κ°€ μ£Όμ–΄μ§„ κ²½μ°μ—λ” `is` κ²€μ‚¬λ¥Ό μν–‰ν•κ² ν—μ©ν•  μ μμ„ μ •λ„λ΅ λ‘λ‘ν•λ‹¤.
    
    ```kotlin
    fun printSum(c: Collection<Int>) {
        if (c is List<Int>) {
            println(c.sum())
        }
    }
    
    fun main() {
        printSum(listOf(1, 2, 3)) // 6
    }
    ```
    
- μΌλ°μ μΌλ΅ μ½”ν‹€λ¦° μ»΄νμΌλ¬λ” μ°λ¦¬μ—κ² μ•μ „ν•μ§€ λ»ν• κ²€μ‚¬μ™€ μν–‰ν•  μ μλ” κ²€μ‚¬λ¥Ό μ•λ ¤μ£ΌκΈ° μ„ν•΄ μµλ€ν• λ…Έλ ¥ν•λ‹¤. λ”°λΌμ„ μ»΄νμΌλ¬ κ²½κ³ μ μλ―Έμ™€ μ–΄λ–¤ μ—°μ‚°μ΄ μ•μ „ν•μ§€μ— λ€ν•΄ μ•μ•„μ•Ό ν•λ‹¤.****
    - μ•μ „ν•μ§€ λ»ν• `is` κ²€μ‚¬λ” κΈμ§€
    - μ„ν—ν• `as` μΊμ¤ν…μ€ κ²½κ³ λ¥Ό μ¶λ ¥

### 2-2. μ‹¤μ²΄ν™”ν• νƒ€μ… νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν• ν•¨μ μ„ μ–Έ

---

- μ λ„¤λ¦­ ν•¨μμ νƒ€μ… μΈμλ„ μ λ„¤λ¦­ ν•¨μκ°€ νΈμ¶λλ„ κ·Έ ν•¨μμ λ³Έλ¬Έμ—μ„λ” νΈμ¶μ‹ μ“°μΈ νƒ€μ… μΈμλ¥Ό μ• μ μ—†λ‹¤.
    
    ```kotlin
    fun <T> isA(value: Any) = value is T
    // Error: Cannot check for instance of erased type: T
    ```
    
- μΈλΌμΈ ν•¨μμ νƒ€μ… νλΌλ―Έν„°λ” μ‹¤μ²΄ν™”λλ―€λ΅ μ‹¤ν–‰ μ‹μ μ— μΈλΌμΈ ν•¨μμ νƒ€μ… μΈμλ¥Ό μ• μ μλ‹¤.
    
    ```kotlin
    inline fun <refied T> isA(value: Any) = value is T
    
    fun main() {
        println(isA<String>("abc")) // true
        println(isA<String>(123)) // false
    }
    ```
    
    ![Untitled](./image/9/Untitled%205.png)
    
- `filterIsInstance`: μΈμλ΅ λ°›μ€ μ»¬λ ‰μ…μ μ›μ† μ¤‘μ—μ„ νƒ€μ… μΈμλ΅ μ§€μ •ν• ν΄λμ¤μ μΈμ¤ν„΄μ¤λ§μ„ λ¨μ•„μ„ λ§λ“  λ¦¬μ¤νΈλ¥Ό λ°ν™ν•λ‹¤.
    
    ![Untitled](./image/9/Untitled%206.png)
    
    ![Untitled](./image/9/Untitled%207.png)
    
    ```kotlin
    fun main() {
        val items = listOf("one", 2, "three")
        println(items.filterIsInstance<String>()) // [one, three]
    }
    ```
    
- μ½”ν‹€λ¦°μ—μ„, μΌλ°μ μΈ κ²½μ° λ°νƒ€μ„μ— μ λ„¤λ¦­ νλΌλ―Έν„°λ¥Ό ν™•μΈν•  λ°©λ²•μ€ μ—†λ‹¤. [[stackoverflow λ™μΌ μ΄μ](https://stackoverflow.com/questions/36569421/kotlin-how-to-work-with-list-casts-unchecked-cast-kotlin-collections-listkot#answer-36570969)]
    
    ```kotlin
    @Suppress("UNCHECKED_CAST")
    inline fun <reified T : Any> List<*>.checkItemsAre() =
        if (all { it is T })
            this as List<T>
        else null
    ```
    
    β†’ νƒ€μ… μΈμλ¥Ό μ‹¤ν–‰ μ‹μ μ— μ• μ μλ‹¤.
    

- μΈλΌμΈ ν•¨μμ—μ„λ§ μ‹¤μ²΄ν™”ν• νƒ€μ… μΈμλ¥Ό μ“Έ μ μλ” μ΄μ 
    - μ»΄νμΌλ¬λ” μΈλΌμΈ ν•¨μμ λ³Έλ¬Έμ„ κµ¬ν„ν• λ°”μ΄νΈμ½”λ“λ¥Ό κ·Έ ν•¨μκ°€ νΈμ¶λλ” λ¨λ“  μ§€μ μ— μ‚½μ…ν•λ‹¤.
    - μ»΄νμΌλ¬λ” μ‹¤μ²΄ν™”ν• νƒ€μ… μΈμλ¥Ό μ‚¬μ©ν•΄ μΈλΌμΈ ν•¨μλ¥Ό νΈμ¶ν•λ” κ° λ¶€λ¶„μ μ •ν™•ν• νƒ€μ… μΈμλ¥Ό μ• μ μλ‹¤.
        
        ```kotlin
        inline fun <reified T> Iterable<*>.filterIsInstance(): List<T> {
            val destination = mutableListOf<T>()
            for (element in this) {
                // κ° μ›μ†κ°€ νƒ€μ… μΈμλ΅ μ§€μ •ν• ν΄λμ¤μ μΈμ¤ν„΄μ¤μΈμ§€ κ²€μ‚¬ν•  μ μλ‹¤.
                if (element is T) { // μΈλΌμΈ μ‹ λ°”μ΄νΈμ½”λ“ μƒμ„±: if (element is **String**)
                    destination.add(element)
                }
            }
            return destination
        }
        ```
        

<aside>
π’΅ μ΄ κ²½μ°μ—λ” ν•¨μλ¥Ό `inline`μΌλ΅ λ§λ“λ” μ΄μ κ°€ μ„±λ¥ ν–¥μƒμ΄ μ•„λ‹λΌ μ‹¤μ²΄ν™”ν• νƒ€μ… νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•κΈ° μ„ν•¨μ΄λ‹¤.

</aside>

### 2-3. μ‹¤μ²΄ν™”ν• νƒ€μ… νλΌλ―Έν„°λ΅ ν΄λμ¤ μ°Έμ΅° λ€μ‹ 

---

- `java.lang.Class` νƒ€μ… μΈμλ¥Ό νλΌλ―Έν„°λ΅ λ°›λ” API μ— λ€ν• μ½”ν‹€λ¦° μ–΄λ‘ν„°λ¥Ό κµ¬μ¶•ν•λ” κ²½μ° μ‹¤μ²΄ν™”ν• νƒ€μ… νλΌλ―Έν„°λ¥Ό μμ£Ό μ‚¬μ©ν•λ‹¤.
    
    ```kotlin
    val serviceImpl = ServiceLoader.load(Service::class.java)
    ```
    
- `::class.java` κµ¬λ¬Έμ€ μ½”ν‹€λ¦° ν΄λμ¤μ— λ€μ‘ν•λ” `java.lang.Class` μ°Έμ΅°λ¥Ό μ–»λ” λ°©λ²•μ„ λ³΄μ—¬μ¤€λ‹¤. [[μ°Έκ³ ](https://www.notion.so/java-lang-Class-class-java-vs-javaClass-ccb4d3be07c04c7caecb11dc359501b3?pvs=21)]
    - [λ¶€λ„λ¬μ΄ μ‚½μ§κΈ° κ³µκ°](https://www.notion.so/non-nullable-type-class-71848e3c774247caaf29b58117f0512d?pvs=21)...
- π‘‰ κµ¬μ²΄ν™”ν• νƒ€μ… νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•΄ λ‹¤μ‹ μ‘μ„±
    
    ```kotlin
    inline fun <reified T> loadService(): ServiceLoader<T> {
        // T::class λ΅ νƒ€μ… νλΌλ―Έν„°μ ν΄λμ¤λ¥Ό κ°€μ Έμ¨λ‹¤.
        return ServiceLoader.load(T::class.java)
    }
    
    fun main() {
        val serviceImpl = loadService<Service>()
    }
    ```
    

### 2-4. μ‹¤μ²΄ν™”ν• νƒ€μ… νλΌλ―Έν„°μ μ μ•½

---

- λ‹¤μκ³Ό κ°™μ€ κ²½μ°μ— μ‹¤μ²΄ν™”ν• νƒ€μ… νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•  μ μλ‹¤.
    - νƒ€μ… κ²€μ‚¬μ™€ μΊμ¤ν…(`is`, `!is`, `as`, `as?`)
    - 10μ¥μ—μ„ μ„¤λ…ν•  μ½”ν‹€λ¦° λ¦¬ν”λ ‰μ… API(`::class`)
    - μ½”ν‹€λ¦° νƒ€μ…μ— λ€μ‘ν•λ” `java.lang.Class`λ¥Ό μ–»κΈ°(`::class.java`)
    - λ‹¤λ¥Έ ν•¨μλ¥Ό νΈμ¶ν•  λ• νƒ€μ… μΈμλ΅ μ‚¬μ©
- ν•μ§€λ§ λ‹¤μκ³Ό κ°™μ€ μΌμ€ ν•  μ μ—†λ‹¤.
    - νƒ€μ… νλΌλ―Έν„° ν΄λμ¤μ μΈμ¤ν„΄μ¤ μƒμ„±ν•κΈ°
    - νƒ€μ… νλΌλ―Έν„° ν΄λμ¤μ λ™λ° κ°μ²΄ λ©”μ†λ“ νΈμ¶ν•κΈ°
    - μ‹¤μ²΄ν™”ν• νƒ€μ… νλΌλ―Έν„°λ¥Ό μ”κµ¬ν•λ” ν•¨μλ¥Ό νΈμ¶ν•λ©΄μ„ μ‹¤μ²΄ν™”ν•μ§€ μ•μ€ νƒ€μ… νλΌλ―Έν„°λ΅ λ°›μ€ νƒ€μ…μ„ νƒ€μ… μΈμλ΅ λ„κΈ°κΈ°
    - ν΄λμ¤, ν”„λ΅νΌν‹°, μΈλΌμΈ ν•¨μκ°€ μ•„λ‹ ν•¨μμ νƒ€μ… νλΌλ―Έν„°λ¥Ό `refied`λ΅ μ§€μ •ν•κΈ°****
        - μ‹¤μ²΄ν™”ν• νƒ€μ… νλΌλ―Έν„°λ¥Ό μΈλΌμΈ ν•¨μμ—λ§ μ‚¬μ©ν•  μ μμΌλ―€λ΅ μ‹¤μ²΄ν™”ν• νƒ€μ… νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•λ” ν•¨μλ” μμ‹ μ—κ² μ „λ‹¬λλ” λ¨λ“  λλ‹¤μ™€ ν•¨κ» μΈλΌμ΄λ‹λλ‹¤.
            - λλ‹¤ λ‚΄λ¶€μ—μ„ νƒ€μ… νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•λ” λ°©μ‹μ— λ”°λΌμ„λ” λλ‹¤λ¥Ό μΈλΌμ΄λ‹ν•  μ μ—†λ” κ²½μ°κ°€ μƒκΈ°κΈ°λ„ ν•κ³ 
            - μ„±λ¥ λ¬Έμ λ΅ λλ‹¤λ¥Ό μΈλΌμ΄λ‹ν•κ³  μ‹¶μ§€ μ•μ„ μλ„ μλ‹¤.
                
                β†’ `noinline` λ³€κ²½μλ¥Ό ν•¨μ νƒ€μ… νλΌλ―Έν„°μ— λ¶™μ—¬μ„ μΈλΌμ΄λ‹μ„ κΈμ§€ν•  μ μλ‹¤.
                

## 3. λ³€μ„±: μ λ„¤λ¦­κ³Ό ν•μ„ νƒ€μ…

---

- λ³€μ„± κ°λ…μ€ `List<String>`μ™€ `List<Any>`μ™€ κ°™μ΄ κΈ°μ € νƒ€μ…μ΄ κ°™κ³  νƒ€μ… μΈμκ°€ λ‹¤λ¥Έ μ—¬λ¬ νƒ€μ…μ΄ μ„λ΅ μ–΄λ–¤ κ΄€κ³„κ°€ μλ”μ§€ μ„¤λ…ν•λ” κ°λ…μ΄λ‹¤.****
- λ³€μ„±μ„ μ ν™μ©ν•λ©΄ μ‚¬μ©μ— λ¶νΈν•μ§€ μ•μΌλ©΄μ„ νƒ€μ… μ•μ „μ„±μ„ λ³΄μ¥ν•λ” APIλ¥Ό λ§λ“¤ μ μλ‹¤.

### 3-1. λ³€μ„±μ΄ μλ” μ΄μ : μΈμλ¥Ό ν•¨μμ— λ„κΈ°κΈ°

---

- `List<Any>` νƒ€μ…μ νλΌλ―Έν„°λ¥Ό λ°›λ” ν•¨μμ— `List<String>`μ„ λ„κΈ°λ©΄ μ•μ „ν• κΉ? `String` ν΄λμ¤λ” `Any`λ¥Ό ν™•μ¥ν•λ―€λ΅ `Any` νƒ€μ… κ°’μ„ νλΌλ―Έν„°λ΅ λ°›λ” ν•¨μμ— `String`κ°’μ„ λ„κ²¨λ„ μ λ€λ΅ μ•μ „ν•λ‹¤. ν•μ§€λ§ `Any`μ™€ `String`μ΄ `List` μΈν„°νμ΄μ¤μ νƒ€μ… μΈμλ΅ λ“¤μ–΄κ°€λ” κ²½μ° κ·Έλ ‡κ² μμ‹  μκ² μ•μ „μ„±μ„ λ§ν•  μ μ—†λ‹¤ β†’ μ½”ν‹€λ¦° μ»΄νμΌλ¬λ” μ‹¤μ  μ΄λ° ν•¨μ νΈμ¶μ„ κΈμ§€ν•λ‹¤.
    
    ```kotlin
    >>> val strings = mutableListOf("abc", "bac")
    >>> addAnswer(strings) // μ΄ μ¤„μ΄ μ»΄νμΌλλ‹¤λ©΄
    >>> println(strings.maxBy { it.length })
    // μ‹¤ν–‰ μ‹μ μ— μμ™Έκ°€ λ°μƒν•  κ²ƒμ΄λ‹¤.
    // ClassCastException: Integer cannot be cast to String
    ```
    
    ![Untitled](./image/9/Untitled%208.png)
    
    - μ΄ μμ λ” `MutableList<Any>`κ°€ ν•„μ”ν• κ³³μ— `MutableList<String>`μ„ λ„κΈ°λ©΄ μ• λλ‹¤λ” μ‚¬μ‹¤μ„ λ³΄μ—¬μ¤€λ‹¤.****

π‘‰ μ–΄λ–¤ ν•¨μκ°€ λ¦¬μ¤νΈμ μ›μ†λ¥Ό μ¶”κ°€ν•κ±°λ‚ λ³€κ²½ν•λ‹¤λ©΄ νƒ€μ… λ¶μΌμΉκ°€ μƒκΈΈ μ μμ–΄μ„ `List<Any>`λ€μ‹  `List<String>`μ„ λ„κΈΈ μ μ—†λ‹¤. ν•μ§€λ§ μ›μ† μ¶”κ°€λ‚ λ³€κ²½μ΄ μ—†λ” κ²½μ°μ—λ” `List<String>`μ„ `List<Any>`λ€μ‹  λ„κ²¨λ„ μ•μ „ν•λ‹¤.

### 3-2. ν΄λμ¤, νƒ€μ…, ν•μ„ νƒ€μ…

---

- νƒ€μ…κ³Ό ν΄λμ¤μ μ°¨μ΄
    - μ λ„¤λ¦­ ν΄λμ¤κ°€ μ•„λ‹ ν΄λμ¤μ—μ„λ” ν΄λμ¤ μ΄λ¦„μ„ λ°”λ΅ νƒ€μ…μΌλ΅ μ“Έ μ μλ‹¤.
        
        ```kotlin
        var x: String
        var x: String?
        ```
        
        β†’ λ¨λ“  μ½”ν‹€λ¦° ν΄λμ¤κ°€ μ μ–΄λ„ λ‘ μ΄μƒμ νƒ€μ…μ„ κµ¬μ„±ν•  μ μλ‹¤.
        
- μ λ„¤λ¦­ ν΄λμ¤μ—μ„λ”
    - μ¬λ°”λ¥Έ νƒ€μ…μ„ μ–»μΌλ ¤λ©΄ μ λ„¤λ¦­ νƒ€μ…μ νƒ€μ… νλΌλ―Έν„°λ¥Ό κµ¬μ²΄μ μΈ νƒ€μ… μΈμλ΅ λ°”κΏ”μ¤μ•Ό ν•λ‹¤.
        
        ```kotlin
        // List λ” νƒ€μ…μ΄ μ•„λ‹λ‹¤.
        // ν•μ§€λ§ νƒ€μ… μΈμλ¥Ό μΉν™ν• λ‹¤μμ€ λ¨λ‘ μ λ€λ΅ λ νƒ€μ…μ΄λ‹¤.
        List<Int>
        List<String?>
        ```
        
        - κ°κ°μ μ λ„¤λ¦­ ν΄λμ¤λ” λ¬΄μν λ§μ€ νƒ€μ…μ„ λ§λ“¤μ–΄λ‚Ό μ μλ‹¤.

- ν•μ„ νƒ€μ…(subtype): μ–΄λ–¤ νƒ€μ… `A`μ κ°’μ΄ ν•„μ”ν• λ¨λ“  μ¥μ†μ— μ–΄λ–¤ νƒ€μ… `B`μ κ°’μ„ λ„£μ–΄λ„ μ•„λ¬΄ λ¬Έμ κ°€ μ—†λ‹¤λ©΄ `B`λ” νƒ€μ… `A`μ ν•μ„ νƒ€μ…μ΄λ‹¤. (`B`κ°€ `A`λ³΄λ‹¤ κµ¬μ²΄μ )
    - `Int`λ” `Number`μ ν•μ„ νƒ€μ…
    - λ¨λ“  νƒ€μ…μ΄ μμ‹ μ ν•μ„ νƒ€μ…
    
    ![9.4 A κ°€ ν•„μ”ν• λ¨λ“  κ³³μ— B λ¥Ό μ‚¬μ©ν•  μ μμΌλ©΄ B λ” A μ ν•μ„ νƒ€μ…μ΄λ‹¤.](./image/9/Untitled%209.png)
    
    9.4 A κ°€ ν•„μ”ν• λ¨λ“  κ³³μ— B λ¥Ό μ‚¬μ©ν•  μ μμΌλ©΄ B λ” A μ ν•μ„ νƒ€μ…μ΄λ‹¤.
    
- μƒμ„ νƒ€μ…: ν•μ„ νƒ€μ…μ λ°λ€λ‹¤.
    - A νƒ€μ…μ΄ B νƒ€μ…μ ν•μ„ νƒ€μ…μ΄λΌλ©΄ B λ” A μ μƒμ„ νƒ€μ…μ΄λ‹¤.
- ν•μ„ νƒ€μ…μ€ ν•μ„ ν΄λμ¤(subclass)μ™€ κ·Όλ³Έμ μΌλ΅ κ°™λ‹¤.
    - `Int` ν΄λμ¤λ” `Number`μ ν•μ„ ν΄λμ¤ β†’ `Int`λ” `Number`μ ν•μ„ νƒ€μ…
- λ¬΄κ³µλ³€(invariant): μ λ„¤λ¦­ νƒ€μ…μ„ μΈμ¤ν„΄μ¤ν™” ν•  λ• νƒ€μ… μΈμλ΅ μ„λ΅ λ‹¤λ¥Έ νƒ€μ…μ΄ λ“¤μ–΄κ°€λ©΄ μΈμ¤ν„΄μ¤ νƒ€μ… μ‚¬μ΄μ ν•μ„ νƒ€μ… κ΄€κ³„κ°€ μ„±λ¦½ν•μ§€ μ•λ” μ λ„¤λ¦­ νƒ€μ… π‘‰ μλ°”μ—μ„λ” λ¨λ“  ν΄λμ¤κ°€ λ¬΄κ³µλ³€μ΄λ‹¤.
    - A μ™€ B κ°€ μ„λ΅ λ‹¤λ¥΄κΈ°λ§ ν•λ©΄ `MutableList<A>`λ” ν•­μƒ `MutableList<B>`μ ν•μ„ νƒ€μ…μ΄ μ•„λ‹λ‹¤.
- κ³µλ³€μ (covariant): μ½”ν‹€λ¦°μ `List` μΈν„°νμ΄μ¤λ” μ½κΈ° μ „μ© μ»¬λ ‰μ… β†’ `A`κ°€ `B`μ ν•μ„ νƒ€μ…μ΄λ©΄ `List<A>`λ” `List<B>`μ ν•μ„ νƒ€μ…μ΄λ‹¤.

### 3-3. κ³µλ³€μ„±: ν•μ„ νƒ€μ… κ΄€κ³„λ¥Ό μ μ§€

---

- A κ°€ B μ ν•μ„ νƒ€μ…μΌ λ• `Producer<A>`κ°€ `Producer<B>`μ ν•μ„ νƒ€μ…μ΄λ©΄ `Producer`λ” κ³µλ³€μ μ΄λ‹¤ β†’ ν•μ„ νƒ€μ… κ΄€κ³„κ°€ μ μ§€λλ‹¤.
    - ex> Catκ°€ Animalμ ν•μ„ νƒ€μ…μ΄κΈ° λ•λ¬Έμ— `Producer<Cat>`μ€ `Producer<Animal>`μ ν•μ„ νƒ€μ…μ΄λ‹¤.
- μ½”ν‹€λ¦°μ—μ„ μ λ„¤λ¦­ ν΄λμ¤κ°€ νƒ€μ… νλΌλ―Έν„°μ— λ€ν•΄ κ³µλ³€μ μ„μ„ ν‘μ‹ν•λ ¤λ©΄ νƒ€μ… νλΌλ―Έν„° μ΄λ¦„ μ•μ— `out`μ„ λ„£μ–΄μ•Ό ν•λ‹¤.
    
    ```kotlin
    interface Producer<out T> {  // ν΄λμ¤κ°€ Tμ— λ€ν•΄ κ³µλ³€μ μ΄λΌκ³  μ„ μ–Έν•λ‹¤. 
        fun produce(): T
    }
    ```
    
- ν΄λμ¤μ νƒ€μ… νλΌλ―Έν„°λ¥Ό κ³µλ³€μ μΌλ΅ λ§λ“¤λ©΄ ν•¨μ μ •μμ— μ‚¬μ©ν• νλΌλ―Έν„° νƒ€μ…κ³Ό νƒ€μ… μΈμμ νƒ€μ…μ΄ μ •ν™•ν μΌμΉν•μ§€ μ•λ”λΌλ„ κ·Έ ν΄λμ¤μ μΈμ¤ν„΄μ¤λ¥Ό ν•¨μ μΈμλ‚ λ°ν™κ°’μΌλ΅ μ‚¬μ©ν•  μ μλ‹¤.
    
    ```kotlin
    open class Animal {
        fun feed() { ... }
    }
    class Herd<T : Animal> {  // μ΄ νƒ€μ… νλΌλ―Έν„°λ¥Ό λ¬΄κ³µλ³€μ„±μΌλ΅ μ§€μ •ν•λ‹¤. 
        val size: Int get() = ...
        operator fun get(i: Int): T { ... }
    }
    fun feedAll(animals: Herd<Animal>) {
        for (i in 0 until animals.size) {
            animals[i].feed()
        }
    }
    ```
    
    ```kotlin
    // μ‚¬μ©μ μ½”λ“κ°€ κ³ μ–‘μ΄ λ¬΄λ¦¬λ¥Ό λ§λ“¤μ–΄μ„ κ΄€λ¦¬ν•λ‹¤. 
    class Cat : Animal() {   
        fun cleanLitter() { ... }
    }
    fun takeCareOfCats(cats: Herd<Cat>) {
        for (i in 0 until cats.size) {
            cats[i].cleanLitter()
            // feedAll(cats)           
        }
    }
    ```
    
    - feedAll ν•¨μμ—κ² κ³ μ–‘μ΄ λ¬΄λ¦¬λ¥Ό λ„κΈ°λ©΄ νƒ€μ… λ¶μΌμΉ(type mismatch) μ¤λ¥λ¥Ό λ³Ό μ μλ‹¤. Herd ν΄λμ¤μ `T` νƒ€μ… νλΌλ―Έν„°μ— λ€ν•΄ μ•„λ¬΄ λ³€μ„±λ„ μ§€μ •ν•μ§€ μ•μ•κΈ° λ•λ¬Έμ— κ³ μ–‘μ΄ λ¬΄λ¦¬λ” λ™λ¬Ό λ¬΄λ¦¬μ ν•μ„ ν΄λμ¤κ°€ μ•„λ‹λ‹¤.
        
        ![Untitled](./image/9/Untitled%2010.png)
        
    
    π‘‰ Herd ν΄λμ¤λ” `List`μ™€ λΉ„μ·ν• API λ¥Ό μ κ³µν•λ©° λ™λ¬Όμ„ κ·Έ ν΄λμ¤μ— μ¶”κ°€ν•κ±°λ‚ λ¬΄λ¦¬μ•μ λ™λ¬Όμ„ λ‹¤λ¥Έ λ™λ¬Όλ΅ λ°”κΏ€ μλ” μ—†λ‹¤. λ”°λΌμ„ Herd λ¥Ό κ³µλ³€μ μΈ ν΄λμ¤λ΅ λ§λ“¤κ³  νΈμ¶ μ½”λ“λ¥Ό μ μ ν λ°”κΏ€ μ μλ‹¤.
    
    ```kotlin
    class Herd<out T : Animal> {  
       ...
    }
    fun takeCareOfCats(cats: Herd<Cat>) {
        for (i in 0 until cats.size) {
            cats[i].cleanLitter()
        }
        feedAll(cats)  
    }
    ```
    

- νƒ€μ… νλΌλ―Έν„°λ¥Ό κ³µλ³€μ μΌλ΅ μ§€μ •ν•λ©΄ ν΄λμ¤ λ‚΄λ¶€μ—μ„ κ·Έ νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•λ” λ°©λ²•μ„ μ ν•ν•λ‹¤.
    - νƒ€μ… μ•μ „μ„±μ„ λ³΄μ¥ν•κΈ° μ„ν•΄ κ³µλ³€μ  νλΌλ―Έν„°λ” ν•­μƒ μ•„μ›ƒ(`out`) μ„μΉμ—λ§ μμ–΄μ•Ό ν•λ‹¤.
        - ν΄λμ¤κ°€ `T` νƒ€μ…μ κ°’μ„ μƒμ‚°ν•  μλ” μμ§€λ§ `T` νƒ€μ…μ κ°’μ„ μ†λΉ„ν• μλ” μ—†λ‹¤.

- ν΄λμ¤ λ©¤λ²„λ¥Ό μ„ μ–Έν•  λ• νƒ€μ… νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•  μ μλ” μ§€μ μ€ λ¨λ‘ μΈ(`in`)κ³Ό μ•„μ›ƒ(`out`)μ„μΉλ΅ λ‚λ‰λ‹¤.
    - `T`κ°€ ν•¨μμ λ°ν™ νƒ€μ…μ— μ“°μΈλ‹¤λ©΄ `T`λ” μ•„μ›ƒ μ„μΉμ— μλ‹¤. κ·Έ ν•¨μλ” `T` νƒ€μ…μ κ°’μ„ μƒμ‚°ν•λ‹¤.
    - `T`κ°€ ν•¨μμ νλΌλ―Έν„° νƒ€μ…μ— μ“°μΈλ‹¤λ©΄ `T`λ” μΈ μ„μΉμ— μλ‹¤. κ·Έλ° ν•¨μλ” `T` νƒ€μ…μ κ°’μ„ μ†λΉ„ν•λ‹¤.
        
        ![9.6 ν•¨μ νλΌλ―Έν„° νƒ€μ…μ€ μΈ μ„μΉ, ν•¨μ λ°ν™ νƒ€μ…μ€ μ•„μ›ƒ μ„μΉμ— μλ‹¤.](./image/9/Untitled%2011.png)
        
        9.6 ν•¨μ νλΌλ―Έν„° νƒ€μ…μ€ μΈ μ„μΉ, ν•¨μ λ°ν™ νƒ€μ…μ€ μ•„μ›ƒ μ„μΉμ— μλ‹¤.
        

- ν΄λμ¤ νƒ€μ… νλΌλ―Έν„° `T` μ•μ— `out` ν‚¤μ›λ“λ¥Ό λ¶™μ΄λ©΄ ν΄λμ¤ μ•μ—μ„ `T`λ¥Ό μ‚¬μ©ν•λ” λ©”μ†λ“κ°€ μ•„μ›ƒ μ„μΉμ—μ„λ§ `T`λ¥Ό μ‚¬μ©ν•κ² ν—μ©ν•κ³  μΈ μ„μΉμ—μ„λ” `T`λ¥Ό μ‚¬μ©ν•μ§€ λ»ν•κ² λ§‰λ”λ‹¤.
    
    ```kotlin
    class Herd<out T: Animal> {
        val size: Int get() = ...
        operator fun get(i: Int): T {...} // Tλ¥Ό λ°ν™ νƒ€μ…μΌλ΅ μ‚¬μ©ν•λ‹¤.
    }
    ```
    
    ![Untitled](./image/9/Untitled%2012.png)
    
    - μ»΄νμΌλ¬λ” νƒ€μ… νλΌλ―Έν„°κ°€ μ“°μ΄λ” μ„μΉλ¥Ό μ ν•ν•λ‹¤.
    - μ„μΉ κ·μΉ™μ€ μ™Έλ¶€μ—μ„ λ³Ό μ μλ”(`public`, `protected`, `internal`) ν΄λμ¤ API μ—λ§ μ μ©ν•  μ μλ‹¤.
        
        β†’ λ³€μ„± κ·μΉ™μ€ ν΄λμ¤ μ™Έλ¶€μ μ‚¬μ©μκ°€ ν΄λμ¤λ¥Ό μλ» μ‚¬μ©ν•λ” μΌμ„ λ§‰κΈ°μ„ν• κ²ƒμ΄λ―€λ΅ ν΄λμ¤ λ‚΄λ¶€ κµ¬ν„μ—λ” μ μ©λμ§€ μ•λ”λ‹¤.
        

<aside>
π’΅ `private` λ©”μ†λ“ νλΌλ―Έν„°, μƒμ„±μ νλΌλ―Έν„°λ” μΈ, μ•„μ›ƒ μ–΄λμ½λ„ μ•„λ‹λ‹¤.

</aside>

### 3-4. λ°κ³µλ³€μ„±: λ’¤μ§‘ν ν•μ„ νƒ€μ… κ΄€κ³„

---

- λ°κ³µλ³€ ν΄λμ¤μ ν•μ„ νƒ€μ… κ΄€κ³„λ” κ³µλ³€ ν΄λμ¤μ κ²½μ°μ™€ λ°λ€λ‹¤.
    
    ```kotlin
    interface Comparator<in T> {
        fun compare(e1: T, e2: T): Int {...}    // Tλ¥Ό in μ„μΉμ— μ‚¬μ©ν•λ‹¤.
    }
    ```
    
    - μΈν„°νμ΄μ¤μ λ©”μ†λ“λ” T νƒ€μ…μ κ°’μ„ μ†λΉ„ν•κΈ°λ§ ν•λ‹¤ β†’ `T`κ°€ μΈ(`in`) μ„μΉμ—μ„λ§ μ“°μΈλ‹¤.
- νƒ€μ… B κ°€ νƒ€μ… A μ ν•μ„ νƒ€μ…μΈ κ²½μ° `Consumer<A>`κ°€ `Consumer<B>`μ ν•μ„ νƒ€μ…μΈ κ΄€κ³„κ°€ μ„±λ¦½ν•λ©΄ μ λ„¤λ¦­ ν΄λμ¤ `Consumer<T>`λ” νƒ€μ… μΈμ `T`μ— λ€ν•΄ λ°κ³µλ³€μ΄λ‹¤.
    
    ![9.7 κ³µλ³€μ„± νƒ€μ… `Producer<T>`μ—μ„λ” νƒ€μ… μΈμμ ν•μ„ νƒ€μ… κ΄€κ³„κ°€ μ λ„¤λ¦­ νƒ€μ…μ—μ„λ„ μ μ§€λμ§€λ§ λ°κ³µλ³€μ„± νƒ€μ… `Consumer<T>`μ—μ„λ” νƒ€μ… μΈμμ ν•μ„ νƒ€μ… κ΄€κ³„κ°€ μ λ„¤λ¦­ νƒ€μ…μΌλ΅ μ¤λ©΄μ„ λ’¤μ§‘νλ‹¤.](./image/9/Untitled%2013.png)
    
    9.7 κ³µλ³€μ„± νƒ€μ… `Producer<T>`μ—μ„λ” νƒ€μ… μΈμμ ν•μ„ νƒ€μ… κ΄€κ³„κ°€ μ λ„¤λ¦­ νƒ€μ…μ—μ„λ„ μ μ§€λμ§€λ§ λ°κ³µλ³€μ„± νƒ€μ… `Consumer<T>`μ—μ„λ” νƒ€μ… μΈμμ ν•μ„ νƒ€μ… κ΄€κ³„κ°€ μ λ„¤λ¦­ νƒ€μ…μΌλ΅ μ¤λ©΄μ„ λ’¤μ§‘νλ‹¤.
    
    | κ³µλ³€μ„±(covariance) | λ°κ³µλ³€μ„±(contravariance) | λ¬΄κ³µλ³€μ„±(invariance) |
    | --- | --- | --- |
    | Producer<out T> | Consumer<in T> | MutableList<T> |
    | νƒ€μ… μΈμμ ν•μ„ νƒ€μ… κ΄€κ³„κ°€ μ λ„¤λ¦­ νƒ€μ…μ—μ„λ„ μ μ§€λλ‹¤. | νƒ€μ… μΈμμ ν•μ„ νƒ€μ… κ΄€κ³„κ°€ μ λ„¤λ¦­ νƒ€μ…μ—μ„ λ’¤μ§‘νλ‹¤. | ν•μ„ νƒ€μ… κ΄€κ³„κ°€ μ„±λ¦½ν•μ§€ μ•λ”λ‹¤. |
    | Producer<Cat>μ€ Producer<Animal>μ ν•μ„ νƒ€μ…μ΄λ‹¤. | Consumer<Animal>μ€ Consumer<Cat>μ ν•μ„ νƒ€μ…μ΄λ‹¤. |  |
    | Tλ¥Ό μ•„μ›ƒ μ„μΉμ—μ„λ§ μ‚¬μ©ν•  μ μλ‹¤. | Tλ¥Ό μΈ μ„μΉμ—μ„λ§ μ‚¬μ©ν•  μ μλ‹¤. | Tλ¥Ό μ•„λ¬΄ μ„μΉμ—μ„λ‚ μ‚¬μ©ν•  μ μλ‹¤. |

### 3-5. μ‚¬μ© μ§€μ  λ³€μ„±: νƒ€μ…μ΄ μ–ΈκΈ‰λλ” μ§€μ μ—μ„ λ³€μ„± μ§€μ •

---

- μ„ μ–Έ μ§€μ  λ³€μ„±(declaration site variance): ν΄λμ¤λ¥Ό μ„ μ–Έν•λ©΄μ„ λ³€μ„±μ„ μ§€μ •ν•λ©΄ κ·Έ ν΄λμ¤λ¥Ό μ‚¬μ©ν•λ” λ¨λ“  μ¥μ†μ— λ³€μ„± μ§€μ •μκ°€ μν–¥μ„ λΌμΉλ―€λ΅ νΈλ¦¬ν•λ‹¤.
- μ‚¬μ© μ§€μ  λ³€μ„±(use-site variance): μλ°”μ—μ„λ” νƒ€μ… νλΌλ―Έν„°κ°€ μλ” νƒ€μ…μ„ μ‚¬μ©ν•  λ•λ§λ‹¤ ν•΄λ‹Ή νƒ€μ… νλΌλ―Έν„°λ¥Ό ν•μ„ νƒ€μ…μ΄λ‚ μƒμ„ νƒ€μ… μ¤‘ μ–΄λ–¤ νƒ€μ…μΌλ΅ λ€μΉν•  μ μλ”μ§€ λ…μ‹ν•΄μ•Ό ν•λ‹¤.

- μ½”ν‹€λ¦°λ„ μ‚¬μ© μ§€μ  λ³€μ„±μ„ μ§€μ›ν•λ‹¤ π‘‰ ν΄λμ¤ μ•μ—μ„ μ–΄λ–¤ νƒ€μ… νλΌλ―Έν„°κ°€ κ³µλ³€μ μ΄κ±°λ‚ λ°κ³µλ³€μ μΈμ§€ μ„ μ–Έν•  μ μ—†λ” κ²½μ°μ—λ„ νΉμ • νƒ€μ… νλΌλ―Έν„°κ°€ λ‚νƒ€λ‚λ” μ§€μ μ—μ„ λ³€μ„±μ„ μ •ν•  μ μλ‹¤.
    
    ```kotlin
    fun <T> copyData(source: MutableList<T>, destination: MutableList<T>) {
        for (item in source) {
            destination.add(item)
        }
    }
    ```
    
    - μ΄ κ²½μ° λ‘ μ»¬λ ‰μ…μ μ›μ† νƒ€μ…μ΄ μ •ν™•ν•κ² μΌμΉν•  ν•„μ”κ°€ μ—†λ‹¤.
        - ex> λ¬Έμμ—΄μ΄ μ›μ†μΈ μ»¬λ ‰μ…μ—μ„ κ°μ²΄μ μ»¬λ ‰μ…μΌλ΅ μ›μ†λ¥Ό λ³µμ‚¬ν•΄λ„ μ•„λ¬΄ λ¬Έμ κ°€ μ—†λ‹¤.
    - 1οΈβƒ£ μ—¬λ¬ λ‹¤λ¥Έ λ¦¬μ¤νΈ νƒ€μ…μ— λ€ν•΄ μ‘λ™ν•κ² λ§λ“¤κΈ°
        
        ```kotlin
        // source μ μ›μ† νƒ€μ…μ€ destination μ›μ† νƒ€μ…μ ν•μ„ νƒ€μ…μ΄μ–΄μ•Ό ν•λ‹¤.
        fun <T : R, R> copyData2(source: MutableList<T>, destination: MutableList<R>) {
            for (item in source) {
                destination.add(item)
            }
        }
        
        fun main() {
            val ints = mutableListOf(1, 2, 3)
            val anyItems = mutableListOf<Any>()
            // Int κ°€ Any μ ν•μ„ νƒ€μ…μ΄λ―€λ΅ μ΄ ν•¨μλ¥Ό νΈμ¶ν•  μ μλ‹¤.
            copyData2(ints, anyItems)
            println(anyItems) // [1, 2, 3]
        }
        ```
        
    - 2οΈβƒ£ ν•¨μ κµ¬ν„μ΄ μ•„μ›ƒ(`out`) μ„μΉ / μΈ(`in`) μ„μΉμ— μλ” νƒ€μ… νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•λ” λ©”μ†λ“λ§ νΈμ¶ν•λ‹¤λ©΄ κ·Έλ° μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ ν•¨μ μ •μ μ‹ νƒ€μ… νλΌλ―Έν„°μ— λ³€μ„± λ³€κ²½μλ¥Ό μ¶”κ°€ν•  μ μλ‹¤. β†’ νƒ€μ… ν”„λ΅μ μ…
        
        ```kotlin
        // out ν‚¤μ›λ“λ¥Ό νƒ€μ…μ„ μ‚¬μ©ν•λ” μ„μΉ μ•μ— λ¶™μ΄λ©΄ T νƒ€μ…μ„ in μ„μΉμ— μ‚¬μ©ν•λ” λ©”μ†λ“λ¥Ό νΈμ¶ν•μ§€ μ•λ”λ‹¤λ” λ»μ΄λ‹¤.
        fun <T> copyData3(source: MutableList<out T>, destination: MutableList<T>) {
            for (item in source) {
                destination.add(item)
            }
        }
        
        // in ν‚¤μ›λ“λ¥Ό λ¶™μ—¬ κ·Έ νλΌλ―Έν„°λ¥Ό λ” μƒμ„ νƒ€μ…μΌλ΅ λ€μΉν•  μ μλ‹¤. source λ¦¬μ¤νΈ μ›μ†μ μƒμ„ νƒ€μ…μ„ destination λ¦¬μ¤νΈ μ›μ† νƒ€μ…μΌλ΅ ν—μ©ν•λ‹¤.
        fun <T> copyData4(source: MutableList<T>, destination: MutableList<in T>) {
            for (item in source) {
                destination.add(item)
            }
        }
        ```
        
- νƒ€μ… ν”„λ΅μ μ…: source λ¥Ό μΌλ°μ μΈ `MutableList`κ°€ μ•„λ‹λΌ `MutableList`λ¥Ό ν”„λ΅μ μ…μ„ ν•(μ μ•½μ„ κ°€ν•) νƒ€μ…μΌλ΅ λ§λ“ λ‹¤.

### 3-6. μ¤νƒ€ ν”„λ΅μ μ…: νƒ€μ… μΈμ λ€μ‹  `*` μ‚¬μ©

---

- μ¤νƒ€ ν”„λ΅μ μ…: μ λ„¤λ¦­ νƒ€μ… μΈμ μ •λ³΄κ°€ μ—†μμ„ ν‘ν„. `List<*>`(μ›μ† νƒ€μ…μ΄ μ•λ ¤μ§€μ§€ μ•μ€ λ¦¬μ¤νΈ)
    - `MutableList<*>`λ” `MutableList<Any?>`μ™€ κ°™μ§€ μ•λ‹¤.
        - `MutableList<Any?>`λ” λ¨λ“  νƒ€μ…μ μ›μ†λ¥Ό λ‹΄μ„ μ μλ‹¤λ” μ‚¬μ‹¤μ„ μ• μ μλ” λ¦¬μ¤νΈλ‹¤.
        - λ°λ©΄ `MutableList<*>`λ” μ–΄λ–¤ μ •ν•΄μ§„ κµ¬μ²΄μ μΈ νƒ€μ…μ μ›μ†λ§μ„ λ‹΄λ” λ¦¬μ¤νΈμ§€λ§ κ·Έ μ›μ†μ νƒ€μ…μ„ μ •ν™•ν λ¨λ¥Έλ‹¤λ” μ‚¬μ‹¤μ„ ν‘ν„ν•λ‹¤.
        
        ```kotlin
        >>> val list: MutableList<Any?> = mutableListOf('a', 1, "qwe")
        >>> val chars = mutableListOf('a', 'b', 'c')
        >>> val unknownElements: MutableList<*> =                
        ...         if (Random().nextBoolean()) list else chars
        >>> unknownElements.add(42) // μ»΄νμΌλ¬λ” μ΄ λ©”μ†λ“ νΈμ¶μ„ κΈμ§€ν•λ‹¤.                              
        // Error: Out-projected type 'MutableList<*>' prohibits the use of 'fun add(element: E): Boolean'
        >>> println(unknownElements.first()) // μ›μ†λ¥Ό κ°€μ Έμ™€λ„ μ•μ „ν•λ‹¤. first()λ” Any? νƒ€μ…μ μ›μ†λ¥Ό λ°ν™ν•λ‹¤. 
        a
        ```
        
- νƒ€μ… νλΌλ―Έν„°λ¥Ό μ‹κ·Έλ‹μ²μ—μ„ μ „ν€ μ–ΈκΈ‰ν•μ§€ μ•κ±°λ‚ λ°μ΄ν„°λ¥Ό μ½κΈ°λ” ν•μ§€λ§ κ·Έ νƒ€μ…μ—λ” κ΄€μ‹¬μ΄ μ—†λ” κ²½μ°μ™€ κ°™μ΄ νƒ€μ… μΈμ μ •λ³΄κ°€ μ¤‘μ”ν•μ§€ μ•μ„ λ•λ„ μ¤νƒ€ ν”„λ΅μ μ… κµ¬λ¬Έμ„ μ‚¬μ©ν•  μ μλ‹¤.
    
    ```kotlin
    fun printFirst(list: List<*>) {  // λ¨λ“  λ¦¬μ¤νΈλ¥Ό μΈμλ΅ λ°›μ„ μ μλ‹¤. 
        if (list.isNotEmpty()) { // isNotEmpty()μ—μ„λ” μ λ„¤λ¦­ νƒ€μ… νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•μ§€ μ•λ”λ‹¤. 
            println(list.first()) // first()λ” μ΄μ  Any?λ¥Ό λ°ν™ν•μ§€λ§ μ—¬κΈ°μ„λ” κ·Έ νƒ€μ…λ§μΌλ΅ μ¶©λ¶„ν•λ‹¤. 
        }
    }
    >>> printFirst(listOf("Svetlana", "Dmitry")) // Svetlana
    ```
    

- μ°Έκ³ 
    - [https://incheol-jung.gitbook.io/docs/study/kotlin-in-action/9](https://incheol-jung.gitbook.io/docs/study/kotlin-in-action/9)
    - [https://github.com/3tudy/kotlin/blob/master/Kotlin in Action/chapter09/chapter09.md](https://github.com/3tudy/kotlin/blob/master/Kotlin%20in%20Action/chapter09/chapter09.md)
