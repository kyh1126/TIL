# 3ì¥. ì¹´í”„ì¹´ ê¸°ë³¸ ê°œë…ê³¼ êµ¬ì¡°

## 1. ì¹´í”„ì¹´ ê¸°ì´ˆ ë‹¤ì§€ê¸°

---

> ì¹´í”„ì¹´ë¥¼ êµ¬ì„±í•˜ëŠ” ì£¼ìš” ìš”ì†Œ
> 
> - ì£¼í‚¤í¼(Zookeeper): ì•„íŒŒì¹˜ í”„ë¡œì íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„ì´ë‹¤. ì¹´í”„ì¹´ì˜ ë©”íƒ€ë°ì´í„°(metadata) ê´€ë¦¬ ë° ë¸Œë¡œì»¤ì˜ ì •ìƒìƒíƒœ ì ê²€(health check)ì„ ë‹´ë‹¹í•œë‹¤.
> - ì¹´í”„ì¹´(Kafka) ë˜ëŠ” ì¹´í”„ì¹´ í´ëŸ¬ìŠ¤í„°(Kafka cluster): ì•„íŒŒì¹˜ í”„ë¡œì íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„ì´ë‹¤. ì—¬ëŸ¬ ëŒ€ì˜ ë¸Œë¡œì»¤ë¥¼ êµ¬ì„±í•œ í´ëŸ¬ìŠ¤í„°ë¥¼ ì˜ë¯¸í•œë‹¤.
> - ë¸Œë¡œì»¤(broker): ì¹´í”„ì¹´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì„¤ì¹˜ëœ ì„œë²„ ë˜ëŠ” ë…¸ë“œ
> - í”„ë¡œë“€ì„œ(producer): ì¹´í”„ì¹´ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ì—­í• ì„ í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ë¥¼ ì´ì¹­í•œë‹¤.
> - ì»¨ìŠˆë¨¸(consumer): ì¹´í”„ì¹´ì—ì„œ ë©”ì‹œì§€ë¥¼ êº¼ë‚´ê°€ëŠ” ì—­í• ì„ í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ë¥¼ ì´ì¹­í•œë‹¤.
> - í† í”½(topic): ì¹´í”„ì¹´ëŠ” ë©”ì‹œì§€ í”¼ë“œë“¤ì„ í† í”½ìœ¼ë¡œ êµ¬ë¶„í•˜ê³ , ê° í† í”½ì˜ ì´ë¦„ì€ ì¹´í”„ì¹´ ë‚´ì—ì„œ ê³ ìœ í•˜ë‹¤.
> - íŒŒí‹°ì…˜(partition): ë³‘ë ¬ ì²˜ë¦¬ ë° ê³ ì„±ëŠ¥ì„ ì–»ê¸° ìœ„í•´ í•˜ë‚˜ì˜ í† í”½ì„ ì—¬ëŸ¬ ê°œë¡œ ë‚˜ëˆˆ ê²ƒ
> - ì„¸ê·¸ë¨¼íŠ¸(segment): í”„ë¡œë“€ì„œê°€ ì „ì†¡í•œ ì‹¤ì œ ë©”ì‹œì§€ê°€ ë¸Œë¡œì»¤ì˜ ë¡œì»¬ ë””ìŠ¤í¬ì— ì €ì¥ë˜ëŠ” íŒŒì¼ì„ ë§í•œë‹¤.
> - ë©”ì‹œì§€(message) ë˜ëŠ” ë ˆì½”ë“œ(record): í”„ë¡œë“€ì„œê°€ ë¸Œë¡œì»¤ë¡œ ì „ì†¡í•˜ê±°ë‚˜ ì»¨ìŠˆë¨¸ê°€ ì½ì–´ê°€ëŠ” ë°ì´í„° ì¡°ê°ì„ ë§í•œë‹¤.

### 1-1. ë¦¬í”Œë¦¬ì¼€ì´ì…˜

---

- ë¦¬í”Œë¦¬ì¼€ì´ì…˜(replication): ê° ë©”ì‹œì§€ë“¤ì„ ì—¬ëŸ¬ ê°œë¡œ ë³µì œí•´ì„œ ì¹´í”„ì¹´ í´ëŸ¬ìŠ¤í„°ë‚´ ë¸Œë¡œì»¤ë“¤ì— ë¶„ì‚°ì‹œí‚¤ëŠ” ë™ì‘ì„ ì˜ë¯¸
- í† í”½ ëª…ë ¹ì–´ ì¤‘ `replication-factor` ì˜µì…˜: ì¹´í”„ì¹´ ë‚´ ëª‡ ê°œì˜ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ ì§€í•˜ê² ë‹¤ëŠ” ì˜ë¯¸
    - `--replication-factor 3`: ì›ë³¸ì„ í¬í•¨í•œ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ì´ ì´ 3ê°œê°€ ìˆë‹¤.
        
        ![3-1. í† í”½ì˜ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ ë°°ì¹˜](./images/3/Untitled.png)
        
        3-1. í† í”½ì˜ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ ë°°ì¹˜
        
        - ì •í™•í•˜ê²Œ ë§í•˜ë©´, ì¹´í”„ì¹´ì—ì„œ í† í”½ì´ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í† í”½ì˜ íŒŒí‹°ì…˜ì´ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ë˜ëŠ” ê²ƒ

- ë¦¬í”Œë¦¬ì¼€ì´ì…˜ íŒ©í„° ìˆ˜ê°€ ì»¤ì§€ë©´ ì•ˆì •ì„±ì€ ë†’ì•„ì§€ì§€ë§Œ, ê·¸ë§Œí¼ ë¸Œë¡œì»¤ ë¦¬ì†ŒìŠ¤ë¥¼ ë§ì´ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.
    - ë³µì œì— ëŒ€í•œ ì˜¤ë²„í—¤ë“œë¥¼ ì¤„ì—¬ì„œ ìµœëŒ€í•œ ë¸Œë¡œì»¤ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥
    
    > **í…ŒìŠ¤íŠ¸ë‚˜ ê°œë°œ í™˜ê²½**: ë¦¬í”Œë¦¬ì¼€ì´ì…˜ íŒ©í„° ìˆ˜ 1
    > 
    > 
    > **ìš´ì˜ í™˜ê²½(ë¡œê·¸ì„± ë©”ì„¸ì§€ë¡œì„œ ì•½ê°„ì˜ ìœ ì‹¤ í—ˆìš©)**: ë¦¬í”Œë ˆí‚¤ì´ì…˜ íŒ©í„° ìˆ˜ 2
    > 
    > **ìš´ì˜ í™˜ê²½(ìœ ì‹¤ í—ˆìš©ì•ˆë¨)**: ë¦¬í”Œë ˆí‚¤ì´ì…˜ íŒ©í„° ìˆ˜ 3
    > 

### 1-2. íŒŒí‹°ì…˜

---

- íŒŒí‹°ì…˜(partition): í•˜ë‚˜ì˜ í† í”½ì´ í•œ ë²ˆì— ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” í•œê³„ë¥¼ ë†’ì´ê¸° ìœ„í•´ í† í”½ í•˜ë‚˜ë¥¼ ì—¬ëŸ¬ ê°œë¡œ ë‚˜ëˆ  ë³‘ë ¬ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ê²Œ ë§Œë“  ê²ƒ
    - í•˜ë‚˜ë¥¼ ì—¬ëŸ¬ ê°œë¡œ ë‚˜ëˆ„ë©´ ë¶„ì‚° ì²˜ë¦¬ë„ ê°€ëŠ¥, ë‚˜ë‰œ íŒŒí‹°ì…˜ ìˆ˜ë§Œí¼ ì»¨ìŠˆë¨¸ë¥¼ ì—°ê²°í•  ìˆ˜ ìˆë‹¤.
        
        ![3-2. í† í”½ê³¼ íŒŒí‹°ì…˜ì˜ ê´€ê³„](./images/3/Untitled%201.png)
        
        3-2. í† í”½ê³¼ íŒŒí‹°ì…˜ì˜ ê´€ê³„
        
        - í† í”½1: íŒŒí‹°ì…˜0ì´ë¼ëŠ” 1ê°œì˜ íŒŒí‹°ì…˜ìœ¼ë¡œ êµ¬ì„±
        - í† í”½3: íŒŒí‹°ì…˜0, íŒŒí‹°ì…˜1, íŒŒí‹°ì…˜2ì˜ ì´ 3ê°œì˜ íŒŒí‹°ì…˜ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.
    - íŒŒí‹°ì…˜ ë²ˆí˜¸ëŠ” 0ë¶€í„° ì‹œì‘

- íŒŒí‹°ì…˜ ìˆ˜ë„ í† í”½ì„ ìƒì„±í•  ë•Œ ì˜µì…˜ìœ¼ë¡œ ì„¤ì •
    - íŒŒí‹°ì…˜ ìˆ˜ëŠ” ì´ˆê¸° ìƒì„± í›„ ì–¸ì œë“ ì§€ ëŠ˜ë¦´ ìˆ˜ ìˆì§€ë§Œ, ë°˜ëŒ€ë¡œ í•œ ë²ˆ ëŠ˜ë¦° íŒŒí‹°ì…˜ ìˆ˜ëŠ” ì ˆëŒ€ë¡œ ì¤„ì¼ ìˆ˜ ì—†ë‹¤.
    - ì´ˆê¸°ì— í† í”½ì„ ìƒì„±í•  ë•Œ íŒŒí‹°ì…˜ ìˆ˜ë¥¼ ì‘ê²Œ(2 ë˜ëŠ” 4) ìƒì„±í•œ í›„, ë©”ì‹œì§€ ì²˜ë¦¬ëŸ‰ì´ë‚˜ ì»¨ìŠˆë¨¸ì˜ LAG ë“±ì„ ëª¨ë‹ˆí„°ë§í•˜ë©´ì„œ ì¡°ê¸ˆì”© ëŠ˜ë ¤ê°€ëŠ” ë°©ë²•ì´ ê°€ì¥ ì¢‹ë‹¤.
        - ì»¨ìŠˆë¨¸ì˜ LAG: í”„ë¡œë“€ì„œê°€ ë³´ë‚¸ ë©”ì‹œì§€ ìˆ˜(ì¹´í”„ì¹´ì— ë‚¨ì•„ ìˆëŠ” ë©”ì‹œì§€ ìˆ˜) - ì»¨ìŠˆë¨¸ê°€ ê°€ì ¸ê°„ ë©”ì‹œì§€ ìˆ˜

### 1-3. ì„¸ê·¸ë¨¼íŠ¸

---

- ìš°ë¦¬ê°€ í”„ë¡œë“€ì„œë¥¼ ì´ìš©í•´ ë³´ë‚¸ ë©”ì‹œì§€ëŠ” ë°”ë¡œ peter-overview01 í† í”½ì˜ íŒŒí‹°ì…˜0ì— ì €ì¥ë˜ì–´ ìˆë‹¤.

- í”„ë¡œë“€ì„œì— ì˜í•´ ë¸Œë¡œì»¤ë¡œ ì „ì†¡ëœ ë©”ì‹œì§€ëŠ” í† í”½ì˜ íŒŒí‹°ì…˜ì— ì €ì¥ë˜ë©°, ê° ë©”ì‹œì§€ë“¤ì€ ì„¸ê·¸ë¨¼íŠ¸(segment)ë¼ëŠ” ë¡œê·¸ íŒŒì¼ì˜ í˜•íƒœë¡œ ë¸Œë¡œì»¤ì˜ ë¡œì»¬ ë””ìŠ¤í¬ì— ì €ì¥ëœë‹¤.
- ê° íŒŒí‹°ì…˜ë§ˆë‹¤ Nê°œì˜ ì„¸ê·¸ë¨¼íŠ¸ ë¡œê·¸ íŒŒì¼ë“¤ì´ ì¡´ì¬í•œë‹¤ ğŸ‘‰Â ì„¸ê·¸ë¨¼íŠ¸ì˜ íŒŒì¼ ë‚´ìš©ì„ ì¶œë ¥í•´ë´„ìœ¼ë¡œì¨ í”„ë¡œë“€ì„œê°€ ì „ì†¡í•œ ë©”ì‹œì§€ê°€ ë¸Œë¡œì»¤ì˜ ë¡œì»¬ ë””ìŠ¤í¬ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì–´ ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.
    
    ![3-3. íŒŒí‹°ì…˜ê³¼ ì„¸ê·¸ë¨¼íŠ¸ì˜ ê´€ê²Œ](./images/3/Untitled%202.png)
    
    3-3. íŒŒí‹°ì…˜ê³¼ ì„¸ê·¸ë¨¼íŠ¸ì˜ ê´€ê²Œ
    
    - ë””ë ‰í† ë¦¬ ê²½ë¡œ: `/data/kafka-logs`
    - ë„ì»¤ë¡œ ì„¤ì¹˜í•œ ê²½ìš°: `/var/lib/kafka/data`
        
        <aside>
        ğŸ’¡ kafka-topics --bootstrap-server kafka1:9091 --create --topic peter-overview01 --partitions 2 --replication-factor 2
        
        </aside>
        
        ```bash
        kim-yoonhee î‚° cd ~/kafka/kafka2/appendix_C/cluster_zk_kafka
        kim-yoonhee î‚° ~/kafka/kafka2/appendix_C/cluster_zk_kafka î‚° î‚  main î‚° docker-compose start
        kim-yoonhee î‚° ~/kafka/kafka2/appendix_C/cluster_zk_kafka î‚° î‚  main î‚° docker exec -it kafka1 /bin/bash
        root@kafka1:/# cd /var/lib/kafka/data
        root@kafka1:/var/lib/kafka/data# ls
        __confluent.support.metrics-0  __consumer_offsets-25  __consumer_offsets-42
        __consumer_offsets-0	       __consumer_offsets-26  __consumer_offsets-43
        __consumer_offsets-1	       __consumer_offsets-27  __consumer_offsets-44
        __consumer_offsets-10	       __consumer_offsets-28  __consumer_offsets-45
        __consumer_offsets-11	       __consumer_offsets-29  __consumer_offsets-46
        __consumer_offsets-12	       __consumer_offsets-3   __consumer_offsets-47
        __consumer_offsets-13	       __consumer_offsets-30  __consumer_offsets-48
        __consumer_offsets-14	       __consumer_offsets-31  __consumer_offsets-49
        __consumer_offsets-15	       __consumer_offsets-32  __consumer_offsets-5
        __consumer_offsets-16	       __consumer_offsets-33  __consumer_offsets-6
        __consumer_offsets-17	       __consumer_offsets-34  __consumer_offsets-7
        __consumer_offsets-18	       __consumer_offsets-35  __consumer_offsets-8
        __consumer_offsets-19	       __consumer_offsets-36  __consumer_offsets-9
        __consumer_offsets-2	       __consumer_offsets-37  cleaner-offset-checkpoint
        __consumer_offsets-20	       __consumer_offsets-38  log-start-offset-checkpoint
        __consumer_offsets-21	       __consumer_offsets-39  meta.properties
        __consumer_offsets-22	       __consumer_offsets-4   peter-overview01-1
        __consumer_offsets-23	       __consumer_offsets-40  recovery-point-offset-checkpoint
        __consumer_offsets-24	       __consumer_offsets-41  replication-offset-checkpoint
        ```
        
        ```bash
        root@kafka2:/var/lib/kafka/data# ls
        __confluent.support.metrics-0  __consumer_offsets-25  __consumer_offsets-42
        __consumer_offsets-0	       __consumer_offsets-26  __consumer_offsets-43
        __consumer_offsets-1	       __consumer_offsets-27  __consumer_offsets-44
        __consumer_offsets-10	       __consumer_offsets-28  __consumer_offsets-45
        __consumer_offsets-11	       __consumer_offsets-29  __consumer_offsets-46
        __consumer_offsets-12	       __consumer_offsets-3   __consumer_offsets-47
        __consumer_offsets-13	       __consumer_offsets-30  __consumer_offsets-48
        __consumer_offsets-14	       __consumer_offsets-31  __consumer_offsets-49
        __consumer_offsets-15	       __consumer_offsets-32  __consumer_offsets-5
        __consumer_offsets-16	       __consumer_offsets-33  __consumer_offsets-6
        __consumer_offsets-17	       __consumer_offsets-34  __consumer_offsets-7
        __consumer_offsets-18	       __consumer_offsets-35  __consumer_offsets-8
        __consumer_offsets-19	       __consumer_offsets-36  __consumer_offsets-9
        __consumer_offsets-2	       __consumer_offsets-37  cleaner-offset-checkpoint
        __consumer_offsets-20	       __consumer_offsets-38  log-start-offset-checkpoint
        __consumer_offsets-21	       __consumer_offsets-39  meta.properties
        __consumer_offsets-22	       __consumer_offsets-4   peter-overview01-0
        __consumer_offsets-23	       __consumer_offsets-40  recovery-point-offset-checkpoint
        __consumer_offsets-24	       __consumer_offsets-41  replication-offset-checkpoint
        ```
        
        ```bash
        root@kafka3:/var/lib/kafka/data# ls
        __confluent.support.metrics-0  __consumer_offsets-26  __consumer_offsets-44
        __consumer_offsets-0	       __consumer_offsets-27  __consumer_offsets-45
        __consumer_offsets-1	       __consumer_offsets-28  __consumer_offsets-46
        __consumer_offsets-10	       __consumer_offsets-29  __consumer_offsets-47
        __consumer_offsets-11	       __consumer_offsets-3   __consumer_offsets-48
        __consumer_offsets-12	       __consumer_offsets-30  __consumer_offsets-49
        __consumer_offsets-13	       __consumer_offsets-31  __consumer_offsets-5
        __consumer_offsets-14	       __consumer_offsets-32  __consumer_offsets-6
        __consumer_offsets-15	       __consumer_offsets-33  __consumer_offsets-7
        __consumer_offsets-16	       __consumer_offsets-34  __consumer_offsets-8
        __consumer_offsets-17	       __consumer_offsets-35  __consumer_offsets-9
        __consumer_offsets-18	       __consumer_offsets-36  cleaner-offset-checkpoint
        __consumer_offsets-19	       __consumer_offsets-37  log-start-offset-checkpoint
        __consumer_offsets-2	       __consumer_offsets-38  meta.properties
        __consumer_offsets-20	       __consumer_offsets-39  peter-overview01-0
        __consumer_offsets-21	       __consumer_offsets-4   peter-overview01-1
        __consumer_offsets-22	       __consumer_offsets-40  recovery-point-offset-checkpoint
        __consumer_offsets-23	       __consumer_offsets-41  replication-offset-checkpoint
        __consumer_offsets-24	       __consumer_offsets-42
        __consumer_offsets-25	       __consumer_offsets-43
        ```
        
        - peter-overview01-0: peter-overview01ì´ë¼ëŠ” í† í”½ì˜ 0ë²ˆ íŒŒí‹°ì…˜ ë””ë ‰í† ë¦¬
        - peter-overview01-1: peter-overview01ì´ë¼ëŠ” í† í”½ì˜ 1ë²ˆ íŒŒí‹°ì…˜ ë””ë ‰í† ë¦¬
    - peter-overview01-0 ë””ë ‰í† ë¦¬ì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ì¸
        
        ```bash
        root@kafka2:/var/lib/kafka/data# cd peter-overview01-0
        root@kafka2:/var/lib/kafka/data/peter-overview01-0# ls
        00000000000000000000.index  00000000000000000000.timeindex  leader-epoch-checkpoint
        00000000000000000000.log    00000000000000000006.snapshot
        ```
        
    - í”„ë¡œë“€ì„œê°€ ë³´ë‚¸ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ë¨¼ì € `00000000000000000000.log`íŒŒì¼ í™•ì¸
        - ë¡œê·¸íŒŒì¼ ë³µì‚¬
            
            ```bash
            kim-yoonhee î‚° ~/kafka/kafka2/appendix_C/cluster_zk_kafka î‚° î‚  main î‚° docker cp kafka2:/var/lib/kafka/data/peter-overview01-0/00000000000000000000.log ~/kafka
            ```
            
        - `hexdump`ë¥¼ ë³´ì—¬ì£¼ëŠ” `xxd` ëª…ë ¹ì–´ë¥¼ ì´ìš©
            
            ```bash
            kim-yoonhee î‚° ~/kafka î‚° xxd 00000000000000000000.log
            00000000: 0000 0000 0000 0000 0000 003c 0000 0000  ...........<....
            00000010: 0253 43f6 3900 0000 0000 0000 0001 8278  .SC.9..........x
            00000020: 9190 cf00 0001 8278 9190 cfff ffff ffff  .......x........
            00000030: ffff ffff ffff ffff ff00 0000 0114 0000  ................
            00000040: 0001 0868 6968 6900 0000 0000 0000 0001  ...hihi.........
            00000050: 0000 003c 0000 0000 0253 43f6 3900 0000  ...<.....SC.9...
            00000060: 0000 0000 0001 8278 9190 cf00 0001 8278  .......x.......x
            00000070: 9190 cfff ffff ffff ffff ffff ffff ffff  ................
            00000080: ff00 0000 0114 0000 0001 0868 6968 6900  ...........hihi.
            00000090: 0000 0000 0000 0002 0000 003c 0000 0000  ...........<....
            000000a0: 023c ed3c 2a00 0000 0000 0000 0001 8278  .<.<*..........x
            000000b0: 9297 4400 0001 8278 9297 44ff ffff ffff  ..D....x..D.....
            000000c0: ffff ffff ffff ffff ff00 0000 0114 0000  ................
            000000d0: 0001 0868 6968 6900 0000 0000 0000 0003  ...hihi.........
            000000e0: 0000 0045 0000 0000 0250 c112 d800 0000  ...E.....P......
            000000f0: 0000 0000 0001 8278 93dd dd00 0001 8278  .......x.......x
            00000100: 93dd ddff ffff ffff ffff ffff ffff ffff  ................
            00000110: ff00 0000 0126 0000 0001 1a74 7765 6e74  .....&.....twent
            00000120: 7920 6f6e 6520 7e7e 0000 0000 0000 0000  y one ~~........
            00000130: 0400 0000 3b00 0000 0002 1a57 6968 0000  ....;......Wih..
            00000140: 0000 0000 0000 0182 7894 3fd9 0000 0182  ........x.?.....
            00000150: 7894 3fd9 ffff ffff ffff ffff ffff ffff  x.?.............
            00000160: ffff 0000 0001 1200 0000 0106 456e 6400  ............End.
            00000170: 0000 0000 0000 0005 0000 0041 0000 0000  ...........A....
            00000180: 02eb 13e8 1d00 0000 0000 0000 0001 8278  ...............x
            00000190: 97df 3e00 0001 8278 97df 3eff ffff ffff  ..>....x..>.....
            000001a0: ffff ffff ffff ffff ff00 0000 011e 0000  ................
            000001b0: 0001 12e3 8597 4869 6869 6869 00         ......Hihihi.
            ```
            
    
    ![3-4. í† í”½, íŒŒí‹°ì…˜, ì„¸ê·¸ë¨¼íŠ¸ì˜ ê´€ê³„ë„](./images/3/Untitled%203.png)
    
    3-4. í† í”½, íŒŒí‹°ì…˜, ì„¸ê·¸ë¨¼íŠ¸ì˜ ê´€ê³„ë„
    
    - 1. í”„ë¡œë“€ì„œëŠ” ì¹´í”„ì¹´ì˜ peter-overview01 í† í”½ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œë‹¤.
    - 2. peter-overview01 í† í”½ì€ íŒŒí‹°ì…˜ì´ í•˜ë‚˜ë¿ì´ë¯€ë¡œ, í”„ë¡œë“€ì„œë¡œë¶€í„° ë°›ì€ ë©”ì‹œì§€ë¥¼ íŒŒí‹°ì…˜0ì˜ ì„¸ê·¸ë¨¼íŠ¸ ë¡œê·¸ íŒŒì¼ì— ì €ì¥í•œë‹¤.
        
        ```bash
        kim-yoonhee î‚° ~/kafka/kafka2/appendix_C/cluster_zk_kafka î‚° î‚  main î‚° docker cp kafka3:/var/lib/kafka/data/peter-overview01-0/00000000000000000000.log ~/kafka
        kim-yoonhee î‚° ~/kafka/kafka2/appendix_C/cluster_zk_kafka î‚° î‚  main î‚° docker cp kafka3:/var/lib/kafka/data/peter-overview01-1/00000000000000000000.log ~/kafka
        ```
        
        - íŒŒí‹°ì…˜0 â†’ kafka2 ì˜ ë¡œê·¸ë‘ ê°™ì€ ë‚´ìš©
            
            ```bash
            kim-yoonhee î‚° ~/kafka î‚° xxd 0_00000000000000000000.log
            00000000: 0000 0000 0000 0000 0000 003c 0000 0000  ...........<....
            00000010: 0253 43f6 3900 0000 0000 0000 0001 8278  .SC.9..........x
            00000020: 9190 cf00 0001 8278 9190 cfff ffff ffff  .......x........
            00000030: ffff ffff ffff ffff ff00 0000 0114 0000  ................
            00000040: 0001 0868 6968 6900 0000 0000 0000 0001  ...hihi.........
            00000050: 0000 003c 0000 0000 0253 43f6 3900 0000  ...<.....SC.9...
            00000060: 0000 0000 0001 8278 9190 cf00 0001 8278  .......x.......x
            00000070: 9190 cfff ffff ffff ffff ffff ffff ffff  ................
            00000080: ff00 0000 0114 0000 0001 0868 6968 6900  ...........hihi.
            00000090: 0000 0000 0000 0002 0000 003c 0000 0000  ...........<....
            000000a0: 023c ed3c 2a00 0000 0000 0000 0001 8278  .<.<*..........x
            000000b0: 9297 4400 0001 8278 9297 44ff ffff ffff  ..D....x..D.....
            000000c0: ffff ffff ffff ffff ff00 0000 0114 0000  ................
            000000d0: 0001 0868 6968 6900 0000 0000 0000 0003  ...hihi.........
            000000e0: 0000 0045 0000 0000 0250 c112 d800 0000  ...E.....P......
            000000f0: 0000 0000 0001 8278 93dd dd00 0001 8278  .......x.......x
            00000100: 93dd ddff ffff ffff ffff ffff ffff ffff  ................
            00000110: ff00 0000 0126 0000 0001 1a74 7765 6e74  .....&.....twent
            00000120: 7920 6f6e 6520 7e7e 0000 0000 0000 0000  y one ~~........
            00000130: 0400 0000 3b00 0000 0002 1a57 6968 0000  ....;......Wih..
            00000140: 0000 0000 0000 0182 7894 3fd9 0000 0182  ........x.?.....
            00000150: 7894 3fd9 ffff ffff ffff ffff ffff ffff  x.?.............
            00000160: ffff 0000 0001 1200 0000 0106 456e 6400  ............End.
            00000170: 0000 0000 0000 0005 0000 0041 0000 0000  ...........A....
            00000180: 02eb 13e8 1d00 0000 0000 0000 0001 8278  ...............x
            00000190: 97df 3e00 0001 8278 97df 3eff ffff ffff  ..>....x..>.....
            000001a0: ffff ffff ffff ffff ff00 0000 011e 0000  ................
            000001b0: 0001 12e3 8597 4869 6869 6869 00         ......Hihihi.
            ```
            
        - íŒŒí‹°ì…˜1
            
            ```bash
            kim-yoonhee î‚° ~/kafka î‚° xxd 00000000000000000000.log
            00000000: 0000 0000 0000 0000 0000 0045 0000 0000  ...........E....
            00000010: 0225 b424 4000 0000 0000 0000 0001 8278  .%.$@..........x
            00000020: 9284 a700 0001 8278 9284 a7ff ffff ffff  .......x........
            00000030: ffff ffff ffff ffff ff00 0000 0126 0000  .............&..
            00000040: 0001 1a46 6972 7374 206d 6573 7361 6765  ...First message
            00000050: 0000 0000 0000 0000 0100 0000 3e00 0000  ............>...
            00000060: 0002 1e9f ef74 0000 0000 0000 0000 0182  .....t..........
            00000070: 7893 a145 0000 0182 7893 a145 ffff ffff  x..E....x..E....
            00000080: ffff ffff ffff ffff ffff 0000 0001 1800  ................
            00000090: 0000 010c 7965 7965 7965 0000 0000 0000  ....yeyeye......
            000000a0: 0000 0200 0000 4500 0000 0002 9112 853d  ......E........=
            000000b0: 0000 0000 0000 0000 0182 7894 4c14 0000  ..........x.L...
            000000c0: 0182 7894 4c14 ffff ffff ffff ffff ffff  ..x.L...........
            000000d0: ffff ffff 0000 0001 2600 0000 011a 416e  ........&.....An
            000000e0: 6420 6e65 7720 7374 6172 7400 0000 0000  d new start.....
            000000f0: 0000 0003 0000 003f 0000 0000 02a1 5d37  .......?......]7
            00000100: dd00 0000 0000 0000 0001 8278 97fd 3000  ...........x..0.
            00000110: 0001 8278 97fd 30ff ffff ffff ffff ffff  ...x..0.........
            00000120: ffff ffff ff00 0000 011a 0000 0001 0e48  ...............H
            00000130: 6920 6775 7973 00                        i guys.
            ```
            
    - 3. ë¸Œë¡œì»¤ì˜ ì„¸ê·¸ë¨¼íŠ¸ ë¡œê·¸ íŒŒì¼ì— ì €ì¥ëœ ë©”ì‹œì§€ëŠ” ì»¨ìŠˆë¨¸ê°€ ì½ì–´ê°ˆ ìˆ˜ ìˆë‹¤.

- ì»¨ìŠˆë¨¸ëŠ” peter-overview01 í† í”½ì„ ì»¨ìŠ˜í•´ì„œ í•´ë‹¹ í† í”½ ë‚´ íŒŒí‹°ì…˜0ì˜ ì„¸ê·¸ë¨¼íŠ¸ ë¡œê·¸ íŒŒì¼ì—ì„œ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

## 2. ì¹´í”„ì¹´ì˜ í•µì‹¬ ê°œë…

---

- ì—¬ëŸ¬ ìš°ìˆ˜í•œ ê¸°ì—…ë“¤ì´ ì¹´í”„ì¹´ë¥¼ ì„œë‘˜ëŸ¬ ë„ì…í•˜ê³  ë§ì€ ê°œë°œìê°€ ì¢‹ì•„í•˜ëŠ” ì´ìœ 
    - ë†’ì€ ì²˜ë¦¬ëŸ‰
    - ë¹ ë¥¸ ì‘ë‹µ ì†ë„
    - ì•ˆì •ì„±

### 2-1. ë¶„ì‚° ì‹œìŠ¤í…œ

---

- ë¶„ì‚° ì‹œìŠ¤í…œ: ë„¤íŠ¸ì›Œí¬ìƒì—ì„œ ì—°ê²°ëœ ì»´í“¨í„°ë“¤ì˜ ê·¸ë£¹
    - ë‹¨ì¼ ì‹œìŠ¤í…œì´ ê°–ì§€ ëª»í•œ ë†’ì€ ì„±ëŠ¥ì„ ëª©í‘œë¡œ í•œë‹¤.
    - í•˜ë‚˜ì˜ ì„œë²„ ë˜ëŠ” ë…¸ë“œ ë“±ì— ì¥ì• ê°€ ë°œìƒí•  ë•Œ ë‹¤ë¥¸ ì„œë²„ ë˜ëŠ” ë…¸ë“œê°€ ëŒ€ì‹  ì²˜ë¦¬í•˜ë¯€ë¡œ ì¥ì•  ëŒ€ì‘ì´ íƒì›”
    - ë¶€í•˜ê°€ ë†’ì„ ê²½ìš°ì—ëŠ” ì‹œìŠ¤í…œ í™•ì¥ì´ ìš©ì´
- â—ì¹´í”„ì¹´ë„ ë¶„ì‚° ì‹œìŠ¤í…œ
    - ìµœì´ˆ êµ¬ì„±í•œ í´ëŸ¬ìŠ¤í„°ì˜ ë¦¬ì†ŒìŠ¤ê°€ í•œê³„ì¹˜ì— ë„ë‹¬í•´ ë”ìš± ë†’ì€ ë©”ì‹œì§€ ì²˜ë¦¬ëŸ‰ì´ í•„ìš”í•œ ê²½ìš°, ë¸Œë¡œì»¤ë¥¼ ì¶”ê°€í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í™•ì¥ì´ ê°€ëŠ¥í•˜ë‹¤.

<aside>
ğŸ’¡ ì¹´í”„ì¹´ì˜ ë§¤ìš° í° ì¥ì : í™•ì¥ì´ ìš©ì´í•˜ë‹¤.

</aside>

### 2-2. í˜ì´ì§€ ìºì‹œ

---

- í˜ì´ì§€ ìºì‹œì˜ ì´ìš©: ì¹´í”„ì¹´ëŠ” ë†’ì€ ì²˜ë¦¬ëŸ‰ì„ ì–»ê¸° ìœ„í•´ ëª‡ ê°€ì§€ ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆëŠ”ë°, ê·¸ì¤‘ ëŒ€í‘œì ì¸ ê²ƒ
    - OSì˜ í˜ì´ì§€ ìºì‹œë¥¼ í™œìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì„¤ê³„ë˜ì–´ ìˆë‹¤ â†’ í˜ì´ì§€ ìºì‹œë¥¼ í†µí•´ ì½ê³  ì“°ê¸°ë¥¼ í•œë‹¤.
- í˜ì´ì§€ ìºì‹œ: ì§ì ‘ ë””ìŠ¤í¬ì— ì½ê³  ì“°ëŠ” ëŒ€ì‹  ë¬¼ë¦¬ ë©”ëª¨ë¦¬ ì¤‘ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì¼ë¶€ ì”ì—¬ ë©”ëª¨ë¦¬ë¥¼ í™œìš©í•œë‹¤.
    - ë””ìŠ¤í¬ I/Oì— ëŒ€í•œ ì ‘ê·¼ì´ ì¤„ì–´ë“¤ë¯€ë¡œ ì„±ëŠ¥ì„ ë†’ì¼ ìˆ˜ ìˆë‹¤.
        
        ![Untitled](./images/3/Untitled%204.png)
        

### 2-3. ë°°ì¹˜ ì „ì†¡ ì²˜ë¦¬

---

- ìˆ˜ë§ì€ í†µì‹ ì„ ë¬¶ì–´ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤ë©´, ë‹¨ê±´ìœ¼ë¡œ í†µì‹ í•  ë•Œì— ë¹„í•´ ë„¤íŠ¸ì›Œí¬ ì˜¤ë²„í—¤ë“œë¥¼ ì¤„ì¼ ìˆ˜ ìˆì„ ë¿ë§Œ ì•„ë‹ˆë¼ ì¥ê¸°ì ìœ¼ë¡œëŠ” ë”ìš± ë¹ ë¥´ê³  íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´,
    - ìƒí’ˆì˜ ì¬ê³  ìˆ˜ëŸ‰ ì—…ë°ì´íŠ¸ ì‘ì—…ì€ ì§€ì—° ì—†ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì²˜ë¦¬ì•¼ í•˜ì§€ë§Œ,
    - êµ¬ë§¤ ë¡œê·¸ë¥¼ ì €ì¥ì†Œë¡œ ë³´ë‚´ëŠ” ì‘ì—…ì€ ì´ë¯¸ ë¡œê·¸ê°€ ì„œë²„ì— ê¸°ë¡ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì‹¤ì‹œê°„ ì²˜ë¦¬ë³´ë‹¤ëŠ” ë°°ì¹˜ ì²˜ë¦¬ë¥¼ ì´ìš©í•˜ëŠ” í¸ì´ íš¨ìœ¨ì ì¼ ê²ƒ
- ì¹´í”„ì¹´ì—ì„œëŠ” ì´ëŸ¬í•œ ì¥ì ì„ ì§€ë‹Œ ë°°ì¹˜ ì „ì†¡ì„ ê¶Œì¥í•œë‹¤.

### 2-4. ì••ì¶• ì „ì†¡

---

- ì¹´í”„ì¹´ëŠ” ë©”ì‹œì§€ ì „ì†¡ ì‹œ ì¢€ ë” ì„±ëŠ¥ì´ ë†’ì€ ì••ì¶• ì „ì†¡ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.
    - ì§€ì›í•˜ëŠ” ì••ì¶• íƒ€ì…ì€ `gzip`, `snappy`, `lz4`, `zstd` ë“±
- ì••ì¶•ë§Œìœ¼ë¡œë„ ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ì´ë‚˜ íšŒì„  ë¹„ìš©ì„ ì¤„ì¼ìˆ˜ ìˆë‹¤.
    - ë†’ì€ ì••ì¶•ë¥ ì´ í•„ìš”í•œ ê²½ìš°ë¼ë©´ `gzip`ì´ë‚˜ `zstd`ë¥¼ ê¶Œì¥
    - ë¹ ë¥¸ ì‘ë‹µ ì†ë„ê°€ í•„ìš”í•˜ë‹¤ë©´ `lz4`ë‚˜ `snappy`ë¥¼ ê¶Œì¥

### 2-5. í† í”½, íŒŒí‹°ì…˜, ì˜¤í”„ì…‹

---

- ì¹´í”„ì¹´ëŠ” í† í”½(topic)ì´ë¼ëŠ” ê³³ì— ë°ì´í„°ë¥¼ ì €ì¥
    - ë©”ì¼ ì „ì†¡ ì‹œìŠ¤í…œì—ì„œ ì´ë©”ì¼ ì£¼ì†Œ ì •ë„ì˜ ê°œë…

- í† í”½ì€ ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ìœ„í•´ ì—¬ëŸ¬ ê°œì˜ íŒŒí‹°ì…˜(partition)ì´ë¼ëŠ” ë‹¨ìœ„ë¡œ ë‹¤ì‹œ ë‚˜ë‰œë‹¤.
    - íŒŒí‹°ì…”ë‹ì„ í†µí•´ ë‹¨ í•˜ë‚˜ì˜ í† í”½ì´ë¼ë„ ë†’ì€ ì²˜ë¦¬ëŸ‰ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
- ì˜¤í”„ì…‹: íŒŒí‹°ì…˜ì˜ ë©”ì‹œì§€ê°€ ì €ì¥ë˜ëŠ” ìœ„ì¹˜
    - ìˆœì°¨ì ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” ìˆ«ì(64ë¹„íŠ¸ ì •ìˆ˜) í˜•íƒœë¡œ ë˜ì–´ ìˆë‹¤.
    
    ![3-6. íŒŒí‹°ì…˜ê³¼ ì˜¤í”„ì…‹([ì¶œì²˜](https://sookocheff.com/post/kafka/kafka-in-a-nutshell/))](./images/3/Untitled%205.png)
    
    3-6. íŒŒí‹°ì…˜ê³¼ ì˜¤í”„ì…‹([ì¶œì²˜](https://sookocheff.com/post/kafka/kafka-in-a-nutshell/))
    
    â†’ í•˜ë‚˜ì˜ í† í”½ì´ ì´ 3ê°œì˜ íŒŒí‹°ì…˜ìœ¼ë¡œ ë‚˜ë‰˜ë©° í”„ë¡œë“€ì„œë¡œë¶€í„° ì „ì†¡ë˜ëŠ” ë©”ì‹œì§€ë“¤ì˜ ì“°ê¸° ë™ì‘ì´ ê° íŒŒí‹°ì…˜ë³„ë¡œ ì´ë¤„ì§
    
    - ê° íŒŒí‹°ì…˜ë§ˆë‹¤ ìˆœì°¨ì ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” ìˆ«ìë“¤ â†’ ì˜¤í”„ì…‹
    - ê° íŒŒí‹°ì…˜ì—ì„œì˜ ì˜¤í”„ì…‹ì€ ê³ ìœ í•œ ìˆ«ì
- ì¹´í”„ì¹´ì—ì„œëŠ” ì˜¤í”„ì…‹ì„ í†µí•´ ë©”ì‹œì§€ì˜ ìˆœì„œë¥¼ ë³´ì¥í•˜ê³  ì»¨ìŠˆë¨¸ì—ì„œëŠ” ë§ˆì§€ë§‰ê¹Œì§€ ì½ì€ ìœ„ì¹˜ë¥¼ ì•Œ ìˆ˜ë„ ìˆë‹¤.

### 2-6. ê³ ê°€ìš©ì„± ë³´ì¥

---

- ê³ ê°€ìš©ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ ì¹´í”„ì¹´ì—ì„œëŠ” ë¦¬í”Œë¦¬ì¼€ì´ì…˜ ê¸°ëŠ¥ì„ ì œê³µ
    - í† í”½ ìì²´ë¥¼ ë³µì œí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í† í”½ì˜ íŒŒí‹°ì…˜ì„ ë³µì œí•˜ëŠ” ê²ƒ
    - í† í”½ì„ ìƒì„±í•  ë•Œ ì˜µì…˜ìœ¼ë¡œ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ íŒ©í„° ìˆ˜ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°, ì´ ìˆ«ìì— ë”°ë¼ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ë“¤ì´ ì¡´ì¬í•˜ê²Œ ëœë‹¤.
    - ë¦¬ë”(leader)ì™€ íŒ”ë¡œì›Œ(follower)

- íŒ”ë¡œì›Œì˜ ìˆ˜ë§Œí¼ ê²°êµ­ ë¸Œë¡œì»¤ì˜ ë””ìŠ¤í¬ ê³µê°„ë„ ì†Œë¹„ë˜ë¯€ë¡œ ì´ìƒì ì¸ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ íŒ©í„° ìˆ˜ë¥¼ ìœ ì§€í•´ì•¼ í•¨
    - ì¼ë°˜ì ìœ¼ë¡œ ì¹´í”„ì¹´ì—ì„œëŠ” ë¦¬í”Œë¦¬ì¼€ì´ì…˜ íŒ©í„° ìˆ˜ë¥¼ 3ìœ¼ë¡œ êµ¬ì„±í•˜ë„ë¡ ê¶Œì¥

- ë¦¬ë”: í”„ë¡œë“€ì„œ, ì»¨ìŠˆë¨¸ë¡œë¶€í„° ì˜¤ëŠ” ëª¨ë“  ì½ê¸°ì™€ ì“°ê¸° ìš”ì²­ì„ ì²˜ë¦¬
- íŒ”ë¡œì›Œ: ì˜¤ì§ ë¦¬ë”ë¡œë¶€í„° ë¦¬í”Œë¦¬ì¼€ì´ì…˜í•˜ê²Œ ëœë‹¤.

### 2-7. ì£¼í‚¤í¼ì˜ ì˜ì¡´ì„±

---

- ì£¼í‚¤í¼: ë§ì€ ë¶„ì‚° ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì½”ë””ë„¤ì´í„° ì—­í• ì„ í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì‚¬ìš©ë˜ê³  ìˆë‹¤.
    - ì—¬ëŸ¬ ëŒ€ì˜ ì„œë²„ë¥¼ ì•™ìƒë¸”(í´ëŸ¬ìŠ¤í„°)ë¡œ êµ¬ì„±í•˜ê³ , ì‚´ì•„ ìˆëŠ” ë…¸ë“œ ìˆ˜ê°€ ê³¼ë°˜ìˆ˜ ì´ìƒ ìœ ì§€ëœë‹¤ë©´ ì§€ì†ì ì¸ ì„œë¹„ìŠ¤ê°€ ê°€ëŠ¥í•œ êµ¬ì¡°
    - ë°˜ë“œì‹œ í™€ìˆ˜ë¡œ êµ¬ì„±í•´ì•¼ í•¨

- ì§€ë…¸ë“œ(znode)ë¥¼ ì´ìš©í•´ ì¹´í”„ì¹´ì˜ ë©”íƒ€ ì •ë³´ê°€ ì£¼í‚¤í¼ì— ê¸°ë¡ë˜ë©°, ì£¼í‚¤í¼ëŠ” ì´ëŸ¬í•œ ì§€ë…¸ë“œë¥¼ ì´ìš©í•´ ë¸Œë¡œì»¤ì˜ ë…¸ë“œ ê´€ë¦¬, í† í”½ ê´€ë¦¬, ì»¨íŠ¸ë¡¤ëŸ¬ ê´€ë¦¬ ë“± ë§¤ìš° ì¤‘ìš”í•œ ì—­í• ì„ í•˜ê³  ìˆë‹¤.
    - ìµœê·¼ ë“¤ì–´ ì¹´í”„ì¹´ê°€ ì ì  ì„±ì¥í•˜ë©´ì„œ ì£¼í‚¤í¼ ì„±ëŠ¥ì˜ í•œê³„ê°€ ë“œëŸ¬ë‚˜ê¸° ì‹œì‘

<aside>
ğŸ’¡ ì£¼í‚¤í¼: ì¹´í”„ì¹´ì˜ ì¤‘ìš”í•œ ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ê° ë¸Œë¡œì»¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ì¤‘ìš”í•œ ì—­í• ì„ í•˜ëŠ” ê²ƒ

</aside>

## 3. í”„ë¡œë“€ì„œì˜ ê¸°ë³¸ ë™ì‘ê³¼ ì˜ˆì œ ë§›ë³´ê¸°

---

- í”„ë¡œë“€ì„œ
    - ì¹´í”„ì¹´ì˜ í† í”½ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ëŠ”Â ì—­í• 
    - í”„ë¡œë“€ì„œëŠ” ì—¬ëŸ¬ ì˜µì…˜ì„ ì œê³µí•˜ë¯€ë¡œ, ì›í•˜ëŠ” í˜•íƒœì— ë”°ë¼ ì˜µì…˜ì„ ë³€ê²½í•˜ë©´ì„œ ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ì¹´í”„ì¹´ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆë‹¤.

### 3-1. í”„ë¡œë“€ì„œ ë””ìì¸

---

![3-7. í”„ë¡œë“€ì„œ ë””ìì¸ ê°œìš”([ì¶œì²˜](https://dzone.com/articles/take-a-deep-dive-into-kafka-producer-api))](./images/3/Untitled%206.png)

3-7. í”„ë¡œë“€ì„œ ë””ìì¸ ê°œìš”([ì¶œì²˜](https://dzone.com/articles/take-a-deep-dive-into-kafka-producer-api))

- ProducerRecordë¼ê³  í‘œì‹œëœ ë¶€ë¶„ì€ ì¹´í”„ì¹´ë¡œ ì „ì†¡í•˜ê¸° ìœ„í•œ ì‹¤ì œ ë°ì´í„°ì´ë©°, ë ˆì½”ë“œëŠ” í† í”½, íŒŒí‹°ì…˜, í‚¤, ë°¸ë¥˜ë¡œ êµ¬ì„±ëœë‹¤.
- í”„ë¡œë“€ì„œê°€ ì¹´í”„ì¹´ë¡œ ë ˆì½”ë“œë¥¼ ì „ì†¡í•  ë•Œ, ì¹´í”„ì¹´ì˜ íŠ¹ì • í† í”½ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œë‹¤.
- ë ˆì½”ë“œì—ì„œ í† í”½ê³¼ ë°¸ë¥˜(ë©”ì‹œì§€ ë‚´ìš©)ëŠ” í•„ìˆ«ê°’ì´ë©°, íŠ¹ì • íŒŒí‹°ì…˜ì„ ì§€ì •í•˜ê¸° ìœ„í•œ ë ˆì½”ë“œì˜ íŒŒí‹°ì…˜ê³¼ íŠ¹ì • íŒŒí‹°ì…˜ì— ë ˆì½”ë“œë“¤ì„ ì •ë ¬í•˜ê¸° ìœ„í•œ ë ˆì½”ë“œì˜ í‚¤ëŠ” í•„ìˆ«ê°’ì´ ì•„ë‹Œ ì„ íƒì‚¬í•­(ì˜µì…˜)ì´ë‹¤.
- ê° ë ˆì½”ë“œë“¤ì€ í”„ë¡œë“€ì„œì˜ send() ë©”ì†Œë“œë¥¼ í†µí•´ ì‹œë¦¬ì–¼ë¼ì´ì €(serializer), íŒŒí‹°ì…”ë„ˆ(partitioner)ë¥¼ ê±°ì¹˜ê²Œ ëœë‹¤.
- ë§Œì•½ í”„ë¡œë“€ì„œ ë ˆì½”ë“œì˜ ì„ íƒì‚¬í•­ì¸ íŒŒí‹°ì…˜ì„ ì§€ì •í–ˆë‹¤ë©´, íŒŒí‹°ì…”ë„ˆëŠ” ì•„ë¬´ ë™ì‘ë„ í•˜ì§€ ì•Šê³  ì§€ì •ëœ íŒŒí‹°ì…˜ìœ¼ë¡œ ë ˆì½”ë“œë¥¼ ì „ë‹¬í•œë‹¤.
    - íŒŒí‹°ì…˜ì„ ì§€ì •í•˜ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” í‚¤ë¥¼ ê°€ì§€ê³  íŒŒí‹°ì…˜ì„ ì„ íƒí•´ ë ˆì½”ë“œë¥¼ ì „ë‹¬í•˜ëŠ”ë°, ê¸°ë³¸ì ìœ¼ë¡œ ë¼ìš´ë“œ ë¡œë¹ˆ(round robin) ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤.
- í”„ë¡œë“€ì„œ ë‚´ë¶€ì—ì„œëŠ” send() ë©”ì†Œë“œ ë™ì‘ ì´í›„ ë ˆì½”ë“œë“¤ì„ íŒŒí‹°ì…˜ë³„ë¡œ ì ì‹œ ëª¨ì•„ë‘ê²Œ ëœë‹¤.
    - ë ˆì½”ë“œë¥¼ ëª¨ì•„ë‘ëŠ” ì´ìœ ëŠ” í”„ë¡œë“€ì„œê°€ ì¹´í”„ì¹´ë¡œ ì „ì†¡í•˜ê¸° ì „,Â ë°°ì¹˜ ì „ì†¡ì„ í•˜ê¸° ìœ„í•¨ì´ë‹¤.
- ì „ì†¡ì´ ì‹¤íŒ¨í•˜ë©´ ì¬ì‹œë„ ë™ì‘ì´ ì´ë¤„ì§€ê³ , ì§€ì •ëœ íšŸìˆ˜ë§Œí¼ì˜ ì¬ì‹œë„ê°€ ì‹¤íŒ¨í•˜ë©´ ìµœì¢… ì‹¤íŒ¨ë¥¼ ì „ë‹¬í•˜ë©°, ì „ì†¡ì´ ì„±ê³µí•˜ë©´ ë©”íƒ€ë°ì´í„°ë¥¼ ë¦¬í„´í•˜ê²Œ ëœë‹¤.

### 3-2. í”„ë¡œë“€ì„œì˜ ì£¼ìš” ì˜µì…˜

---

- `bootstrap.servers`
    - ì¹´í”„ì¹´ í´ëŸ¬ìŠ¤í„°ëŠ” í´ëŸ¬ìŠ¤í„° ë§ˆìŠ¤í„°ë¼ëŠ” ê°œë…ì´ ì—†ìœ¼ë¯€ë¡œ, í´ëŸ¬ìŠ¤í„° ë‚´ ëª¨ë“  ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. í´ë¼ì´ì–¸íŠ¸ê°€ ì¹´í”„ì¹´ í´ëŸ¬ìŠ¤í„°ì— ì²˜ìŒ ì—°ê²°í•˜ê¸° ìœ„í•œ í˜¸ìŠ¤íŠ¸ì™€ í¬íŠ¸ ì •ë³´ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.
- `client.dns.lookup`
    - í•˜ë‚˜ì˜ í˜¸ìŠ¤íŠ¸ì— ì—¬ëŸ¬ IPë¥¼ ë§¤í•‘í•´ ì‚¬ìš©í•˜ëŠ” ì¼ë¶€ í™˜ê²½ì—ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ í•˜ë‚˜ì˜ IPì™€ ì—°ê²°í•˜ì§€ ëª»í•  ê²½ìš°ì— ë‹¤ë¥¸ IPë¡œ ì‹œë„í•˜ëŠ” ì„¤ì •ì´ë‹¤. `use_all_dns_ips`ê°€ ê¸°ë³¸ê°’ìœ¼ë¡œ, DNSì— í• ë‹¹ëœ í˜¸ìŠ¤íŠ¸ì˜ ëª¨ë“  IPë¥¼ ì¿¼ë¦¬í•˜ê³  ì €ì¥í•œë‹¤. ì²« ë²ˆì§¸ IPë¡œ ì ‘ê·¼ì´ ì‹¤íŒ¨í•˜ë©´, ì¢…ë£Œí•˜ì§€ ì•Šê³  ë‹¤ìŒ IPë¡œ ì ‘ê·¼ì„ ì‹œë„í•œë‹¤. `resolve_canonical_bootstrap_servers_only` ì˜µì…˜ì€ ì»¤ë²„ë¡œìŠ¤(Kerberos) í™˜ê²½ì—ì„œ FQDNì„ ì–»ê¸° ìœ„í•œ ìš©ë„ë¡œ ì‚¬ìš©ëœë‹¤.
- `acks`
    - í”„ë¡œë“€ì„œê°€ ì¹´í”„ì¹´ í† í”½ì˜ ë¦¬ë” ì¸¡ì— ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œ í›„ ìš”ì²­ì„ ì™„ë£Œí•˜ê¸°ë¥¼ ê²°ì •í•˜ëŠ” ì˜µì…˜ì´ë‹¤. `0`, `1`, `all`(-1)ë¡œ í‘œí˜„í•˜ë©°, `0`ì€ ë¹ ë¥¸ ì „ì†¡ì„ ì˜ë¯¸í•˜ì§€ë§Œ, ì¼ë¶€ ë©”ì‹œì§€ ì†ì‹¤ ê°€ëŠ¥ì„±ì´ ìˆë‹¤. `1`ì€ ë¦¬ë”ê°€ ë©”ì‹œì§€ë¥¼ ë°›ì•˜ëŠ”ì§€ í™•ì¸í•˜ì§€ë§Œ, ëª¨ë“  íŒ”ë¡œì›Œë¥¼ ì „ë¶€ í™•ì¸í•˜ì§€ëŠ” ì•Šë‹¤. ëŒ€ë¶€ë¶„ ê¸°ë³¸ê°’ìœ¼ë¡œ `1`ì„ ì‚¬ìš©í•œë‹¤. `all`ì€ íŒ”ë¡œì›Œê°€ ë©”ì‹œì§€ë¥¼ ë°›ì•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤. ë‹¤ì†Œ ëŠë¦´ ìˆ˜ëŠ” ìˆì§€ë§Œ, í•˜ë‚˜ì˜ íŒ”ë¡œì›Œê°€ ìˆëŠ” í•œ ë©”ì‹œì§€ëŠ” ì†ì‹¤ë˜ì§€ ì•ŠëŠ”ë‹¤.
- `buffer.memory`
    - í”„ë¡œë“€ì„œê°€ ì¹´í”„ì¹´ ì„œë²„ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ê¸° ìœ„í•´ ì ì‹œ ëŒ€ê¸°(ë°°ì¹˜ ì „ì†¡ì´ë‚˜ ë”œë ˆì´ ë“±)í•  ìˆ˜ ìˆëŠ” ì „ì²´ ë©”ëª¨ë¦¬ ë°”ì´íŠ¸(byte)ì´ë‹¤.
- `compression.type`
    - í”„ë¡œë“€ì„œê°€ ë©”ì‹œì§€ ì „ì†¡ ì‹œ ì„ íƒí•  ìˆ˜ ìˆëŠ” ì••ì¶• íƒ€ì…ì´ë‹¤. `none`, `gzip`, `snappy`, `lz4`, `zstd` ì¤‘ ì›í•˜ëŠ” íƒ€ì…ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤.
- `enable.idempotence`
    - ì„¤ì •ì„ `true`ë¡œ í•˜ëŠ” ê²½ìš° ì¤‘ë³µ ì—†ëŠ” ì „ì†¡ì´ ê°€ëŠ¥í•˜ë©°, ì´ì™€ ë™ì‹œì— `max.in.flight.requests.per.connection`ì€ 5 ì´í•˜, `retries`ëŠ” 0 ì´ìƒ, `acks`ëŠ” all ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.
- `max.in.flight.requests.per.connection`
    - í•˜ë‚˜ì˜ ì»¤ë„¥ì…˜ì—ì„œ í”„ë¡œë“€ì„œê°€ ìµœëŒ€í•œ ACK ì—†ì´ ì „ì†¡í•  ìˆ˜ ìˆëŠ” ìš”ì²­ ìˆ˜ì´ë‹¤. ë©”ì‹œì§€ì˜ ìˆœì„œê°€ ì¤‘ìš”í•˜ë‹¤ë©´ 1ë¡œ ì„¤ì •í•  ê²ƒì„ ê¶Œì¥í•˜ì§€ë§Œ, ì„±ëŠ¥ì€ ë‹¤ì†Œ ë–¨ì–´ì§„ë‹¤.
- `retries`
    - ì¼ì‹œì ì¸ ì˜¤ë¥˜ë¡œ ì¸í•´ ì „ì†¡ì— ì‹¤íŒ¨í•œ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë³´ë‚´ëŠ” íšŸìˆ˜ì´ë‹¤.
- `batch.size`
    - í”„ë¡œë“€ì„œëŠ” ë™ì¼í•œ íŒŒí‹°ì…˜ìœ¼ë¡œ ë³´ë‚´ëŠ” ì—¬ëŸ¬ ë°ì´í„°ë¥¼ í•¨ê»˜ ë°°ì¹˜ë¡œ ë³´ë‚´ë ¤ê³  ì‹œë„í•œë‹¤. ì ì ˆí•œ ë°°ì¹˜ í¬ê¸° ì„¤ì •ì€ ì„±ëŠ¥ì— ë„ì›€ì„ ì¤€ë‹¤.
- `linger.ms`
    - ë°°ì¹˜ í˜•íƒœì˜ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê¸° ì „ì— ì¶”ê°€ì ì¸ ë©”ì‹œì§€ë¥¼ ìœ„í•´ ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„ì„ ì¡°ì •í•˜ê³ , ë°°ì¹˜ í¬ê¸°ì— ë„ë‹¬í•˜ì§€ ëª»í•œ ìƒí™©ì—ì„œ `linger.ms` ì œí•œ ì‹œê°„ì— ë„ë‹¬í–ˆì„ ë•Œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œë‹¤.
- `transactional.id`
    - â€˜ì •í™•íˆ í•œ ë²ˆ ì „ì†¡â€™ì„ ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ì˜µì…˜ì´ë©°, ë™ì¼í•œ `TransactionalId`ì— í•œí•´ ì •í™•íˆ í•œ ë²ˆì„ ë³´ì¥í•œë‹¤. ì˜µì…˜ì„ ì‚¬ìš©í•˜ê¸° ì „ `enable.idempotence`ë¥¼ `true`ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.

### 3-3. í”„ë¡œë“€ì„œ ì˜ˆì œ

---

- í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ ì´ìš©í•´ í”„ë¡œë“€ì„œë¥¼ ë§Œë“¤ì–´ ì „ì†¡í•˜ëŠ” ë°©ë²• (ìë°”)

- `kafka-topics.sh` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•´ peter-basic01 í† í”½ì„ ë¯¸ë¦¬ ìƒì„±í•œë‹¤.
    
    ```bash
    /usr/local/kafka/bin/kafka-topics.sh --bootstrap-server peter-kafka01.foo.bar:9092 --create --topic peter-basic01 --partitions 1 --replication-factor 3
    ```
    
    - ë‚˜: `kafka-topics --bootstrap-server kafka1:9091 --create --topic peter-basic01 --partitions 1 --replication-factor 3`
- í”„ë¡œë“€ì„œì˜ ì „ì†¡ ë°©ë²•ì€ ì„¸ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ í¬ê²Œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤.
    - 1ï¸âƒ£Â ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê³  í™•ì¸í•˜ì§€ ì•Šê¸° ì˜ˆì œ â†’ ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì¶”ì²œx
        
        ```java
        package com.jenny.kafka;
        
        import org.apache.kafka.clients.producer.KafkaProducer;
        import org.apache.kafka.clients.producer.Producer;
        import org.apache.kafka.clients.producer.ProducerRecord;
        
        import java.util.Properties;
        
        public class ProducerFireForgot {
            public static void main(String[] args) {
        
                // 1. Properties ê°ì²´ ìƒì„±
                Properties props = new Properties();
                // 2. ë¸Œë¡œì»¤ ë¦¬ìŠ¤íŠ¸ ì •ì˜
                props.put("bootstrap.servers", "kafka1:9091,kafka2:9092,kafka3:9093");
        //        props.put("bootstrap.servers","peter-kafka01.foo.bar:9092,peter-kafka02.foo.bar:9092,peter-kafka03.foo
        //        .bar:9092");
        
                // 3. ë©”ì‹œì§€ í‚¤ì™€ ë°¸ë¥˜ëŠ” ë¬¸ìì—´ íƒ€ì…ì´ë¯€ë¡œ ì¹´í”„ì¹´ì˜ ê¸°ë³¸ StringSerializerë¥¼ ì§€ì •
                // Recordì˜ keyì™€ valueëŠ” ë¬¸ìì´ê¸° ë•Œë¬¸ì— ì „ì†¡ì‹œ byteë¡œ ë³€í™˜í•´ì•¼í•œë‹¤.
                props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");
                props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");
        
                // 4. Properties ê°ì²´ë¥¼ ì „ë‹¬í•´ ìƒˆ í”„ë¡œë“€ì„œ ìƒì„±
                Producer<String, String> producer = new KafkaProducer<>(props);
        
                try {
                    for (int i = 0; i < 3; i++) {
                        // 5. ProducerRecord ê°ì²´ ìƒì„±
                        ProducerRecord<String, String> record = new ProducerRecord<>("peter-overview01",//"peter-basic01",
                                "Apache kafka is a distributed streaming platform - " + i);
                        // 6. send() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œ í›„ ìë°” Future ê°ì²´ë¡œ RecordMetadataë¥¼ ë¦¬í„´ë°›ì§€ë§Œ,
                        // ë¦¬í„´ê°’ì„ ë¬´ì‹œí•˜ë¯€ë¡œ ë©”ì‹œì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ëëŠ”ì§€ ì•Œ ìˆ˜ ì—†ìŒ
                        producer.send(record);
                    }
                } catch (Exception e) {
                    // 7. ì¹´í”„ì¹´ ë¸Œë¡œì»¤ì—ê²Œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œ í›„ì˜ ì—ëŸ¬ëŠ” ë¬´ì‹œí•˜ì§€ë§Œ, ì „ì†¡ ì „ì— ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ
                    e.printStackTrace();
                } finally {
                    // 8. í”„ë¡œë“€ì„œ ì¢…ë£Œ
                    producer.close();
                }
            }
        }
        ```
        
        - í”„ë¡œë“€ì„œì—ì„œ ì¹´í”„ì¹´ì˜ í† í”½ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ê³  ë‚œ í›„ ì„±ê³µì ìœ¼ë¡œ ë„ì°©í–ˆëŠ”ì§€ í™•ì¸í•˜ì§€ ì•ŠëŠ” ì˜ˆì œ
        - í˜¸ìŠ¤íŠ¸ â†’ ì»¨í…Œì´ë„ˆ ë¡œ JAR íŒŒì¼ ë³µì‚¬
            
            ```bash
            docker cp /Users/kim-yoonhee/IdeaProjects/kafka-study/build/libs/kafka-study-1.0-SNAPSHOT.jar fc32b4a9dc71:/
            ```
            
        - JaríŒŒì¼ì„ ì‹¤í–‰í•´ì„œ peter-overview01ë¡œ 3ê°œì˜ Recordë¥¼ ì „ì†¡í•œë‹¤.
            - java -cp kafka-study-1.0-SNAPSHOT.jar com.jenny.kafka.ProducerFireForgot
            
            ![Untitled](./images/3/Untitled%207.png)
            
        - Consumerì—ì„œ ì„±ê³µì ìœ¼ë¡œ 3ê±´ì˜ ë°ì´í„°ë¥¼ pullí•œë‹¤.
            
            ![Untitled](./images/3/Untitled%208.png)
            
            ![Untitled](./images/3/Untitled%209.png)
            
            ![Untitled](./images/3/Untitled%2010.png)
            
    - 2ï¸âƒ£Â ë™ê¸° ì „ì†¡ â†’ ì „ì†¡ì´ ì„±ê³µí•˜ê³  ë‚˜ë©´ RecordMetadataë¥¼ ì½ì–´ ë“¤ì—¬ íŒŒí‹°ì…˜ê³¼ ì˜¤í”„ì…‹ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, ì´ ë°©ë²•ìœ¼ë¡œ ë©”ì‹œì§€ ì „ë‹¬ì˜ ì„±ê³µ ì—¬ë¶€ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.
        
        ```java
        package com.jenny.kafka;
        
        import org.apache.kafka.clients.producer.KafkaProducer;
        import org.apache.kafka.clients.producer.Producer;
        import org.apache.kafka.clients.producer.ProducerRecord;
        import org.apache.kafka.clients.producer.RecordMetadata;
        
        import java.util.Properties;
        
        public class ProducerSync {
            public static void main(String[] args) {
                // 1. Properties ê°ì²´ ìƒì„±
                Properties props = new Properties();
                // 2. ë¸Œë¡œì»¤ ë¦¬ìŠ¤íŠ¸ ì •ì˜
                props.put("bootstrap.servers", "kafka1:9091,kafka2:9092,kafka3:9093");
                // 3. ë©”ì‹œì§€ í‚¤ì™€ ë°¸ë¥˜ëŠ” ë¬¸ìì—´ íƒ€ì…ì´ë¯€ë¡œ ì¹´í”„ì¹´ì˜ ê¸°ë³¸ StringSerializerë¥¼ ì§€ì •
                props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");
                props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");
        
                // 4. Properties ê°ì²´ë¥¼ ì „ë‹¬í•´ ìƒˆ í”„ë¡œë“€ì„œ ìƒì„±
                Producer<String, String> producer = new KafkaProducer<>(props);
        
                try {
                    for (int i = 0; i < 3; i++) {
                        // 5. ProducerRecord ê°ì²´ ìƒì„±
                        ProducerRecord<String, String> record = new ProducerRecord<>("peter-overview01", "Apache Kafka is a " +
                                "distributed streaming platform - " + i);
                        // 6. get() ë©”ì†Œë“œë¥¼ ì´ìš©í•´ ì¹´í”„ì¹´ì˜ ì‘ë‹µì„ ê¸°ë‹¤ë¦¼
                        // ë©”ì‹œì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì§€ ì•Šìœ¼ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•˜ê³ , ì—ëŸ¬ê°€ ì—†ë‹¤ë©´ RecordMetadataë¥¼ ì–»ìŒ
                        RecordMetadata metadata = producer.send(record).get();
                        System.out.printf("Topic: %s, Partition: %d, Offset: %d, Key: %s, Received Message: %s\n", metadata.topic(), metadata.partition()
                                , metadata.offset(), record.key(), record.value());
                    }
                } catch (Exception e) {
                    // 7. ì¹´í”„ì¹´ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê¸° ì „ê³¼ ë³´ë‚´ëŠ” ë™ì•ˆ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•¨
                    e.printStackTrace();
                } finally {
                    // 8. í”„ë¡œë“€ì„œ ì¢…ë£Œ
                    producer.close();
                }
            }
        }
        ```
        
        - JaríŒŒì¼ì„ ì‹¤í–‰í•´ì„œ peter-overview01ë¡œ 3ê°œì˜ Recordë¥¼ ì „ì†¡í•œë‹¤.
            
            ![Untitled](./images/3/Untitled%2011.png)
            
        - Consumerì—ì„œ ì„±ê³µì ìœ¼ë¡œ 3ê±´ì˜ ë°ì´í„°ë¥¼ pullí•œë‹¤.
        - í”„ë¡œë“€ì„œëŠ” ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê³  send() ë©”ì†Œë“œì˜ `Future` ê°ì²´ë¥¼ ë¦¬í„´
        - get() ë©”ì†Œë“œë¥¼ ì´ìš©í•´ `Future`ë¥¼ ê¸°ë‹¤ë¦° í›„ send()ê°€ ì„±ê³µí–ˆëŠ”ì§€ ì‹¤íŒ¨í–ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤.
    - 3ï¸âƒ£Â ë¹„ë™ê¸° ì „ì†¡ â†’ í”„ë¡œë“€ì„œëŠ” send() ë©”ì†Œë“œì™€ ì½œë°±ì„ í•¨ê»˜ í˜¸ì¶œ
        
        ```java
        package com.jenny.kafka;
        
        import org.apache.kafka.clients.producer.Callback;
        import org.apache.kafka.clients.producer.ProducerRecord;
        import org.apache.kafka.clients.producer.RecordMetadata;
        
        // 1. ì½œë°±ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ org.apache.kafka.clients.producer.Callbackì„ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ê°€ í•„ìš”í•¨
        public class PeterProducerCallback implements Callback {
            private ProducerRecord<String, String> record;
        
            public PeterProducerCallback(ProducerRecord<String, String> record) {
                this.record = record;
            }
        
            @Override
            public void onCompletion(RecordMetadata metadata, Exception e) {
                if (e != null) {
                    // 2. ì¹´í”„ì¹´ê°€ ì˜¤ë¥˜ë¥¼ ë¦¬í„´í•˜ë©´ onCompletion()ì€ ì˜ˆì™¸ë¥¼ ê°–ê²Œ ë˜ë©°, ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì¶”ê°€ì ì¸ ì˜ˆì™¸ ì²˜ë¦¬ê°€ í•„ìš”í•¨
                    e.printStackTrace();
                } else {
                    System.out.printf("Topic: %s, Partition: %d, Offset: %d, Key: %s, Received Message: %s\n", metadata.topic(), metadata.partition()
                            , metadata.offset(), record.key(), record.value());
                }
            }
        }
        ```
        
        ```java
        package com.jenny.kafka;
        
        import org.apache.kafka.clients.producer.KafkaProducer;
        import org.apache.kafka.clients.producer.Producer;
        import org.apache.kafka.clients.producer.ProducerRecord;
        
        import java.util.Properties;
        
        public class ProducerAsync {
            public static void main(String[] args) {
                // 1. Properties ê°ì²´ ìƒì„±
                Properties props = new Properties();
                // 2. ë¸Œë¡œì»¤ ë¦¬ìŠ¤íŠ¸ ì •ì˜
                props.put("bootstrap.servers", "kafka1:9091,kafka2:9092,kafka3:9093");
                // 3. ë©”ì‹œì§€ í‚¤ì™€ ë°¸ë¥˜ëŠ” ë¬¸ìì—´ íƒ€ì…ì´ë¯€ë¡œ ì¹´í”„ì¹´ì˜ ê¸°ë³¸ StringSerializerë¥¼ ì§€ì •
                props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");
                props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");
        
                // 4. Properties ê°ì²´ë¥¼ ì „ë‹¬í•´ ìƒˆ í”„ë¡œë“€ì„œ ìƒì„±
                Producer<String, String> producer = new KafkaProducer<>(props);
        
                try {
                    for (int i = 0; i < 3; i++) {
                        // 5. ProducerRecord ê°ì²´ ìƒì„±
                        ProducerRecord<String, String> record = new ProducerRecord<>("peter-overview01", "Apache Kafka is a distributed streaming platform - " + i); //ProducerRecord ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                        // 6. í”„ë¡œë“€ì„œì—ì„œ ë ˆì½”ë“œë¥¼ ë³´ë‚¼ ë•Œ ì½œë°± ì˜¤ë¸Œì íŠ¸ë¥¼ ê°™ì´ ë³´ëƒ„
                        producer.send(record, new PeterProducerCallback(record));
                    }
                } catch (Exception e) {
                    e.printStackTrace();
                } finally {
                    // 7. í”„ë¡œë“€ì„œ ì¢…ë£Œ
                    producer.close();
                }
            }
        }
        ```
        
        - JaríŒŒì¼ì„ ì‹¤í–‰í•´ì„œ peter-overview01ë¡œ 3ê°œì˜ Recordë¥¼ ì „ì†¡í•œë‹¤.
            
            ![Untitled](./images/3/Untitled%2012.png)
            
        - Consumerì—ì„œ ì„±ê³µì ìœ¼ë¡œ 3ê±´ì˜ ë°ì´í„°ë¥¼ pullí•œë‹¤.
            
            ![Untitled](./images/3/Untitled%2013.png)
            
            ![Untitled](./images/3/Untitled%2014.png)
            
            ![Untitled](./images/3/Untitled%2015.png)
            
        - ë¹„ë™ê¸° ë°©ì‹ìœ¼ë¡œ ì „ì†¡í•˜ë©´ ë¹ ë¥¸ ì „ì†¡ì´ ê°€ëŠ¥í•˜ê³ , ë©”ì‹œì§€ ì „ì†¡ì´ ì‹¤íŒ¨í•œ ê²½ìš°ë¼ë„ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆì–´ì„œ ì´í›„ ì—ëŸ¬ ë¡œê·¸ ë“±ì— ê¸°ë¡í•  ìˆ˜ë„ ìˆë‹¤.

## 4. ì»¨ìŠˆë¨¸ì˜ ê¸°ë³¸ ë™ì‘ê³¼ ì˜ˆì œ ë§›ë³´ê¸°

---

- ì»¨ìŠˆë¨¸
    - ì¹´í”„ì¹´ì˜ í† í”½ì— ì €ì¥ë˜ì–´ ìˆëŠ” ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì—­í• 
    - ë‚´ë¶€ì ìœ¼ë¡œëŠ” ì»¨ìŠˆë¨¸ ê·¸ë£¹, ë¦¬ë°¸ëŸ°ì‹± ë“± ì—¬ëŸ¬ ë™ì‘ì„ ìˆ˜í–‰í•œë‹¤.

### 4-1. ì»¨ìŠˆë¨¸ì˜ ê¸°ë³¸ ë™ì‘

---

- í”„ë¡œë“€ì„œê°€ ì¹´í”„ì¹´ì˜ í† í”½ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ë©´ í•´ë‹¹ ë©”ì‹œì§€ë“¤ì€ ë¸Œë¡œì»¤ë“¤ì˜ ë¡œì»¬ ë””ìŠ¤í¬ì— ì €ì¥ëœë‹¤.
    - ì»¨ìŠˆë¨¸ë¥¼ ì´ìš©í•´ í† í”½ì— ì €ì¥ëœ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

- ì»¨ìŠˆë¨¸ ê·¸ë£¹: í•˜ë‚˜ ì´ìƒì˜ ì»¨ìŠˆë¨¸ë“¤ì´ ëª¨ì—¬ ìˆëŠ” ê·¸ë£¹
    - ì»¨ìŠˆë¨¸ëŠ” ë°˜ë“œì‹œ ì»¨ìŠˆë¨¸ ê·¸ë£¹ì— ì†í•˜ê²Œ ëœë‹¤.
    - ì»¨ìŠˆë¨¸ ê·¸ë£¹ì€ ê° íŒŒí‹°ì…˜ì˜ ë¦¬ë”ì—ê²Œ ì¹´í”„ì¹´ í† í”½ì— ì €ì¥ëœ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
    - íŒŒí‹°ì…˜ ìˆ˜ì™€ ì»¨ìŠˆë¨¸ ìˆ˜(í•˜ë‚˜ì˜ ì»¨ìŠˆë¨¸ ê·¸ë£¹ ì•ˆì— ìˆëŠ” ì»¨ìŠˆë¨¸ ìˆ˜)ëŠ” ì¼ëŒ€ì¼ë¡œ ë§¤í•‘ë˜ëŠ” ê²ƒì´ ì´ìƒì 
        - íŒŒí‹°ì…˜ ìˆ˜ë³´ë‹¤ ì»¨ìŠˆë¨¸ ìˆ˜ê°€ ë§ê²Œ êµ¬í˜„ë˜ëŠ” ê²ƒì€ ë°”ëŒì§í•œ êµ¬ì„±ì€ ì•„ë‹ˆë‹¤.
        - ë” ë§ì€ ìˆ˜ì˜ ì»¨ìŠˆë¨¸ë“¤ì´ ê·¸ëƒ¥ ëŒ€ê¸° ìƒíƒœë¡œë§Œ ì¡´ì¬í•˜ê¸° ë•Œë¬¸

- ì»¨ìŠˆë¨¸ ê·¸ë£¹ ë‚´ì—ì„œ ë¦¬ë°¸ëŸ°ì‹± ë™ì‘ì„ í†µí•´ ì¥ì• ê°€ ë°œìƒí•œ ì»¨ìŠˆë¨¸ì˜ ì—­í• ì„ ë™ì¼í•œ ê·¸ë£¹ì— ìˆëŠ” ë‹¤ë¥¸ ì»¨ìŠˆë¨¸ê°€ ê·¸ ì—­í• ì„ ëŒ€ì‹  ìˆ˜í–‰
    - ì¥ì•  ëŒ€ë¹„ë¥¼ ìœ„í•œ ì¶”ê°€ ì»¨ìŠˆë¨¸ ë¦¬ì†ŒìŠ¤ë¥¼ í• ë‹¹í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

### 4-2. ì»¨ìŠˆë¨¸ì˜ ì£¼ìš” ì˜µì…˜

---

- `bootstrap.servers`
    - í”„ë¡œë“€ì„œì™€ ë™ì¼í•˜ê²Œ ë¸Œë¡œì»¤ì˜ ì •ë³´ë¥¼ ì…ë ¥í•œë‹¤.
- `fetch.min.bytes`
    - í•œ ë²ˆì— ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ìµœì†Œ ë°ì´í„° í¬ê¸°ì´ë‹¤. ë§Œì•½ ì§€ì •í•œ í¬ê¸° ë³´ë‹¤ ì‘ì€ ê²½ìš°, ìš”ì²­ì— ì‘ë‹µí•˜ì§€ ì•Šê³  ë°ì´í„°ê°€ ëˆ„ì ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.
- `group.id`
    - ì»¨ìŠˆë¨¸ê°€ ì†í•œ ì»¨ìŠˆë¨¸ ê·¸ë£¹ì„ ì‹ë³„í•˜ëŠ” ì‹ë³„ìì´ë‹¤. ë™ì¼í•œ ê·¸ë£¹ ë‚´ì˜ ì»¨ìŠˆë¨¸ ì •ë³´ëŠ” ëª¨ë‘ ê³µìœ ëœë‹¤.
- `heartbeat.interval.ms`
    - í•˜íŠ¸ë¹„íŠ¸ê°€ ìˆë‹¤ëŠ” ê²ƒì€ ì»¨ìŠˆë¨¸ì˜ ìƒíƒœê°€ activeì„ì„ ì˜ë¯¸í•œë‹¤. `session.timeout.ms`ì™€ ë°€ì ‘í•œ ê´€ê³„ê°€ ìˆìœ¼ë©°, `session.timeout.ms`ë³´ë‹¤ ë‚®ì€ ê°’ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤. ì¼ë°˜ì ìœ¼ë¡œ `session.timeout.ms`ì˜ 1/3ë¡œ ì„¤ì •í•œë‹¤.
- `max.partition.fetch.bytes`
    - íŒŒí‹°ì…˜ë‹¹ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ìµœëŒ€ í¬ê¸°ë¥¼ ì˜ë¯¸í•œë‹¤.
- `session.timeout.ms`
    - ì´ ì‹œê°„ì„ ì´ìš©í•´, ì»¨ìŠˆë¨¸ê°€ ì¢…ë£Œëœ ê²ƒì¸ì§€ë¥¼ íŒë‹¨í•œë‹¤. ì»¨ìŠˆë¨¸ëŠ” ì£¼ê¸°ì ìœ¼ë¡œ í•˜íŠ¸ë¹„íŠ¸ë¥¼ ë³´ë‚´ì•¼ í•˜ê³ , ë§Œì•½ ì´ ì‹œê°„ ì „ê¹Œì§€ í•˜íŠ¸ë¹„íŠ¸ ë¥¼ ë³´ë‚´ì§€ ì•Šì•˜ë‹¤ë©´ í•´ë‹¹ ì»¨ìŠˆë¨¸ëŠ” ì¢…ë£Œëœ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ê³  ì»¨ìŠˆë¨¸ ê·¸ë£¹ì—ì„œ ì œì™¸í•˜ê³  ë¦¬ë°¸ëŸ°ì‹±ì„ ì‹œì‘í•œë‹¤.
- `enable.auto.commit`
    - ë°±ê·¸ë¼ìš´ë“œë¡œ ì£¼ê¸°ì ìœ¼ë¡œ ì˜¤í”„ì…‹ì„ ì»¤ë°‹í•œë‹¤.
- `auto.offset.reset`
    - ì¹´í”„ì¹´ì—ì„œ ì´ˆê¸° ì˜¤í”„ì…‹ì´ ì—†ê±°ë‚˜ í˜„ì¬ ì˜¤í”„ì…‹ì´ ë” ì´ìƒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì— ë‹¤ìŒ ì˜µì…˜ìœ¼ë¡œ resetë‹¤.
        - `earliest`: ê°€ì¥ ì´ˆê¸°ì˜ ì˜¤í”„ì…‹ê°’ìœ¼ë¡œ ì„¤ì •í•œë‹¤.
        - `latest`: ê°€ì¥ ë§ˆì§€ë§‰ì˜ ì˜¤í”„ì…‹ê°’ìœ¼ë¡œ ì„¤ì •í•œë‹¤.
        - `none`: ì´ì „ ì˜¤í”„ì…‹ê°’ì„ ì°¾ì§€ ëª»í•˜ë©´ ì—ëŸ¬ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.
- `fetch.max.bytes`
    - í•œ ë²ˆì˜ ê°€ì ¸ì˜¤ê¸° ìš”ì²­ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ìµœëŒ€ í¬ê¸°ì´ë‹¤.
- `group.instance.id`
    - ì»¨ìŠˆë¨¸ì˜ ê³ ìœ í•œ ì‹ë³„ìì´ë‹¤. ë§Œì•½ ì„¤ì •í•œë‹¤ë©´ static ë©¤ë²„ë¡œ ê°„ì£¼ë˜ì–´, ë¶ˆí•„ìš”í•œ ë¦¬ë°¸ëŸ°ì‹±ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `isolation.level`
    - íŠ¸ëœì­ì…˜ ì»¨ìŠˆë¨¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì˜µì…˜ìœ¼ë¡œ, `read_uncommitted`ëŠ” ê¸°ë³¸ê°’ìœ¼ë¡œ ëª¨ë“  ë©”ì‹œì§€ë¥¼ ì½ê³ , `read_committed`ëŠ” íŠ¸ëœì­ì…˜ì´ ì™„ë£Œëœ ë©”ì‹œì§€ë§Œ ì½ëŠ”ë‹¤.
- `max.poll.records`
    - í•œ ë²ˆì˜ poll()ìš”ì²­ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ìµœëŒ€ ë©”ì‹œì§€ ìˆ˜ì´ë‹¤.
- `partition.assignment.strategy`
    - íŒŒí‹°ì…˜ í• ë‹¹ ì „ëµì´ë©°, ê¸°ë³¸ê°’ì€ `range`ì´ë‹¤.
- `fetch.max.wait.ms`
    - `fetch.min.bytes`ì— ì˜í•´ ì„¤ì •ëœ ë°ì´í„°ë³´ë‹¤ ì ì€ ê²½ìš° ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ìµœëŒ€ ì‹œê°„ì´ë‹¤.

### 4-3. ì»¨ìŠˆë¨¸ ì˜ˆì œ

---

- í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ ì´ìš©í•´ ì»¨ìŠˆë¨¸ë¥¼ ë§Œë“¤ì–´ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ë²• (ìë°”)

- ì»¨ìŠˆë¨¸ì—ì„œ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ì€ í¬ê²Œ ì„¸ ê°€ì§€ ë°©ì‹
    - 1ï¸âƒ£Â ì˜¤í†  ì»¤ë°‹ â†’ ì»¨ìŠˆë¨¸ ì• í”Œë¦¬ì¼€ì´ì…˜ë“¤ì˜ ê¸°ë³¸ê°’ìœ¼ë¡œ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ê³  ìˆëŠ” ê²ƒ
        
        ```java
        package com.jenny.kafka;
        
        import org.apache.kafka.clients.consumer.ConsumerRecord;
        import org.apache.kafka.clients.consumer.ConsumerRecords;
        import org.apache.kafka.clients.consumer.KafkaConsumer;
        
        import java.util.Arrays;
        import java.util.Properties;
        
        public class ConsumerAuto {
            public static void main(String[] args) {
                // 1. Properties ê°ì²´ ìƒì„±
                Properties props = new Properties();
                // 2. ë¸Œë¡œì»¤ ë¦¬ìŠ¤íŠ¸ ì •ì˜
                props.put("bootstrap.servers", "kafka1:9091,kafka2:9092,kafka3:9093");
                // 3. ì»¨ìŠˆë¨¸ ê·¸ë£¹ ì•„ì´ë”” ì •ì˜
                props.put("group.id", "peter-consumer01");
                // 4. ì˜¤í†  ì»¤ë°‹ ì‚¬ìš©
                props.put("enable.auto.commit", "true");
                // 5. ì»¨ìŠˆë¨¸ ì˜¤í”„ì…‹ì„ ì°¾ì§€ ëª»í•˜ëŠ” ê²½ìš° latestë¡œ ì´ˆê¸°í™”í•˜ë©° ê°€ì¥ ìµœê·¼ë¶€í„° ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜´
                props.put("auto.offset.reset", "latest");
                // 6. ë¬¸ìì—´ì„ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ StringSerializerë¥¼ ì§€ì •
                props.put("key.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");
                props.put("value.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");
                // 7. Properties ê°ì²´ë¥¼ ì „ë‹¬í•´ ìƒˆ ì»¨ìŠˆë¨¸ ìƒì„±
                KafkaConsumer<String, String> consumer = new KafkaConsumer<>(props);
                // 8. êµ¬ë…í•  í† í”½ì„ ì§€ì •
                consumer.subscribe(Arrays.asList("peter-overview01"));
        
                try {
                    // 9. ë¬´í•œ ë£¨í”„ ì‹œì‘. ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ì¹´í”„ì¹´ì— ì§€ì†ì ìœ¼ë¡œ poll()ì„ í•¨
                    while (true) {
                        // 10. ì»¨ìŠˆë¨¸ëŠ” í´ë§í•˜ëŠ” ê²ƒì„ ê³„ì† ìœ ì§€í•˜ë©°, íƒ€ì„ì•„ì›ƒ ì£¼ê¸°ë¥¼ ì„¤ì •. í•´ë‹¹ ì‹œê°„ë§Œí¼ ë¸”ë¡í•¨
                        ConsumerRecords<String, String> records = consumer.poll(1000);
                        // 11. poll()ì€ ë ˆì½”ë“œ ì „ì²´ë¥¼ ë¦¬í„´í•˜ê³ , í•˜ë‚˜ì˜ ë©”ì‹œì§€ë§Œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì•„ë‹ˆë¯€ë¡œ ë°˜ë³µë¬¸ ì²˜ë¦¬
                        for (ConsumerRecord<String, String> record : records) {
                            System.out.printf("Topic: %s, Partition: %s, Offset: %d, Key: %s, Value: %s\n",
                                    record.topic(), record.partition(), record.offset(), record.key(), record.value());
                        }
                    }
                } catch (Exception e) {
                    e.printStackTrace();
                } finally {
                    // 12. ì»¨ìŠˆë¨¸ ì¢…ë£Œ
                    consumer.close();
                }
            }
        }
        ```
        
        - produce
            
            ![Untitled](./images/3/Untitled%2016.png)
            
        - consume
            
            ![Untitled](./images/3/Untitled%2017.png)
            
            ![Untitled](./images/3/Untitled%2018.png)
            
            ![Untitled](./images/3/Untitled%2019.png)
            
            - ì¥ì : ì˜¤í”„ì…‹ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì»¤ë°‹í•˜ë¯€ë¡œ ê´€ë¦¬ìê°€ ì˜¤í”„ì…‹ì„ ë”°ë¡œ ê´€ë¦¬í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.
            - ë‹¨ì : ì»¨ìŠˆë¨¸ ì¢…ë£Œ ë“±ì´ ë¹ˆë²ˆíˆ ì¼ì–´ë‚˜ë©´ ì¼ë¶€ ë©”ì‹œì§€ë¥¼ ëª» ê°€ì ¸ì˜¤ê±°ë‚˜ ì¤‘ë³µìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²½ìš°ê°€ ìˆë‹¤.
    - 2ï¸âƒ£Â ë™ê¸° ê°€ì ¸ì˜¤ê¸° â†’ ë©”ì‹œì§€ê°€ ì†ì‹¤ë˜ë©´ ì•ˆ ë˜ëŠ” ì¤‘ìš”í•œ ì²˜ë¦¬ ì‘ì—…ë“¤ì— ê¶Œì¥
        
        ```java
        package com.jenny.kafka;
        
        import org.apache.kafka.clients.consumer.ConsumerRecord;
        import org.apache.kafka.clients.consumer.ConsumerRecords;
        import org.apache.kafka.clients.consumer.KafkaConsumer;
        
        import java.util.Arrays;
        import java.util.Properties;
        
        public class ConsumerSync {
            public static void main(String[] args) {
                // 1. Properties ê°ì²´ ìƒì„±
                Properties props = new Properties();
                // 2. ë¸Œë¡œì»¤ ë¦¬ìŠ¤íŠ¸ ì •ì˜
                props.put("bootstrap.servers", "kafka1:9091,kafka2:9092,kafka3:9093");
                // 3. ì»¨ìŠˆë¨¸ ê·¸ë£¹ ì•„ì´ë”” ì •ì˜
                props.put("group.id", "peter-consumer01");
                // 4. ì˜¤í†  ì»¤ë°‹ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
                props.put("enable.auto.commit", "false");
                // 5. ì»¨ìŠˆë¨¸ ì˜¤í”„ì…‹ì„ ì°¾ì§€ ëª»í•˜ëŠ” ê²½ìš° latestë¡œ ì´ˆê¸°í™”í•˜ë©° ê°€ì¥ ìµœê·¼ë¶€í„° ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜´
                props.put("auto.offset.reset", "latest");
                // 6. ë¬¸ìì—´ì„ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ StringSerializerë¥¼ ì§€ì •
                props.put("key.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");
                props.put("value.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");
                // 7. Properties ê°ì²´ë¥¼ ì „ë‹¬í•´ ìƒˆ ì»¨ìŠˆë¨¸ ìƒì„±
                KafkaConsumer<String, String> consumer = new KafkaConsumer<>(props);
                // 8. êµ¬ë…í•  í† í”½ì„ ì§€ì •
                consumer.subscribe(Arrays.asList("peter-overview01"));
        
                try {
                    // 9. ë¬´í•œ ë£¨í”„ ì‹œì‘. ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ì¹´í”„ì¹´ì— ì§€ì†ì ìœ¼ë¡œ poll()ì„ í•¨
                    while (true) {
                        // 10. ì»¨ìŠˆë¨¸ëŠ” í´ë§í•˜ëŠ” ê²ƒì„ ê³„ì† ìœ ì§€í•˜ë©°, íƒ€ì„ì•„ì›ƒ ì£¼ê¸°ë¥¼ ì„¤ì •. í•´ë‹¹ ì‹œê°„ë§Œí¼ ë¸”ë¡í•¨
                        ConsumerRecords<String, String> records = consumer.poll(1000);
                        // 11. poll()ì€ ë ˆì½”ë“œ ì „ì²´ë¥¼ ë¦¬í„´í•˜ê³ , í•˜ë‚˜ì˜ ë©”ì‹œì§€ë§Œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì•„ë‹ˆë¯€ë¡œ ë°˜ë³µë¬¸ ì²˜ë¦¬
                        for (ConsumerRecord<String, String> record : records) {
                            System.out.printf("Topic: %s, Partition: %s, Offset: %d, Key: %s, Value: %s\n",
                                    record.topic(), record.partition(), record.offset(), record.key(), record.value());
                        }
                        // 12. í˜„ì¬ ë°°ì¹˜ë¥¼ í†µí•´ ì½ì€ ëª¨ë“  ë©”ì‹œì§€ë“¤ì„ ì²˜ë¦¬í•œ í›„, ì¶”ê°€ ë©”ì‹œì§€ë¥¼ í´ë§í•˜ê¸° ì „ í˜„ì¬ì˜ ì˜¤í”„ì…‹ì„ ë™ê¸° ì»¤ë°‹
                        consumer.commitSync();
                    }
                } catch (Exception e) {
                    e.printStackTrace();
                } finally {
                    // 12. ì»¨ìŠˆë¨¸ ì¢…ë£Œ
                    consumer.close();
                }
            }
        }
        ```
        
        - produce
            
            ![Untitled](./images/3/Untitled%2020.png)
            
        - consume
            
            ![Untitled](./images/3/Untitled%2021.png)
            
            ![Untitled](./images/3/Untitled%2022.png)
            
            ![Untitled](./images/3/Untitled%2023.png)
            
        - ì˜¤í†  ì»¤ë°‹ê³¼ ë‹¬ë¦¬ poll()ì„ ì´ìš©í•´ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¨ í›„ ì²˜ë¦¬ê¹Œì§€ ì™„ë£Œí•˜ê³  í˜„ì¬ì˜ ì˜¤í”„ì…‹ì„ ì»¤ë°‹í•œë‹¤.
        - ë™ê¸° ë°©ì‹ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²½ìš° ì†ë„ëŠ” ëŠë¦¬ì§€ë§Œ, ë©”ì‹œì§€ ì†ì‹¤ì€ ê±°ì˜ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
            - ë©”ì‹œì§€ ì†ì‹¤: ì‹¤ì œë¡œ í† í”½ì—ëŠ” ë©”ì‹œì§€ê°€ ì¡´ì¬í•˜ì§€ë§Œ ì˜ëª»ëœ ì˜¤í”„ì…‹ ì»¤ë°‹ìœ¼ë¡œ ì¸í•œ ìœ„ì¹˜ ë³€ê²½ìœ¼ë¡œ ì»¨ìŠˆë¨¸ê°€ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í•˜ëŠ” ê²…ìš°
        - ë©”ì‹œì§€ì˜ ì¤‘ë·± ì´ìŠˆëŠ” í”¼í•  ìˆ˜ ì—†ë‹¤.
    - 3ï¸âƒ£Â ë¹„ë™ê¸° ê°€ì ¸ì˜¤ê¸° â†’ ì˜¤í”„ì…‹ ì»¤ë°‹ì„ ì‹¤íŒ¨í•˜ë”ë¼ë„ ì¬ì‹œë„í•˜ì§€ ì•ŠëŠ”ë‹¤.
        
        ```java
        package com.jenny.kafka;
        
        import org.apache.kafka.clients.consumer.ConsumerRecord;
        import org.apache.kafka.clients.consumer.ConsumerRecords;
        import org.apache.kafka.clients.consumer.KafkaConsumer;
        
        import java.util.Arrays;
        import java.util.Properties;
        
        public class ConsumerAsync {
            public static void main(String[] args) {
                // 1. Properties ê°ì²´ ìƒì„±
                Properties props = new Properties();
                // 2. ë¸Œë¡œì»¤ ë¦¬ìŠ¤íŠ¸ ì •ì˜
                props.put("bootstrap.servers", "kafka1:9091,kafka2:9092,kafka3:9093");
                // 3. ì»¨ìŠˆë¨¸ ê·¸ë£¹ ì•„ì´ë”” ì •ì˜
                props.put("group.id", "peter-consumer01");
                // 4. ì˜¤í†  ì»¤ë°‹ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
                props.put("enable.auto.commit", "false");
                // 5. ì»¨ìŠˆë¨¸ ì˜¤í”„ì…‹ì„ ì°¾ì§€ ëª»í•˜ëŠ” ê²½ìš° latestë¡œ ì´ˆê¸°í™”í•˜ë©° ê°€ì¥ ìµœê·¼ë¶€í„° ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜´
                props.put("auto.offset.reset", "latest");
                // 6. ë¬¸ìì—´ì„ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ StringSerializerë¥¼ ì§€ì •
                props.put("key.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");
                props.put("value.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");
                // 7. Properties ê°ì²´ë¥¼ ì „ë‹¬í•´ ìƒˆ ì»¨ìŠˆë¨¸ ìƒì„±
                KafkaConsumer<String, String> consumer = new KafkaConsumer<>(props);
                // 8. êµ¬ë…í•  í† í”½ì„ ì§€ì •
                consumer.subscribe(Arrays.asList("peter-overview01"));
        
                try {
                    // 9. ë¬´í•œ ë£¨í”„ ì‹œì‘. ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ì¹´í”„ì¹´ì— ì§€ì†ì ìœ¼ë¡œ poll()ì„ í•¨
                    while (true) {
                        // 10. ì»¨ìŠˆë¨¸ëŠ” í´ë§í•˜ëŠ” ê²ƒì„ ê³„ì† ìœ ì§€í•˜ë©°, íƒ€ì„ì•„ì›ƒ ì£¼ê¸°ë¥¼ ì„¤ì •. í•´ë‹¹ ì‹œê°„ë§Œí¼ ë¸”ë¡í•¨
                        ConsumerRecords<String, String> records = consumer.poll(1000);
                        // 11. poll()ì€ ë ˆì½”ë“œ ì „ì²´ë¥¼ ë¦¬í„´í•˜ê³ , í•˜ë‚˜ì˜ ë©”ì‹œì§€ë§Œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì•„ë‹ˆë¯€ë¡œ ë°˜ë³µë¬¸ ì²˜ë¦¬
                        for (ConsumerRecord<String, String> record : records) {
                            System.out.printf("Topic: %s, Partition: %s, Offset: %d, Key: %s, Value: %s\n",
                                    record.topic(), record.partition(), record.offset(), record.key(), record.value());
                        }
                        // 12. í˜„ì¬ ë°°ì¹˜ë¥¼ í†µí•´ ì½ì€ ëª¨ë“  ë©”ì‹œì§€ë“¤ì„ ì²˜ë¦¬í•œ í›„, ì¶”ê°€ ë©”ì‹œì§€ë¥¼ í´ë§í•˜ê¸° ì „ í˜„ì¬ì˜ ì˜¤í”„ì…‹ì„ ë¹„ë™ê¸° ì»¤ë°‹
                        consumer.commitAsync();
                    }
                } catch (Exception e) {
                    e.printStackTrace();
                } finally {
                    // 12. ì»¨ìŠˆë¨¸ ì¢…ë£Œ
                    consumer.close();
                }
            }
        }
        ```
        
        - produce
            
            ![Untitled](./images/3/Untitled%2024.png)
            
        - consume
            
            ![Untitled](./images/3/Untitled%2025.png)
            
            ![Untitled](./images/3/Untitled%2026.png)
            
            ![Untitled](./images/3/Untitled%2027.png)
            
        - commitAsync()ëŠ” commitSync()ì™€ ë‹¬ë¦¬ ì˜¤í”„ì…‹ ì»¤ë°‹ì„ ì‹¤íŒ¨í•˜ë”ë¼ë„ ì¬ì‹œë„í•˜ì§€ ì•ŠëŠ”ë‹¤.
            - ë¹„ë™ê¸° ì»¤ë°‹ ì¬ì‹œë„ë¡œ ì¸í•´ ì˜¤í”„ì…‹ì´ ì»¤ë°‹ë¼ë²„ë¦¬ë©´ ê·¸ ìˆ˜ë§Œí¼ ë©”ì‹œì§€ê°€ ê³„ì† ì¤‘ë³µë  ê²ƒì´ë‹¤.

### 4-4. ì»¨ìŠˆë¨¸ ê·¸ë£¹ì˜ ì´í•´

---

- í•˜ë‚˜ì˜ ì»¨ìŠˆë¨¸ ê·¸ë£¹ì•ˆì— ì—¬ëŸ¬ê°œì˜ ì»¨ìŠˆë¨¸ê°€ êµ¬ì„±ë  ìˆ˜ ìˆë‹¤.
    - ê·¸ë¦¬ê³  ì»¨ìŠˆë¨¸ë“¤ì€ í† í”½ì˜ íŒŒí‹°ì…˜ê³¼ ì¼ëŒ€ì¼ë¡œ ë§¤í•‘ë˜ì–´ ë©”ì„¸ì§€ë¥¼ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤.
        
        ![3-8. ì»¨ìŠˆë¨¸ ê·¸ë£¹ê³¼ ì»¨ìŠˆë¨¸](./images/3/Untitled%2028.png)
        
        3-8. ì»¨ìŠˆë¨¸ ê·¸ë£¹ê³¼ ì»¨ìŠˆë¨¸
        
        - peter-01 ì´ë¼ëŠ” í† í”½ì´ ìˆê³ , íŒŒí‹°ì…˜0 ,1, 2ë¼ëŠ” ì´ 3ê°œì˜ íŒŒí‹°ì…˜ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.
        - ìš°ì¸¡ì—ëŠ” ì»¨ìŠˆë¨¸ ê·¸ë£¹01 ì´ë¼ëŠ” ì»¨ìŠˆë¨¸ ê·¸ë£¹ ì•„ì´ë””ë¥¼ ê°€ì§„ ì»¨ìŠˆë¨¸ ê·¸ë£¹ì´ ìˆìœ¼ë©°,
            - peter-01 í† í”½ì˜ íŒŒí‹°ì…˜ ìˆ˜ì™€ ë™ì¼í•œ 3ê°œì˜ ì»¨ìŠˆë¨¸ê°€ ì†í•´ ìˆë‹¤.

- ì»¨ìŠˆë¨¸ë“¤ì€ í•˜ë‚˜ì˜ ì»¨ìŠˆë¨¸ ê·¸ë£¹ ì•ˆì— ì†í•´ ìˆìœ¼ë©°, ê·¸ë£¹ ë‚´ì˜ ì»¨ìŠˆë¨¸ë“¤ì€ ì„œë¡œì˜ ì •ë³´ë¥¼ ê³µìœ í•œë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´ ì»¨ìŠˆë¨¸01ì´ ë¬¸ì œê°€ ë°œìƒí•˜ì—¬ ì¢…ë£Œëë‹¤ë©´, ì»¨ìŠˆë¨¸02 ë˜ëŠ” ì»¨ìŠˆë¨¸03ì€ ì»¨ìŠˆë¨¸01ì´ í•˜ë˜ ì¼ì„ ëŒ€ì‹ í•´ peter-01 í† í”½ì˜ íŒŒí‹°ì…˜0ì„ ì»¨ìŠ˜í•˜ê¸° ì‹œì‘í•œë‹¤.

- ì°¸ê³ 
    - [https://zeroco.tistory.com/105](https://zeroco.tistory.com/105)
    - [https://hoing.io/archives/5108](https://hoing.io/archives/5108)
    - [https://velog.io/@fj2008/ì¹´í”„ì¹´-ê¸°ë³¸-ê°œë…ê³¼-êµ¬ì¡°](https://velog.io/@fj2008/%EC%B9%B4%ED%94%84%EC%B9%B4-%EA%B8%B0%EB%B3%B8-%EA%B0%9C%EB%85%90%EA%B3%BC-%EA%B5%AC%EC%A1%B0)
    - [https://soojong.tistory.com/entry/Producerì˜-3ê°€ì§€-ì „ì†¡-ë°©ë²•-Javaë¡œ-êµ¬í˜„í•´ë³´ê¸°](https://soojong.tistory.com/entry/Producer%EC%9D%98-3%EA%B0%80%EC%A7%80-%EC%A0%84%EC%86%A1-%EB%B0%A9%EB%B2%95-Java%EB%A1%9C-%EA%B5%AC%ED%98%84%ED%95%B4%EB%B3%B4%EA%B8%B0)
