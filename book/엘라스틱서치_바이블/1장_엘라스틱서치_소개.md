# 1장. 엘라스틱서치 소개

- 엘라스틱서치(Elasticsearch): 2010년 2월 샤이 배논이 아파치의 루씬 라이브러리를 기반으로 만든 분산 검색 엔진
- 2013년 키바나, 로그스태시 프로젝트가 엘라스틱에 합류했다.
    - 키바나: 엘라스틱서치의 데이터를 손쉽게 시각화
    - 로그스태시: 엘라스틱서치에 색인할 데이터를 수집하고 변환
    
    → ELK 스택: 데이터의 수집부터 변환, 저장, 색인, 검색, 시각화까지 데이터 생명 주기 전체를 모두 엘라스틱의 솔루션으로 해결할 수 있다.
    
- 2015년, 비츠가 합류하면서 현재의 엘라스틱 스택이 완성됐다.
    - 비츠: 경량 데이터 수집 플랫폼

- 엘라스틱서치
    - 현재 검색 엔진 분야에서 가장 각광받고 있는 시스템
        - 분산 처리나 고가용성, 수평적 확장성 등 엔터프라이즈 영역에 필요한 주요 기능을 제공
        - 이러한 요소들의 효용성이 많은 기업 사용자에 의해 다년간 충분히 검증됐다.
    - JSON 기반의 문서를 저장, 색인, 검색하기에 분산 NoSQL 스토리지의 성격도 가지고 있다.
        - MongoDB와 함께 NoSQL 분야에서도 인기가 좋다.
        - 차별점: 강력한 전문 검색 기능을 탑재한 NoSQL 스토리지로서의 포지셔닝

# 1.1 엘라스틱서치의 기본 콘셉트

---

- 루씬: 데이터를 색인하고 검색하는 기능을 제공하는 검색 엔진의 코어 라이브러리
- 엘라스틱서치: 루씬을 코어로 이용하여 JSON 문서의 저장, 색인, 검색 등의 작업을 분산 처리하는 검색 엔진

### 검색 엔진

---

- 엘라스틱서치는 기본적으로 검색 엔진이다.
- 매우 강력한 검색 기능을 지원
    - 단순한 텍스트 매칭 검색이 아닌 본격적인 전문 검색(full-text search)이 가능하며 다양한 종류의 검색 쿼리를 지원한다.
- 역색인을 사용하여 검색속도도 매우 빠름
- 다양한 애널라이저(analyzer)를 조합하여 여러 비즈니스 요구사항에 맞는 색인 구성 가능
- 형태소 분석도 가능

### 분산 처리

---

- 데이터를 여러 노드에 분산 저장하며 검색이나 집계 작업 등을 수행할 때도 분산 처리를 지원한다.

### 고가용성 제공

---

- 클러스터를 구헝하고 있는 일부 노드에 장애가 발생해도 복제본 데이터를 이용해 중단 없이 서비스를 지속할 수 있다.
    - 다시 복제본을 만들어 복제본의 개수를 유지하면서 노드 간 데이터의 균형을 자동으로 맞춘다.

### 수평적 확장성

---

- 더 많은 처리 능력이 필요할 때에는 새로운 노드에 엘라스틱서치를 설치하여 클러스터에 참여시키는 것만으로도 확장이 된다.
    - 새 노드에 데이터를 복제하거나 옮기는 작업도 엘라스틱서치가 자동 수행한다.

### JSON 기반의 REST API 제공

---

- 엘라스틱서치는 JSON 형태의 문서를 저장, 색인, 검색한다.
- 특별한 클라이언트의 사전 설치 없이도 환경에 구애받지 않고 HTTP를 통해 쉽게 이용할 수 있다.

### 데이터 안정성

---

- 데이터 색인 요청 후 200 OK를 받았다면 그 데이터는 확실히 디스크에 기록된다.

### 다양한 플러그인을 통한 기능 확장 지원

---

- 다양한 플러그인을 통해 여러 비즈니스 요구사항에 맞게 엘라스틱서치를 커스터마이즈할 수 있다.

### 준실시간 검색

---

- 데이터를 색인하자마자 조회하는 것은 가능하지만, 데이터 색인 직후의 검색 요청은 성공하지 못할 가능성이 높다.
    - 역색인을 구성하고 이 역색인으로부터 검색이 가능해지기까지 시간이 걸리기 때문이다.
    - 기본 설정으로 엘라스틱서치를 운영할 경우 최대 1초 정도 시간이 걸린다.

### 트랜잭션이 지원되지 않음

---

- RDBMS와는 다르게 트랜잭션을 지원하지 않는다.
- cf> In-memory Redis vs Memcached
    - Memcached: 멀티쓰레드-원자적으로 동작, 트랜잭션은 지원하지 않음.
    - Redis: 싱글쓰레드, 트랜잭션 지원([redis transactions](https://docs.spring.io/spring-data/redis/reference/redis/transactions.html))
    - MongoDB: 트랜잭션 지원([mongoDB transaction](https://velog.io/@juhwanheo/Spring-Boot-MongoDB-Transaction))
        
        ![Untitled](./image/1/Untitled.png)
        
    
    <aside>
    💡 방대한 데이터를 다루는 NoSql에서는 Transaction 같은 고비용 처리 사용을 지양한다.
    
    </aside>
    

### 사실상 조인을 지원하지 않음

---

- `join`이라는 특별한 데이터 타입이 있지만 이는 굉장히 제한적인 상황을 위한 기능이며 성능도 떨어진다.
    - 기본적으로 RDBMS와는 다르게 데이터를 비정규화해야 한다.

# 1.2 라이선스 정책

---

- 엘라스틱서치 두 가지 라이선스 정책을 채택한다.
    - 엘라스틱 라이선스
        - 공식 홈페이지에서 배포되는 바이너리, 깃허브에 공개되는 소스코드
        - 몇 가지 제약을 제외하고는 비교적 자유도가 있는 라이선스
    - SSPL(Server Side Public License)
        - 깃허브에 공개되는 소스코드
        - 해당 소스코드에 비롯된 파생 작업을 만드는 경우 파생 작업물도 SSPL 라이선스로 공개해야 하는 카피레프트 성격의 라이선스
        - 아마존의 분쟁 → 아직까지는 OpenSearch보다 Elasticsearch가 압도적으로 많다.
            - 아마존웹서비스(AWS)는 오픈소스 프로젝트인 엘라스틱서치의 코드를 가져와 상용 매니지드(관리형) 서비스 ‘AWS 엘라스틱 서비스’를 만들어 제공한 바 있다.
                - 엘라스틱은 AWS가 프로젝트에 대한 기여 없이 기술을 사용하며 고객을 확보하고 있는점을 비난하며 라이선스를 아예 바꾸는 전략을 시행했다.
                - 이전 엘라스틱의 주요 제품에는 아파치 2.0 라이선스 적용 → 2021년부터 엘라스틱 라이선스(Elastic License) 또는 SSPL(Server Side Public License)로 라이선스 적용
            - 그러나 AWS는 이를 거부, 완전히 오픈된 Elasticsearch 7.1 Fork 후 OpenSearch 서비스 제공중
    
    → 회사 내부에서만 사용하면 문제 없다. 사용자가 직접 Elasticsearch에 접속하는 경우가 이슈.
    
- 만약 특수한 사정 때문에 이러한 제약을 지킬 수 없다면 7.10 버전 이하의 구버전을 선택하는 방법도 고려할 만하다.

![1.1 엘라스틱서치 라이선스의 구조](./image/1/Untitled%201.png)

1.1 엘라스틱서치 라이선스의 구조

# 1.3 실습 환경 구축

---

- 실제 엘라스틱서치를 실무에서 운영하기 위해서는 최소 3대 이상의 노드를 클러스터로 구성해야 한다.

## 1.3.1 엘라스틱서치 설치

---

### 엘라스틱서치 설치

---

- macOS용 파일을 다운로드하고 압축을 해제한다.
    - 8.2 이상의 릴리즈에서 MacOS 바이너리가 x86_64와 aarch64를 지원하며 Apple의 M1 및 M2 칩셋을 수용합니다. (If your CPU is Apple M1/M2: use aarch64)
    
    ```powershell
    # https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.4.2-darwin-aarch64.tar.gz 직접 다운로드
    $ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.4.2-darwin-aarch64.tar.gz
    jenny@M-N-KIMYOONHEE ~ % tar zxvf elasticsearch-8.4.2-darwin-aarch64.tar.gz
    jenny@M-N-KIMYOONHEE ~ % ln -s elasticsearch-8.4.2 elasticsearch
    
    jenny@M-N-KIMYOONHEE elasticsearch-8.4.2 % ls
    LICENSE.txt	NOTICE.txt	README.asciidoc	bin		config		jdk.app		lib		logs		modules		plugins
    ```
    

### 개발 모드로 엘라스틱서치 설정

---

- 엘라스틱서치는 다음 세 파일에 설정을 저장한다.
    - config/elasticsearch.yml: 클러스터의 정보, 각 노드의 정보, 데이터 파일을 저장할 경로 등 대부분의 핵심적인 엘라스틱서치 설정이 이 파일에 위치한다.
        
        ```yaml
        # ======================== Elasticsearch Configuration =========================
        #
        # NOTE: Elasticsearch comes with reasonable defaults for most settings.
        #       Before you set out to tweak and tune the configuration, make sure you
        #       understand what are you trying to accomplish and the consequences.
        #
        # The primary way of configuring a node is via this file. This template lists
        # the most important settings you may want to configure for a production cluster.
        #
        # Please consult the documentation for further information on configuration options:
        # https://www.elastic.co/guide/en/elasticsearch/reference/index.html
        #
        # ---------------------------------- Cluster -----------------------------------
        #
        # Use a descriptive name for your cluster:
        #
        #cluster.name: my-application
        #
        # ------------------------------------ Node ------------------------------------
        #
        # Use a descriptive name for the node:
        #
        #node.name: node-1
        #
        # Add custom attributes to the node:
        #
        #node.attr.rack: r1
        #
        # ----------------------------------- Paths ------------------------------------
        #
        # Path to directory where to store the data (separate multiple locations by comma):
        #
        #path.data: /path/to/data
        #
        # Path to log files:
        #
        #path.logs: /path/to/logs
        #
        # ----------------------------------- Memory -----------------------------------
        #
        # Lock the memory on startup:
        #
        #bootstrap.memory_lock: true
        #
        # Make sure that the heap size is set to about half the memory available
        # on the system and that the owner of the process is allowed to use this
        # limit.
        #
        # Elasticsearch performs poorly when the system is swapping the memory.
        #
        # ---------------------------------- Network -----------------------------------
        #
        # By default Elasticsearch is only accessible on localhost. Set a different
        # address here to expose this node on the network:
        #
        #network.host: 192.168.0.1
        #
        # By default Elasticsearch listens for HTTP traffic on the first free port it
        # finds starting at 9200. Set a specific HTTP port here:
        #
        #http.port: 9200
        #
        # For more information, consult the network module documentation.
        #
        # --------------------------------- Discovery ----------------------------------
        #
        # Pass an initial list of hosts to perform discovery when this node is started:
        # The default list of hosts is ["127.0.0.1", "[::1]"]
        #
        #discovery.seed_hosts: ["host1", "host2"]
        #
        # Bootstrap the cluster using an initial set of master-eligible nodes:
        #
        #cluster.initial_master_nodes: ["node-1", "node-2"]
        #
        # For more information, consult the discovery and cluster formation module documentation.
        #
        # --------------------------------- Readiness ----------------------------------
        #
        # Enable an unauthenticated TCP readiness endpoint on localhost
        #
        #readiness.port: 9399
        #
        # ---------------------------------- Various -----------------------------------
        #
        # Allow wildcard deletion of indices:
        #
        #action.destructive_requires_name: false
        ```
        
    - config/jvm.options: 힙 사이즈나 GC 옵션, 힙 덤프 등 JVM 설정을 지정한다.
        
        ```yaml
        ################################################################
        ##
        ## JVM configuration
        ##
        ################################################################
        ##
        ## WARNING: DO NOT EDIT THIS FILE. If you want to override the
        ## JVM options in this file, or set any additional options, you
        ## should create one or more files in the jvm.options.d
        ## directory containing your adjustments.
        ##
        ## See https://www.elastic.co/guide/en/elasticsearch/reference/8.4/jvm-options.html
        ## for more information.
        ##
        ################################################################
        
        ################################################################
        ## IMPORTANT: JVM heap size
        ################################################################
        ##
        ## The heap size is automatically configured by Elasticsearch
        ## based on the available memory in your system and the roles
        ## each node is configured to fulfill. If specifying heap is
        ## required, it should be done through a file in jvm.options.d,
        ## which should be named with .options suffix, and the min and
        ## max should be set to the same value. For example, to set the
        ## heap to 4 GB, create a new file in the jvm.options.d
        ## directory containing these lines:
        ##
        ## -Xms4g
        ## -Xmx4g
        ##
        ## See https://www.elastic.co/guide/en/elasticsearch/reference/8.4/heap-size.html
        ## for more information
        ##
        ################################################################
        
        ################################################################
        ## Expert settings
        ################################################################
        ##
        ## All settings below here are considered expert settings. Do
        ## not adjust them unless you understand what you are doing. Do
        ## not edit them in this file; instead, create a new file in the
        ## jvm.options.d directory containing your adjustments.
        ##
        ################################################################
        
        -XX:+UseG1GC
        
        ## JVM temporary directory
        -Djava.io.tmpdir=${ES_TMPDIR}
        
        ## heap dumps
        
        # generate a heap dump when an allocation from the Java heap fails; heap dumps
        # are created in the working directory of the JVM unless an alternative path is
        # specified
        -XX:+HeapDumpOnOutOfMemoryError
        
        # exit right after heap dump on out of memory error
        -XX:+ExitOnOutOfMemoryError
        
        # specify an alternative path for heap dumps; ensure the directory exists and
        # has sufficient space
        -XX:HeapDumpPath=data
        
        # specify an alternative path for JVM fatal error logs
        -XX:ErrorFile=logs/hs_err_pid%p.log
        
        ## GC logging
        -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m
        ```
        
    - config/log4j2.properties: log4j2 로깅과 관련된 설정을 지정한다.
        
        ```yaml
        status = error
        
        appender.console.type = Console
        appender.console.name = console
        appender.console.layout.type = PatternLayout
        appender.console.layout.pattern = [%d{ISO8601}][%-5p][%-25c{1.}] [%node_name]%marker %m%consoleException%n
        
        ######## Server JSON ############################
        appender.rolling.type = RollingFile
        appender.rolling.name = rolling
        appender.rolling.fileName = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}_server.json
        appender.rolling.layout.type = ECSJsonLayout
        appender.rolling.layout.dataset = elasticsearch.server
        
        appender.rolling.filePattern = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}-%d{yyyy-MM-dd}-%i.json.gz
        appender.rolling.policies.type = Policies
        appender.rolling.policies.time.type = TimeBasedTriggeringPolicy
        appender.rolling.policies.time.interval = 1
        appender.rolling.policies.time.modulate = true
        appender.rolling.policies.size.type = SizeBasedTriggeringPolicy
        appender.rolling.policies.size.size = 128MB
        appender.rolling.strategy.type = DefaultRolloverStrategy
        appender.rolling.strategy.fileIndex = nomax
        appender.rolling.strategy.action.type = Delete
        appender.rolling.strategy.action.basepath = ${sys:es.logs.base_path}
        appender.rolling.strategy.action.condition.type = IfFileName
        appender.rolling.strategy.action.condition.glob = ${sys:es.logs.cluster_name}-*
        appender.rolling.strategy.action.condition.nested_condition.type = IfAccumulatedFileSize
        appender.rolling.strategy.action.condition.nested_condition.exceeds = 2GB
        ################################################
        ######## Server -  old style pattern ###########
        appender.rolling_old.type = RollingFile
        appender.rolling_old.name = rolling_old
        appender.rolling_old.fileName = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}.log
        appender.rolling_old.layout.type = PatternLayout
        appender.rolling_old.layout.pattern = [%d{ISO8601}][%-5p][%-25c{1.}] [%node_name]%marker %m%n
        
        appender.rolling_old.filePattern = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}-%d{yyyy-MM-dd}-%i.log.gz
        appender.rolling_old.policies.type = Policies
        appender.rolling_old.policies.time.type = TimeBasedTriggeringPolicy
        appender.rolling_old.policies.time.interval = 1
        appender.rolling_old.policies.time.modulate = true
        appender.rolling_old.policies.size.type = SizeBasedTriggeringPolicy
        appender.rolling_old.policies.size.size = 128MB
        appender.rolling_old.strategy.type = DefaultRolloverStrategy
        appender.rolling_old.strategy.fileIndex = nomax
        appender.rolling_old.strategy.action.type = Delete
        appender.rolling_old.strategy.action.basepath = ${sys:es.logs.base_path}
        appender.rolling_old.strategy.action.condition.type = IfFileName
        appender.rolling_old.strategy.action.condition.glob = ${sys:es.logs.cluster_name}-*
        appender.rolling_old.strategy.action.condition.nested_condition.type = IfAccumulatedFileSize
        appender.rolling_old.strategy.action.condition.nested_condition.exceeds = 2GB
        ################################################
        
        rootLogger.level = info
        rootLogger.appenderRef.console.ref = console
        rootLogger.appenderRef.rolling.ref = rolling
        rootLogger.appenderRef.rolling_old.ref = rolling_old
        
        ######## Deprecation JSON #######################
        appender.deprecation_rolling.type = RollingFile
        appender.deprecation_rolling.name = deprecation_rolling
        appender.deprecation_rolling.fileName = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}_deprecation.json
        appender.deprecation_rolling.layout.type = ECSJsonLayout
        # Intentionally follows a different pattern to above
        appender.deprecation_rolling.layout.dataset = deprecation.elasticsearch
        appender.deprecation_rolling.filter.rate_limit.type = RateLimitingFilter
        
        appender.deprecation_rolling.filePattern = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}_deprecation-%i.json.gz
        appender.deprecation_rolling.policies.type = Policies
        appender.deprecation_rolling.policies.size.type = SizeBasedTriggeringPolicy
        appender.deprecation_rolling.policies.size.size = 1GB
        appender.deprecation_rolling.strategy.type = DefaultRolloverStrategy
        appender.deprecation_rolling.strategy.max = 4
        
        appender.header_warning.type = HeaderWarningAppender
        appender.header_warning.name = header_warning
        #################################################
        
        logger.deprecation.name = org.elasticsearch.deprecation
        logger.deprecation.level = WARN
        logger.deprecation.appenderRef.deprecation_rolling.ref = deprecation_rolling
        logger.deprecation.appenderRef.header_warning.ref = header_warning
        logger.deprecation.additivity = false
        
        ######## Search slowlog JSON ####################
        appender.index_search_slowlog_rolling.type = RollingFile
        appender.index_search_slowlog_rolling.name = index_search_slowlog_rolling
        appender.index_search_slowlog_rolling.fileName = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs\
          .cluster_name}_index_search_slowlog.json
        appender.index_search_slowlog_rolling.layout.type = ECSJsonLayout
        appender.index_search_slowlog_rolling.layout.dataset = elasticsearch.index_search_slowlog
        
        appender.index_search_slowlog_rolling.filePattern = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs\
          .cluster_name}_index_search_slowlog-%i.json.gz
        appender.index_search_slowlog_rolling.policies.type = Policies
        appender.index_search_slowlog_rolling.policies.size.type = SizeBasedTriggeringPolicy
        appender.index_search_slowlog_rolling.policies.size.size = 1GB
        appender.index_search_slowlog_rolling.strategy.type = DefaultRolloverStrategy
        appender.index_search_slowlog_rolling.strategy.max = 4
        #################################################
        
        #################################################
        logger.index_search_slowlog_rolling.name = index.search.slowlog
        logger.index_search_slowlog_rolling.level = trace
        logger.index_search_slowlog_rolling.appenderRef.index_search_slowlog_rolling.ref = index_search_slowlog_rolling
        logger.index_search_slowlog_rolling.additivity = false
        
        ######## Indexing slowlog JSON ##################
        appender.index_indexing_slowlog_rolling.type = RollingFile
        appender.index_indexing_slowlog_rolling.name = index_indexing_slowlog_rolling
        appender.index_indexing_slowlog_rolling.fileName = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}\
          _index_indexing_slowlog.json
        appender.index_indexing_slowlog_rolling.layout.type = ECSJsonLayout
        appender.index_indexing_slowlog_rolling.layout.dataset = elasticsearch.index_indexing_slowlog
        
        appender.index_indexing_slowlog_rolling.filePattern = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}\
          _index_indexing_slowlog-%i.json.gz
        appender.index_indexing_slowlog_rolling.policies.type = Policies
        appender.index_indexing_slowlog_rolling.policies.size.type = SizeBasedTriggeringPolicy
        appender.index_indexing_slowlog_rolling.policies.size.size = 1GB
        appender.index_indexing_slowlog_rolling.strategy.type = DefaultRolloverStrategy
        appender.index_indexing_slowlog_rolling.strategy.max = 4
        #################################################
        
        logger.index_indexing_slowlog.name = index.indexing.slowlog.index
        logger.index_indexing_slowlog.level = trace
        logger.index_indexing_slowlog.appenderRef.index_indexing_slowlog_rolling.ref = index_indexing_slowlog_rolling
        logger.index_indexing_slowlog.additivity = false
        
        logger.com_amazonaws.name = com.amazonaws
        logger.com_amazonaws.level = warn
        
        logger.com_amazonaws_jmx_SdkMBeanRegistrySupport.name = com.amazonaws.jmx.SdkMBeanRegistrySupport
        logger.com_amazonaws_jmx_SdkMBeanRegistrySupport.level = error
        
        logger.com_amazonaws_metrics_AwsSdkMetrics.name = com.amazonaws.metrics.AwsSdkMetrics
        logger.com_amazonaws_metrics_AwsSdkMetrics.level = error
        
        logger.com_amazonaws_auth_profile_internal_BasicProfileConfigFileLoader.name = com.amazonaws.auth.profile.internal.BasicProfileConfigFileLoader
        logger.com_amazonaws_auth_profile_internal_BasicProfileConfigFileLoader.level = error
        
        logger.com_amazonaws_services_s3_internal_UseArnRegionResolver.name = com.amazonaws.services.s3.internal.UseArnRegionResolver
        logger.com_amazonaws_services_s3_internal_UseArnRegionResolver.level = error
        
        appender.audit_rolling.type = RollingFile
        appender.audit_rolling.name = audit_rolling
        appender.audit_rolling.fileName = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}_audit.json
        appender.audit_rolling.layout.type = PatternLayout
        appender.audit_rolling.layout.pattern = {\
                        "type":"audit", \
                        "timestamp":"%d{yyyy-MM-dd'T'HH:mm:ss,SSSZ}"\
                        %varsNotEmpty{, "cluster.name":"%enc{%map{cluster.name}}{JSON}"}\
                        %varsNotEmpty{, "cluster.uuid":"%enc{%map{cluster.uuid}}{JSON}"}\
                        %varsNotEmpty{, "node.name":"%enc{%map{node.name}}{JSON}"}\
                        %varsNotEmpty{, "node.id":"%enc{%map{node.id}}{JSON}"}\
                        %varsNotEmpty{, "host.name":"%enc{%map{host.name}}{JSON}"}\
                        %varsNotEmpty{, "host.ip":"%enc{%map{host.ip}}{JSON}"}\
                        %varsNotEmpty{, "event.type":"%enc{%map{event.type}}{JSON}"}\
                        %varsNotEmpty{, "event.action":"%enc{%map{event.action}}{JSON}"}\
                        %varsNotEmpty{, "authentication.type":"%enc{%map{authentication.type}}{JSON}"}\
                        %varsNotEmpty{, "user.name":"%enc{%map{user.name}}{JSON}"}\
                        %varsNotEmpty{, "user.run_by.name":"%enc{%map{user.run_by.name}}{JSON}"}\
                        %varsNotEmpty{, "user.run_as.name":"%enc{%map{user.run_as.name}}{JSON}"}\
                        %varsNotEmpty{, "user.realm":"%enc{%map{user.realm}}{JSON}"}\
                        %varsNotEmpty{, "user.realm_domain":"%enc{%map{user.realm_domain}}{JSON}"}\
                        %varsNotEmpty{, "user.run_by.realm":"%enc{%map{user.run_by.realm}}{JSON}"}\
                        %varsNotEmpty{, "user.run_by.realm_domain":"%enc{%map{user.run_by.realm_domain}}{JSON}"}\
                        %varsNotEmpty{, "user.run_as.realm":"%enc{%map{user.run_as.realm}}{JSON}"}\
                        %varsNotEmpty{, "user.run_as.realm_domain":"%enc{%map{user.run_as.realm_domain}}{JSON}"}\
                        %varsNotEmpty{, "user.roles":%map{user.roles}}\
                        %varsNotEmpty{, "apikey.id":"%enc{%map{apikey.id}}{JSON}"}\
                        %varsNotEmpty{, "apikey.name":"%enc{%map{apikey.name}}{JSON}"}\
                        %varsNotEmpty{, "authentication.token.name":"%enc{%map{authentication.token.name}}{JSON}"}\
                        %varsNotEmpty{, "authentication.token.type":"%enc{%map{authentication.token.type}}{JSON}"}\
                        %varsNotEmpty{, "origin.type":"%enc{%map{origin.type}}{JSON}"}\
                        %varsNotEmpty{, "origin.address":"%enc{%map{origin.address}}{JSON}"}\
                        %varsNotEmpty{, "realm":"%enc{%map{realm}}{JSON}"}\
                        %varsNotEmpty{, "realm_domain":"%enc{%map{realm_domain}}{JSON}"}\
                        %varsNotEmpty{, "url.path":"%enc{%map{url.path}}{JSON}"}\
                        %varsNotEmpty{, "url.query":"%enc{%map{url.query}}{JSON}"}\
                        %varsNotEmpty{, "request.method":"%enc{%map{request.method}}{JSON}"}\
                        %varsNotEmpty{, "request.body":"%enc{%map{request.body}}{JSON}"}\
                        %varsNotEmpty{, "request.id":"%enc{%map{request.id}}{JSON}"}\
                        %varsNotEmpty{, "action":"%enc{%map{action}}{JSON}"}\
                        %varsNotEmpty{, "request.name":"%enc{%map{request.name}}{JSON}"}\
                        %varsNotEmpty{, "indices":%map{indices}}\
                        %varsNotEmpty{, "opaque_id":"%enc{%map{opaque_id}}{JSON}"}\
                        %varsNotEmpty{, "trace.id":"%enc{%map{trace.id}}{JSON}"}\
                        %varsNotEmpty{, "x_forwarded_for":"%enc{%map{x_forwarded_for}}{JSON}"}\
                        %varsNotEmpty{, "transport.profile":"%enc{%map{transport.profile}}{JSON}"}\
                        %varsNotEmpty{, "rule":"%enc{%map{rule}}{JSON}"}\
                        %varsNotEmpty{, "put":%map{put}}\
                        %varsNotEmpty{, "delete":%map{delete}}\
                        %varsNotEmpty{, "change":%map{change}}\
                        %varsNotEmpty{, "create":%map{create}}\
                        %varsNotEmpty{, "invalidate":%map{invalidate}}\
                        }%n
        # "node.name" node name from the `elasticsearch.yml` settings
        # "node.id" node id which should not change between cluster restarts
        # "host.name" unresolved hostname of the local node
        # "host.ip" the local bound ip (i.e. the ip listening for connections)
        # "origin.type" a received REST request is translated into one or more transport requests. This indicates which processing layer generated the event "rest" or "transport" (internal)
        # "event.action" the name of the audited event, eg. "authentication_failed", "access_granted", "run_as_granted", etc.
        # "authentication.type" one of "realm", "api_key", "token", "anonymous" or "internal"
        # "user.name" the subject name as authenticated by a realm
        # "user.run_by.name" the original authenticated subject name that is impersonating another one.
        # "user.run_as.name" if this "event.action" is of a run_as type, this is the subject name to be impersonated as.
        # "user.realm" the name of the realm that authenticated "user.name"
        # "user.realm_domain" if "user.realm" is under a domain, this is the name of the domain
        # "user.run_by.realm" the realm name of the impersonating subject ("user.run_by.name")
        # "user.run_by.realm_domain" if "user.run_by.realm" is under a domain, this is the name of the domain
        # "user.run_as.realm" if this "event.action" is of a run_as type, this is the realm name the impersonated user is looked up from
        # "user.run_as.realm_domain" if "user.run_as.realm" is under a domain, this is the name of the domain
        # "user.roles" the roles array of the user; these are the roles that are granting privileges
        # "apikey.id" this field is present if and only if the "authentication.type" is "api_key"
        # "apikey.name" this field is present if and only if the "authentication.type" is "api_key"
        # "authentication.token.name" this field is present if and only if the authenticating credential is a service account token
        # "authentication.token.type" this field is present if and only if the authenticating credential is a service account token
        # "event.type" informs about what internal system generated the event; possible values are "rest", "transport", "ip_filter" and "security_config_change"
        # "origin.address" the remote address and port of the first network hop, i.e. a REST proxy or another cluster node
        # "realm" name of a realm that has generated an "authentication_failed" or an "authentication_successful"; the subject is not yet authenticated
        # "realm_domain" if "realm" is under a domain, this is the name of the domain
        # "url.path" the URI component between the port and the query string; it is percent (URL) encoded
        # "url.query" the URI component after the path and before the fragment; it is percent (URL) encoded
        # "request.method" the method of the HTTP request, i.e. one of GET, POST, PUT, DELETE, OPTIONS, HEAD, PATCH, TRACE, CONNECT
        # "request.body" the content of the request body entity, JSON escaped
        # "request.id" a synthetic identifier for the incoming request, this is unique per incoming request, and consistent across all audit events generated by that request
        # "action" an action is the most granular operation that is authorized and this identifies it in a namespaced way (internal)
        # "request.name" if the event is in connection to a transport message this is the name of the request class, similar to how rest requests are identified by the url path (internal)
        # "indices" the array of indices that the "action" is acting upon
        # "opaque_id" opaque value conveyed by the "X-Opaque-Id" request header
        # "trace_id" an identifier conveyed by the part of "traceparent" request header
        # "x_forwarded_for" the addresses from the "X-Forwarded-For" request header, as a verbatim string value (not an array)
        # "transport.profile" name of the transport profile in case this is a "connection_granted" or "connection_denied" event
        # "rule" name of the applied rule if the "origin.type" is "ip_filter"
        # the "put", "delete", "change", "create", "invalidate" fields are only present
        # when the "event.type" is "security_config_change" and contain the security config change (as an object) taking effect
        
        appender.audit_rolling.filePattern = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}_audit-%d{yyyy-MM-dd}-%i.json.gz
        appender.audit_rolling.policies.type = Policies
        appender.audit_rolling.policies.time.type = TimeBasedTriggeringPolicy
        appender.audit_rolling.policies.time.interval = 1
        appender.audit_rolling.policies.time.modulate = true
        appender.audit_rolling.policies.size.type = SizeBasedTriggeringPolicy
        appender.audit_rolling.policies.size.size = 1GB
        appender.audit_rolling.strategy.type = DefaultRolloverStrategy
        appender.audit_rolling.strategy.fileIndex = nomax
        
        logger.xpack_security_audit_logfile.name = org.elasticsearch.xpack.security.audit.logfile.LoggingAuditTrail
        logger.xpack_security_audit_logfile.level = info
        logger.xpack_security_audit_logfile.appenderRef.audit_rolling.ref = audit_rolling
        logger.xpack_security_audit_logfile.additivity = false
        
        logger.xmlsig.name = org.apache.xml.security.signature.XMLSignature
        logger.xmlsig.level = error
        logger.samlxml_decrypt.name = org.opensaml.xmlsec.encryption.support.Decrypter
        logger.samlxml_decrypt.level = fatal
        logger.saml2_decrypt.name = org.opensaml.saml.saml2.encryption.Decrypter
        logger.saml2_decrypt.level = fatal
        ```
        

- config/elasticsearch.yml
    
    ```yaml
    cluster.name: test-es
    node.name: test-es-node01
    
    path.data: /Users/jenny/elasticsearch-8.4.2/data
    path.logs: /Users/jenny/elasticsearch-8.4.2/logs
    
    network.host: 127.0.0.1
    
    discovery.type: "single-node"
    xpack.security.enabled: false
    ```
    
    - cluster.name: 클러스터의 이름
    - node.name: 노드의 이름. 클러스터 내에서 고유해야 한다.
    - path.data: 엘라스틱서치의 데이터를 저장할 경로
    - path.logs: 로그를 저장할 경로
    - network.host: 기본값이 루프백 주소. 개발 모드로 설정 시 특별한 사유가 없다면 지정하지 않아도 된다.
        - 루프백 IP: 자기 자신을 가리키기 위한 목적으로 쓰기 위해 예약된 IP 주소
            - 루프백 네트워크에서 가장 일반적으로 사용되는 IP 주소: 127.0.0.1(IPv4) 및 ::1(IPv6)
            - 주소에 대한 표준 도메인 이름은 localhost
            
            ```yaml
            # localhost를 127.0.0.1로 연결시켜 두어서, 호스트 이름에 localhost를 입력하면 DNS를 타지 않고 바로 로컬로 연결된다.
            jenny@M-N-KIMYOONHEE elasticsearch-8.4.2 % cat /etc/hosts
            ##
            # Host Database
            #
            # localhost is used to configure the loopback interface
            # when the system is booting.  Do not change this entry.
            ##
            127.0.0.1	localhost
            255.255.255.255	broadcasthost
            ::1             localhost
            127.0.0.1 mongodb1 mongodb2 mongodb3
            # Added by Docker Desktop
            # To allow the same kube context to work on the host and the container:
            127.0.0.1 kubernetes.docker.internal
            # End of section
            ```
            
    - discovery.type: single-node로 지정하면 엘라스틱서치는 단일 노드의 개발 모드로 동작
        - 다른 노드의 클러스터 참가 신청을 받아들이지 않는다.
    - xpack.security.enabled: 엘라스틱서치에서 제공하는 보안 관련 기능을 사용할 것인지를 지정
        - 노드 간의 TLS 통신 적용, 유저와 역할을 기반으로 한 인증과 권한 분리, 감사(접속 및 사용 이력을 기록하는 audit 로그) 증적 등 기능 제공

- config/jvm.options ([레퍼런스](https://www.elastic.co/guide/en/elasticsearch/reference/8.4/advanced-configuration.html#set-jvm-heap-size))
    
    ```yaml
    -Xms16g # -> 기본적으로는 시스템 메모리의 절반으로 지정하면 된다.
    -Xmx16g
    ```
    
    - 더 정확히는 JVM의 Compressed OOPs(Ordinary Object Pointers)라는 기능이 적용되도록 하는 경곗값을 찾아 지정하는 것이 좋다.
        - Compressed OOPS: 32bit 만으로도 32GB 힙을 사용할 수 있도록 하는 자료구조.
            - 32bit 시스템(ILP32)에서 oops 는 최대 힙을 4GB (2^32)까지 사용할 수 있다.
            - 64bit 시스템(LP64)에서 oops 는 최대 힙을 18.5EB (2^64)까지 사용할 수 있다.
            
            ![[https://brunch.co.kr/@alden/35](https://brunch.co.kr/@alden/35)](./image/1/Untitled%202.png)
            
            [https://brunch.co.kr/@alden/35](https://brunch.co.kr/@alden/35)
            
            - OOP가 주소가 아닌 주소의 오프셋을 가리킨다. 그 오프셋은 8의 n배수로 계산되어, 값이 1이면 8번 주소, 2이면 16번 주소, … 기존보다 8배 더 많은 주소 공간을 표시할 수 게 된다.
    - 지금은 일단 시스템 메모리가 64GB 미만인 경우 시스템 메모리의 절반으로, 64GB 이상인 경우 31g로 지정하자.
        - `UseCompressedOops`가 켜져있는지 보면 된다.
        - compress oops 가 활성화되어있다고 해도 zero based 가 아니면 성능상 손해를 본다.
            
            ```powershell
            jenny@M-N-KIMYOONHEE elasticsearch % /Users/jenny/elasticsearch-8.4.2/jdk.app/Contents/Home/bin/java -Xmx16G -XX:+UnlockDiagnosticVMOptions -XX:+PrintFlagsFinal -version 2>/dev/null | grep 'UseCompressedOops'
                 bool UseCompressedOops                        = true                           {product lp64_product} {ergonomic}
            
            jenny@M-N-KIMYOONHEE elasticsearch % /Users/jenny/elasticsearch-8.4.2/jdk.app/Contents/Home/bin/java -Xmx16G -XX:+UnlockDiagnosticVMOptions -Xlog:gc+heap+coops=debug -version
            [0.008s][debug][gc,heap,coops] Heap address: 0x0000000400000000, size: 16384 MB, Compressed Oops mode: Zero based, Oop shift amount: 3
            openjdk version "18.0.2.1" 2022-08-18
            OpenJDK Runtime Environment (build 18.0.2.1+1-1)
            OpenJDK 64-Bit Server VM (build 18.0.2.1+1-1, mixed mode, sharing)
            
            # 개인적으로 설치한 java로 실행 시
            jenny@M-N-KIMYOONHEE elasticsearch % java -Xmx16G -XX:+UnlockDiagnosticVMOptions -Xlog:gc+heap+coops=debug -version
            [0.016s][debug][gc,heap,coops] Heap address: 0x0000000400000000, size: 16384 MB, Compressed Oops mode: Zero based, Oop shift amount: 3
            openjdk version "17.0.8" 2023-07-18
            OpenJDK Runtime Environment Temurin-17.0.8+7 (build 17.0.8+7)
            OpenJDK 64-Bit Server VM Temurin-17.0.8+7 (build 17.0.8+7, mixed mode)
            ```
            
    - Xms: Java 힙의 최초 크기
    - Xmx: Java 힙의 최대 크기
        - 참고: JVM 옵션 [-Xms 와 -Xmx 를 같게 하는 이유](https://kimxavi.tistory.com/entry/java-JVM-%EC%98%B5%EC%85%98-Xms-%EC%99%80-Xmx-%EB%A5%BC-%EA%B0%99%EA%B2%8C-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0)
            
            1. 힙 크기를 늘릴 때 OS 에 추가 메모리를 요청해야 하므로 시간이 걸린다 (GC 가 처리되었던 요청의 응답시간에 추가됨)
            
            2. JVM 은 힙으로 늘린 메모리를 다시 해제하지 않아 결국엔 Xmx 값이 된다
            
            3. 힙 크기를 늘리는 작업은 stop-the-world 이벤트여서 이를 방지할 수 있다
            
            4. Xms 가 작게 시작하는 경우 GC 가 더 많이 발생하게 됨
            
            5. 일반적으로 다른 앱과 메모리 경쟁을 하지 않는 경우에 이렇게 설정
            
            ![Untitled](./image/1/Untitled%203.png)
            
    
    <aside>
    💡 엄밀히는 7.11 버전 이상을 사용할 경우 엘라스틱에서는 config/jvm.options 파일을 직접 수정하는 것보다 config/jvm.options.d 디렉터리 밑에 별도 파일을 생성해서 힙 크기를 지정하는 것을 추천한다.
    
    </aside>
    

- JVM 지정
    - 엘라스틱서치는 7버전부터 OpenJDK를 내장해서 함께 배포한다. 별도의 JDK나 JRE를 설치할 필요가 없다.
        - 특별한 경우가 아니면 힙 크기 외의 JVM 설정을 변경하지 않도록 권고한다.
            - ES 기본 설정은 기본적으로 내장 JDK를 기준으로 테스트된 것.
    - JVM 13 이하의 낮은 버전으로 구동하는 경우에는 엘라스틱서치가 기본값으로 G1GC를 사용하지 않는다.
        - G1GC: JVM 9 디폴트 가비지 컬렉터
            
            ![Untitled](./image/1/Untitled%204.png)
            
            - ES는 가비지 컬렉터 교체 이슈에 보수적으로 접근해 늦게 채택했다. 기본 설정으로는 JVM 14 이상으로 구동해야 G1GC를 사용한다.
            - JVM 10 이상이라면 config/jvm.options를 수정해서 G1GC를 사용하도록 할 수는 있다.
        - 참고: [JVM 구조와 Garbage Collection](https://donghyeon.dev/java/2020/03/31/%EC%9E%90%EB%B0%94%EC%9D%98-JVM-%EA%B5%AC%EC%A1%B0%EC%99%80-Garbage-Collection/)
            - JVM 5~8의 디폴트 가비지 컬렉터: [Parallel GC](https://blog.opendocs.co.kr/?p=569)
                
                ![Untitled](./image/1/Untitled%205.png)
                
            - JVM 17, 21 디폴트 가비지 컬렉터: [ZGC](https://d2.naver.com/helloworld/0128759)
                
                ![https://hub.packtpub.com/getting-started-with-z-garbage-collectorzgc-in-java-11-tutorial/](./image/1/Untitled%206.png)
                
                https://hub.packtpub.com/getting-started-with-z-garbage-collectorzgc-in-java-11-tutorial/
                
            - 미래 LTS 버전에서 검토중인 [Generational ZGC](https://inside.java/2023/11/28/gen-zgc-explainer/): Shenandoah GC를 개선하여 실험용으로 Generational 모드를 제공하려는 것
                - 시간이 부족해서 JDK 21 공식 기능에서 제거됨
    - `ES_JAVA_HOME` 환경변수가 존재하는 경우 해당 위치에 지정된 JDK로 구동된다.
        - 7.12 버전 미만을 사용한다면 `JAVA_HOME` 환경변수를 확인한다. → ❗유의해야 한다.

## 엘라스틱서치 실행

---

- `bin/elasticsearch`
    
    ```powershell
    jenny@M-N-KIMYOONHEE elasticsearch % bin/elasticsearch
    warning: ignoring JAVA_HOME=/opt/homebrew/opt/sdkman-cli/libexec/candidates/java/current; using bundled JDK
    [2024-01-02T23:04:44,062][INFO ][o.e.n.Node               ] [test-es-node01] version[8.4.2], pid[62677], build[tar/89f8c6d8429db93b816403ee75e5c270b43a940a/2022-09-14T16:26:04.382547801Z], OS[Mac OS X/12.3/aarch64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/18.0.2.1/18.0.2.1+1-1]
    [2024-01-02T23:04:44,065][INFO ][o.e.n.Node               ] [test-es-node01] JVM home [/Users/jenny/elasticsearch-8.4.2/jdk.app/Contents/Home], using bundled JDK [true]
    [2024-01-02T23:04:44,065][INFO ][o.e.n.Node               ] [test-es-node01] JVM arguments [-Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -Djava.security.manager=allow, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Dlog4j2.formatMsgNoLookups=true, -Djava.locale.providers=SPI,COMPAT, --add-opens=java.base/java.io=ALL-UNNAMED, -Xms16g, -Xmx16g, -XX:+UseG1GC, -Djava.io.tmpdir=/var/folders/9w/bxdb3hyx0sx3spmvt9bpkg7m0000gn/T/elasticsearch-4564253604695678127, -XX:+HeapDumpOnOutOfMemoryError, -XX:+ExitOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m, -XX:MaxDirectMemorySize=8589934592, -XX:InitiatingHeapOccupancyPercent=30, -XX:G1ReservePercent=25, -Des.distribution.type=tar, --module-path=/Users/jenny/elasticsearch-8.4.2/lib, --add-modules=jdk.net, -Djdk.module.main=org.elasticsearch.server]
    [2024-01-02T23:04:45,112][INFO ][c.a.c.i.j.JacksonVersion ] [test-es-node01] Package versions: jackson-annotations=2.13.2, jackson-core=2.13.2, jackson-databind=2.13.2.2, jackson-dataformat-xml=2.13.2, jackson-datatype-jsr310=2.13.2, azure-core=1.27.0, Troubleshooting version conflicts: https://aka.ms/azsdk/java/dependency/troubleshoot
    [2024-01-02T23:04:45,988][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [aggs-matrix-stats]
    [2024-01-02T23:04:45,989][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [analysis-common]
    [2024-01-02T23:04:45,989][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [constant-keyword]
    [2024-01-02T23:04:45,989][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [data-streams]
    [2024-01-02T23:04:45,989][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [frozen-indices]
    [2024-01-02T23:04:45,989][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [ingest-attachment]
    [2024-01-02T23:04:45,989][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [ingest-common]
    [2024-01-02T23:04:45,989][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [ingest-geoip]
    [2024-01-02T23:04:45,989][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [ingest-user-agent]
    [2024-01-02T23:04:45,989][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [kibana]
    [2024-01-02T23:04:45,989][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [lang-expression]
    [2024-01-02T23:04:45,989][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [lang-mustache]
    [2024-01-02T23:04:45,990][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [lang-painless]
    [2024-01-02T23:04:45,990][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [legacy-geo]
    [2024-01-02T23:04:45,990][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [mapper-extras]
    [2024-01-02T23:04:45,990][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [mapper-version]
    [2024-01-02T23:04:45,990][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [old-lucene-versions]
    [2024-01-02T23:04:45,990][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [parent-join]
    [2024-01-02T23:04:45,990][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [percolator]
    [2024-01-02T23:04:45,990][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [rank-eval]
    [2024-01-02T23:04:45,990][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [reindex]
    [2024-01-02T23:04:45,990][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [repositories-metering-api]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [repository-azure]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [repository-encrypted]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [repository-gcs]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [repository-s3]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [repository-url]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [runtime-fields-common]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [search-business-rules]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [searchable-snapshots]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [snapshot-based-recoveries]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [snapshot-repo-test-kit]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [spatial]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [transform]
    [2024-01-02T23:04:45,991][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [transport-netty4]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [unsigned-long]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [vector-tile]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [wildcard]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-aggregate-metric]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-analytics]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-async]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-async-search]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-autoscaling]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-ccr]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-core]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-deprecation]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-enrich]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-eql]
    [2024-01-02T23:04:45,992][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-fleet]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-graph]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-identity-provider]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-ilm]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-logstash]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-ml]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-monitoring]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-ql]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-rollup]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-security]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-shutdown]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-sql]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-stack]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-text-structure]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-voting-only-node]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] loaded module [x-pack-watcher]
    [2024-01-02T23:04:45,993][INFO ][o.e.p.PluginsService     ] [test-es-node01] no plugins loaded
    [2024-01-02T23:04:46,936][INFO ][o.e.e.NodeEnvironment    ] [test-es-node01] using [1] data paths, mounts [[/System/Volumes/Data (/dev/disk3s5)]], net usable_space [310.4gb], net total_space [460.4gb], types [apfs]
    [2024-01-02T23:04:46,936][INFO ][o.e.e.NodeEnvironment    ] [test-es-node01] heap size [16gb], compressed ordinary object pointers [true]
    [2024-01-02T23:04:46,958][INFO ][o.e.n.Node               ] [test-es-node01] node name [test-es-node01], node ID [8B30jNG1Qe-tz6dQ-pOzPw], cluster name [test-es], roles [data_cold, data, remote_cluster_client, master, data_warm, data_content, transform, data_hot, ml, data_frozen, ingest]
    [2024-01-02T23:04:47,994][INFO ][o.e.x.s.Security         ] [test-es-node01] Security is disabled
    [2024-01-02T23:04:48,023][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [test-es-node01] [controller/62686] [Main.cc@123] controller (64 bit): Version 8.4.2 (Build 158cee2efc2db4) Copyright (c) 2022 Elasticsearch BV
    [2024-01-02T23:04:48,240][INFO ][o.e.t.n.NettyAllocator   ] [test-es-node01] creating NettyAllocator with the following configs: [name=elasticsearch_configured, chunk_size=1mb, suggested_max_allocation_size=1mb, factors={es.unsafe.use_netty_default_chunk_and_page_size=false, g1gc_enabled=true, g1gc_region_size=8mb}]
    [2024-01-02T23:04:48,254][INFO ][o.e.i.r.RecoverySettings ] [test-es-node01] using rate limit [40mb] with [default=40mb, read=0b, write=0b, max=0b]
    [2024-01-02T23:04:48,270][INFO ][o.e.d.DiscoveryModule    ] [test-es-node01] using discovery type [single-node] and seed hosts providers [settings]
    [2024-01-02T23:04:48,666][INFO ][o.e.n.Node               ] [test-es-node01] initialized
    [2024-01-02T23:04:48,666][INFO ][o.e.n.Node               ] [test-es-node01] starting ...
    [2024-01-02T23:04:48,731][INFO ][o.e.x.s.c.f.PersistentCache] [test-es-node01] persistent cache index loaded
    [2024-01-02T23:04:48,733][INFO ][o.e.x.d.l.DeprecationIndexingComponent] [test-es-node01] deprecation component started
    [2024-01-02T23:04:48,806][INFO ][o.e.t.TransportService   ] [test-es-node01] publish_address {127.0.0.1:9300}, bound_addresses {127.0.0.1:9300}
    [2024-01-02T23:04:49,128][INFO ][o.e.c.c.ClusterBootstrapService] [test-es-node01] this node has not joined a bootstrapped cluster yet; [cluster.initial_master_nodes] is set to [test-es-node01]
    [2024-01-02T23:04:49,133][INFO ][o.e.c.c.Coordinator      ] [test-es-node01] setting initial configuration to VotingConfiguration{8B30jNG1Qe-tz6dQ-pOzPw}
    [2024-01-02T23:04:49,414][INFO ][o.e.c.s.MasterService    ] [test-es-node01] elected-as-master ([1] nodes joined)[_FINISH_ELECTION_, {test-es-node01}{8B30jNG1Qe-tz6dQ-pOzPw}{vM64wshgQgCCOljTg3Tmfg}{test-es-node01}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw} completing election], term: 1, version: 1, delta: master node changed {previous [], current [{test-es-node01}{8B30jNG1Qe-tz6dQ-pOzPw}{vM64wshgQgCCOljTg3Tmfg}{test-es-node01}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}]}
    [2024-01-02T23:04:49,531][INFO ][o.e.c.c.CoordinationState] [test-es-node01] cluster UUID set to [sYQIkTlQQba3YrHYtw71bg]
    [2024-01-02T23:04:49,648][INFO ][o.e.c.s.ClusterApplierService] [test-es-node01] master node changed {previous [], current [{test-es-node01}{8B30jNG1Qe-tz6dQ-pOzPw}{vM64wshgQgCCOljTg3Tmfg}{test-es-node01}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}]}, term: 1, version: 1, reason: Publication{term=1, version=1}
    [2024-01-02T23:04:49,690][INFO ][o.e.r.s.FileSettingsService] [test-es-node01] starting file settings watcher ...
    [2024-01-02T23:04:49,693][INFO ][o.e.r.s.FileSettingsService] [test-es-node01] file settings service up and running [tid=40]
    [2024-01-02T23:04:49,694][INFO ][o.e.h.AbstractHttpServerTransport] [test-es-node01] publish_address {127.0.0.1:9200}, bound_addresses {127.0.0.1:9200}
    [2024-01-02T23:04:49,695][INFO ][o.e.n.Node               ] [test-es-node01] started {test-es-node01}{8B30jNG1Qe-tz6dQ-pOzPw}{vM64wshgQgCCOljTg3Tmfg}{test-es-node01}{127.0.0.1}{127.0.0.1:9300}{cdfhilmrstw}{ml.allocated_processors=10, ml.max_jvm_size=17179869184, ml.machine_memory=34359738368, xpack.installed=true}
    [2024-01-02T23:04:49,768][INFO ][o.e.g.GatewayService     ] [test-es-node01] recovered [0] indices into cluster_state
    [2024-01-02T23:04:49,843][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [.watch-history-16] for index patterns [.watcher-history-16*]
    [2024-01-02T23:04:49,847][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [ilm-history] for index patterns [ilm-history-5*]
    [2024-01-02T23:04:49,850][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [.slm-history] for index patterns [.slm-history-5*]
    [2024-01-02T23:04:49,855][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding component template [.deprecation-indexing-mappings]
    [2024-01-02T23:04:49,856][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding component template [.deprecation-indexing-settings]
    [2024-01-02T23:04:49,858][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding component template [logs-mappings]
    [2024-01-02T23:04:49,861][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding component template [data-streams-mappings]
    [2024-01-02T23:04:49,862][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding component template [logs-settings]
    [2024-01-02T23:04:49,864][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding component template [synthetics-mappings]
    [2024-01-02T23:04:49,865][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding component template [metrics-settings]
    [2024-01-02T23:04:49,867][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding component template [metrics-mappings]
    [2024-01-02T23:04:49,868][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding component template [synthetics-settings]
    [2024-01-02T23:04:49,888][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [.monitoring-es-mb] for index patterns [.monitoring-es-8-*]
    [2024-01-02T23:04:49,896][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [.monitoring-kibana-mb] for index patterns [.monitoring-kibana-8-*]
    [2024-01-02T23:04:49,902][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [.monitoring-ent-search-mb] for index patterns [.monitoring-ent-search-8-*]
    [2024-01-02T23:04:49,911][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [.monitoring-beats-mb] for index patterns [.monitoring-beats-8-*]
    [2024-01-02T23:04:49,916][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [.monitoring-logstash-mb] for index patterns [.monitoring-logstash-8-*]
    [2024-01-02T23:04:49,919][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [.ml-stats] for index patterns [.ml-stats-*]
    [2024-01-02T23:04:49,926][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [.ml-anomalies-] for index patterns [.ml-anomalies-*]
    [2024-01-02T23:04:49,927][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [.ml-state] for index patterns [.ml-state*]
    [2024-01-02T23:04:49,931][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [.ml-notifications-000002] for index patterns [.ml-notifications-000002]
    [2024-01-02T23:04:49,934][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding template [.monitoring-logstash] for index patterns [.monitoring-logstash-7-*]
    [2024-01-02T23:04:49,937][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding template [.monitoring-alerts-7] for index patterns [.monitoring-alerts-7]
    [2024-01-02T23:04:49,939][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding template [.monitoring-kibana] for index patterns [.monitoring-kibana-7-*]
    [2024-01-02T23:04:49,942][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding template [.monitoring-beats] for index patterns [.monitoring-beats-7-*]
    [2024-01-02T23:04:49,946][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding template [.monitoring-es] for index patterns [.monitoring-es-7-*]
    [2024-01-02T23:04:50,121][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [.deprecation-indexing-template] for index patterns [.logs-deprecation.*]
    [2024-01-02T23:04:50,124][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [metrics] for index patterns [metrics-*-*]
    [2024-01-02T23:04:50,127][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [logs] for index patterns [logs-*-*]
    [2024-01-02T23:04:50,129][INFO ][o.e.c.m.MetadataIndexTemplateService] [test-es-node01] adding index template [synthetics] for index patterns [synthetics-*-*]
    [2024-01-02T23:04:50,367][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [slm-history-ilm-policy]
    [2024-01-02T23:04:50,476][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [watch-history-ilm-policy-16]
    [2024-01-02T23:04:50,555][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [ilm-history-ilm-policy]
    [2024-01-02T23:04:50,648][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [.deprecation-indexing-ilm-policy]
    [2024-01-02T23:04:50,723][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [logs]
    [2024-01-02T23:04:50,797][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [synthetics]
    [2024-01-02T23:04:50,874][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [7-days-default]
    [2024-01-02T23:04:50,956][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [metrics]
    [2024-01-02T23:04:51,042][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [30-days-default]
    [2024-01-02T23:04:51,120][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [180-days-default]
    [2024-01-02T23:04:51,200][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [365-days-default]
    [2024-01-02T23:04:51,266][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [90-days-default]
    [2024-01-02T23:04:51,346][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [.monitoring-8-ilm-policy]
    [2024-01-02T23:04:51,423][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [ml-size-based-ilm-policy]
    [2024-01-02T23:04:51,519][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [test-es-node01] adding index lifecycle policy [.fleet-actions-results-ilm-policy]
    [2024-01-02T23:04:51,604][INFO ][o.e.c.m.MetadataCreateIndexService] [test-es-node01] [.geoip_databases] creating index, cause [auto(bulk api)], templates [], shards [1]/[0]
    [2024-01-02T23:04:52,147][INFO ][o.e.l.LicenseService     ] [test-es-node01] license [16948b03-9343-405a-ad35-7c0c316434bb] mode [basic] - valid
    [2024-01-02T23:04:52,230][INFO ][o.e.c.r.a.AllocationService] [test-es-node01] current.health="GREEN" message="Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[.geoip_databases][0]]])." previous.health="YELLOW" reason="shards started [[.geoip_databases][0]]"
    [2024-01-02T23:04:52,991][INFO ][o.e.i.g.GeoIpDownloader  ] [test-es-node01] successfully downloaded geoip database [GeoLite2-ASN.mmdb]
    [2024-01-02T23:04:53,103][INFO ][o.e.i.g.DatabaseNodeService] [test-es-node01] successfully loaded geoip database file [GeoLite2-ASN.mmdb]
    [2024-01-02T23:04:56,196][INFO ][o.e.i.g.GeoIpDownloader  ] [test-es-node01] successfully downloaded geoip database [GeoLite2-City.mmdb]
    [2024-01-02T23:04:57,669][INFO ][o.e.i.g.GeoIpDownloader  ] [test-es-node01] successfully downloaded geoip database [GeoLite2-Country.mmdb]
    [2024-01-02T23:04:57,720][INFO ][o.e.i.g.DatabaseNodeService] [test-es-node01] successfully loaded geoip database file [GeoLite2-City.mmdb]
    [2024-01-02T23:04:57,751][INFO ][o.e.i.g.DatabaseNodeService] [test-es-node01] successfully loaded geoip database file [GeoLite2-Country.mmdb]
    ```
    
- `-d` 옵션: 데몬 형태로 실행
- `-p` 옵션: pid 파일을 남긴다.

- `data.logs`로 지정했던 디렉터리로 이동하여 로그 파일을 확인
    - `cluster.name`에 지정했던 값으로 로그 파일이 생성됨
    
    ```powershell
    jenny@M-N-KIMYOONHEE elasticsearch % cd logs
    jenny@M-N-KIMYOONHEE logs % ls -ltrh
    total 528
    -rw-r--r--  1 jenny  staff   2.2K  1  2 23:04 gc.log.00
    -rw-r--r--  1 jenny  staff   2.2K  1  2 23:04 gc.log.01
    -rw-r--r--  1 jenny  staff     0B  1  2 23:04 test-es_audit.json
    -rw-r--r--  1 jenny  staff     0B  1  2 23:04 test-es_deprecation.json
    -rw-r--r--  1 jenny  staff     0B  1  2 23:04 test-es_index_search_slowlog.json
    -rw-r--r--  1 jenny  staff     0B  1  2 23:04 test-es_index_indexing_slowlog.json
    -rw-r--r--  1 jenny  staff    37K  1  2 23:06 gc.log.02
    -rw-r--r--  1 jenny  staff   2.2K  1  2 23:49 gc.log.03
    -rw-r--r--  1 jenny  staff   2.2K  1  2 23:49 gc.log.04
    -rw-r--r--  1 jenny  staff   114K  1  2 23:49 test-es_server.json
    -rw-r--r--  1 jenny  staff    38K  1  2 23:49 test-es.log
    -rw-r--r--  1 jenny  staff    33K  1  2 23:51 gc.log
    jenny@M-N-KIMYOONHEE logs % tail -f test-es.log
    ...
    [2024-01-02T23:49:47,979][INFO ][o.e.i.g.DatabaseNodeService] [test-es-node01] successfully loaded geoip database file [GeoLite2-Country.mmdb]
    [2024-01-02T23:49:48,007][INFO ][o.e.i.g.DatabaseNodeService] [test-es-node01] successfully loaded geoip database file [GeoLite2-ASN.mmdb]
    [2024-01-02T23:49:48,529][INFO ][o.e.i.g.DatabaseNodeService] [test-es-node01] successfully loaded geoip database file [GeoLite2-City.mmdb]
    ```
    
    - 로그에서 started가 확인된다면 무사히 엘라서틱서치가 기동한 것

- REST API를 호출하여 응답이 잘 오는지 확인
    
    ```powershell
    jenny@M-N-KIMYOONHEE logs % curl -XGET http://localhost:9200
    {
      "name" : "test-es-node01",
      "cluster_name" : "test-es",
      "cluster_uuid" : "sYQIkTlQQba3YrHYtw71bg",
      "version" : {
        "number" : "8.4.2",
        "build_flavor" : "default",
        "build_type" : "tar",
        "build_hash" : "89f8c6d8429db93b816403ee75e5c270b43a940a",
        "build_date" : "2022-09-14T16:26:04.382547801Z",
        "build_snapshot" : false,
        "lucene_version" : "9.3.0",
        "minimum_wire_compatibility_version" : "7.17.0",
        "minimum_index_compatibility_version" : "7.0.0"
      },
      "tagline" : "You Know, for Search"
    }
    ```
    

## 엘라스틱서치 종료

---

- kill 명령어를 이용. pid 파일을 생성해 뒀다면 이를 이용할 수 있다.
    
    ```powershell
    jenny@M-N-KIMYOONHEE logs % kill -SIGTERM 70874
    
    $ kill -SIGTERM `cat elasticsearch.pid`
    ```
    

- 참고
    - [https://jackjeong.tistory.com/entry/Elasticsearch-엘라스틱서치-메모리2-왜-전체-시스템-메모리의-50를-남겨두어야-하는가](https://jackjeong.tistory.com/entry/Elasticsearch-%EC%97%98%EB%9D%BC%EC%8A%A4%ED%8B%B1%EC%84%9C%EC%B9%98-%EB%A9%94%EB%AA%A8%EB%A6%AC2-%EC%99%9C-%EC%A0%84%EC%B2%B4-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%9D%98-50%EB%A5%BC-%EB%82%A8%EA%B2%A8%EB%91%90%EC%96%B4%EC%95%BC-%ED%95%98%EB%8A%94%EA%B0%80)
