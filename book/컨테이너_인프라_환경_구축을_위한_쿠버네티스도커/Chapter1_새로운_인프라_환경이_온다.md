# Chapter 1. 새로운 인프라 환경이 온다

- 엔지니어가 개발 환경을 만들어 제공하면 사용자(주로 개발자)는 그에 맞는 도구를 모두 설치해야 했던 온프레미스 환경은 이제 고전적인 인프라 환경이 됐다.
- 이미 구성된 환경을 사용자가 필요에 따라 선택하고 조합해서 사용할 수 있게 제공되는 **서비스로서의 인프라 환경**(IaaS, Infrastructure as a Service)이 됐다.
- 인프라 환경이 빠르게 갖춰지는 만큼 소프트웨어도 빠르게 개발하고 적용되길 고대했다. 그래서 대두된 개발 방법론이 **애자일**(agile)
- 애자일 방법론의 시대에 맞춰 인프라는 또 한 번 변화하고 있다. 사용자가 요구하는 인프라를 즉각 제공하는 주요 기능은 유지하면서, 사용자마다 독립적인 환경에서 개발해도 모두 동일한 결과를 얻을 수 있고 개발된 소프트웨어의 성능을 보장하며 인프라의 가용 리소스를 최대한 확보할 수 있는 그런 인프라 환경 → 컨테이너 인프라 환경

# 1.1 컨테이너 인프라 환경이란

---

- 컨테이너 인프라 환경: 컨테이너를 중심으로 구성된 인프라 환경
- 컨테이너(container): 하나의 운영 체제 커널에서 다른 프로세스에 영향을 받지 않고 독립적으로 실행되는 프로세스 상태. 가상화 상태에서 동작하는 프로세스보다 가볍고 빠르게 동작한다.

## 1.1.1 모놀리식 아키텍처

---

- 모놀리식 아키텍처(monolithic architecture): 하나의 큰 목적이 있는 서비스 또는 애플리케이션에 여러 기능이 통합돼 있는 구조
    - 소프트웨어가 하나의 결합된 코드로 구성되기 때문에 초기 단계에서 설계하기 용이하며 개발이 좀 더 단순하고 코드 관리가 간편하다.
    - 그러나 서비스를 운영하는 과정에서 수정이 많을 경우, 어떤 서비스에서 이뤄진 수정이 연관된 다른 서비스에 영향을 미칠 가능성이 커진다.
    - 또한 서비스가 점점 성장해 기능이 추가될수록 처음에는 단순했던 서비스 간의 관계가 매우 복잡해질 수 있다.

- 보안이나 데이터베이스 접속과 같은 설정을 공통으로 사용하면서 서비스를 구현한다면 개발 속도는 매우 빠를 것이다.
- 하지만 웹툰 서비스의 사용량이 폭발적으로 증가해 서버를 증설해야 한다고 가정해 보자.
    - IaaS 덕분에 인프라를 증설하는 것은 어렵지 않다.
    - 그렇지만 웹툰 서비스의 사용량이 늘었다고 해서 다른 서비스가 포함된 애플리케이션까지 확장하는 것은 상당히 비효율적이다.
    - 게다가 특정 서비스를 수정하는 과정에서 예기치 못한 에러가 발생한다면 해당 서비스 외에 전체 서비스를 이용할 수 없는 상황이 생길 수도 있다.

## 1.1.2 마이크로서비스 아키텍처

---

- 마이크로서비스 아키텍처(MSA): 시스템 전체가 하나의 목적을 지향하는 바는 모놀리식 아키텍처와 동일하다.
    - 하지만 개별 기능을 하는 작은 서비스를 각각 개발해 연결하는 데서 그 차이를 보인다.
        - 보안, 인증 등과 관련된 기능이 독립된 서비스를 구성하고 있으며 다른 서비스들도 독립적으로 동작할 수 있는 완결된 구조이다.
    - 개발된 서비스를 재사용하기 쉽고, 향후 서비스가 변경됐을 때 다른 서비스에 영향을 미칠 가능성이 줄어들며 사용량의 변화에 따라 특정 서비스만 확장할 수 있다.
        
        → 사용자의 요구 사항에 따라 가용성을 즉각적으로 확보해야 하는 IaaS 환경에 적합하다.
        
    - 모놀리식 아키텍처보다 복잡도가 높으며 각 서비스가 서로 유기적으로 통신하는 구조로 설계되기 때문에 네트워크를 통한 호출 횟수가 증가해 성능에 영향을 줄 수 있다.

- 각 서비스는 API 게이트웨이와 REST API를 이용한 통신 방식으로 사용자(외부)의 요청을 전달한다.
- 서비스 개수는 고정된 것이 아니기 때문에 어떤 서비스가 등록돼 있는지 파악하기 위해 서비스 디스커버리를 사용한다.
- 수많은 서비스의 내부 통신을 이벤트로 일원화하고 이를 효과적으로 관리하기 위해 별도로 이벤트 버스를 서비스로 구성한다.

## 1.1.3 컨테이너 인프라 환경에 적합한 아키텍처

---

- 컨테이너 인프라 환경은 특히 마이크로서비스 아키텍처로 구현하기에 적합하다.
- 컨테이너 인프라 환경에서는 컨테이너를 서비스 단위로 포장해 손쉽게 배포하고 확장할 수 있다.
    - 컨테이너는 마이크로서비스 아키텍처의 서비스와 1:1로 완벽하게 대응하며, 이후 소개할 도구들을 이용하면 도입, 설계, 운용 비용이 감소하고 생산성이 향상된다.

# 1.2 컨테이너 인프라 환경을 지원하는 도구

---

- 컨테이너 인프라 환경 구성
    - 컨테이너
    - 컨테이너 관리
    - 개발환경 구성 및 배포 자동화
    - 모니터링

## 1.2.1 도커

---

- 도커(Docker): 컨테이너 환경에서 독립적으로 애플리케이션을 실행할 수 있도록 컨테이너를 만들고 관리하는 것을 도와주는 컨테이너 도구
    - 도커로 애플리케이션을 실행하면 운영 체제 환경에 관계없이 독립적인 환경에서 일관된 결과를 보장한다.

## 1.2.2 쿠버네티스

---

- 쿠버네티스(Kubernetes): 다수의 컨테이너(이 책에서는 도커)를 관리하는 데 사용한다.
    - 컨테이너의 자동 배포와 배포된 컨테이너에 대한 동작 보증, 부하에 따른 동적 확장 등의 기능을 제공한다.
    - 컨테이너 인프라를 기반으로, API 게이트웨이, 서비스 디스커버리, 이벤트 버스, 인증 및 결제 등의 다양한 서비스를 효율적으로 관리할 수 있는 환경을 제공하고 이를 내외부와 유연하게 연결해 준다.

## 1.2.3 젠킨스

---

- 젠킨스(Jenkins): 지속적 통합(CI)과 지속적 배포(CD)를 지원한다.
    - 지속적 통합과 지속적 배포는 개발한 프로그램의 빌드, 테스트, 패키지화, 배포 단계를 모두 자동화해 개발 단계를 표준화한다.
    - 개발된 코드의 빠른 적용과 효과적인 관리를 통해 개발 생산성을 높이는 데 초점이 맞춰져 있다.
        
        → 컨테이너 인프라 환경처럼 단일 기능을 빠르게 개발해 적용해야 하는 환경에 매우 적합한 도구
        

## 1.2.4 프로메테우스와 그라파나

---

- 프로메테우스(Prometheus)와 그라파나(Grafana): 모니터링을 위한 도구
    - 프로메테우스: 상태 데이터를 수집
    - 그라파나: 프로메테우스로 수집한 데이터를 관리자가 보기 좋게 시각화

# 1.3 새로운 인프라 환경의 시작

---

![1-8. 실습용 컨테이너 인프라 환경 구성](./image/1/Untitled.png)

1-8. 실습용 컨테이너 인프라 환경 구성
