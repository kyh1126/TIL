# Chapter 8. 데이터베이스 서버 준비하기

![8-1. 8장에서 만드는 리소스](./image/8/Untitled.png)

8-1. 8장에서 만드는 리소스

# 8.1 데이터베이스 서버란?

---

- **관계형 데이터베이스**(relational database) 특징
    - 참조 관계의 여러 테이블로 데이터 관리
    - SQL이라는 전용 질의 언어로 데이터 입출력 수행

- 웹 서비스를 구축할 때는 웹 서버로부터 질의를 받아 결과를 반환하는 **데이터베이스 서버**(database server)와 같은 구성을 많이 이용한다.

# 8.2 RDS

---

- EC2로 생성한 서버에 이 제품들을 설치해서 데이터베이스 서버로 제공 방법 문제
    - 데이터베이스 제품을 설치해야 한다.
    - EC2의 OS 자체를 관리해야 한다.(보안 대책 등)
    - 예측하지 못한 장애 발생에 대응할 준비를 해야한다.

- AWS에서는 **RDS**(Amazon Relational Database Service)라는 **매니지드 서비스**를 제공한다.
    - 앞에서 설명한 작업을 미리 수행한 사앹로 제공된다.
    - 사용자는 단지 이용할 제품이나 성능 등을 지정하기만 하면 간단하게 데이터베이스 서버를 구축할 수 있다.
    
    ![8-3. RDS 조작 범위](./image/8/Untitled%201.png)
    
    8-3. RDS 조작 범위
    

<aside>
💡 매니지드 서비스

- AWS **매니지드 서비스**(managed service): RDS와 같이 작동하는 서버나 OS를 의식하지 않고 필요한 서비스를 구축할 수 있는 시스템
    - 매니지드 서비스를 이용하면 고성능 서비스를 저렴하게 이용할 수 있다.
    - 적극적으로 이용을 검토하자.
</aside>

## 8.2.1 RDS 시스템

---

- RDS 구성
    - 데이터베이스 엔진
        - 실제로 데이터가 저장되거나 질의에 응답하는 데이터베이스 본체
        - 다양한 데이터베이스 제품을 데이터베이스 엔진으로 선택할 수 있다.
            
            → 데이터베이스 엔진은 성능을 높이거나 내결함성을 높이기 위해 내부적으로 여러 인스턴스로 구성된다.
            
    - 파라미터 그룹
        - 주로 데이터베이스 엔진 고유의 설정을 수행한다.
        - 사용하는 언어나 데이터베이스 튜닝을 설정할 수 있다.
    - 옵션 그룹
        - 주로 RDS 고유의 설정을 수행한다.
        - AWS를 이용한 데이터베이스 모니터링에 관한 설정 등을 수행할 수 있다.
    - 서브넷 그룹
        - 데이터베이스 서버를 여러 개의 가용 영역에 분선 배치할 때 이용되는 설저잉다.
        - 여러 데이터베이스 서버를 분산시켜 제공할 수 있는 서브넷들을 서브넷 그룹으로 설정한다.

# 8.3 데이터베이스 서버 생성 흐름

---

- 데이터베이스 서버 생성 순서
    1. 파라미터 그룹을 생성
        - MySQL 서버 본체가 제공하는 설정 항목
    2. 옵션 그룹을 생성
        - RDS와 관련한 추가 설정 항목
    3. 서브넷 그룹을 생성
        - 데이터베이스 서버를 생성할 서브넷 마스크를 정의
    4. 데이터베이스를 생성

# 8.4 파라미터 그룹 생성하기

---

- **파라미터 그룹**(parameter group): MySQL이 제공하는 데이터베이스 설정을 수행하는 영역으로 데이터베이스의 성능 개선, 사용 현황 파악, 기능 추가 등을 수행할 수 있다.
    - 사전 제공되는 기본 파라미터 그룹은 변경할 수 없다.
    
    → 반드시 새로운 파라미터 그룹을 생성해서 데이터베이스에 적용한다.
    

## 8.4.1 생성 내용

---

- 파라미터 그룹 설정 항목
    
    
    | 항목 | 값 | 설명 |
    | --- | --- | --- |
    | 파라미터 그룹 패밀리 | mysql8.0 | 이용할 데이터베이스 제품 |
    | 그룹 이름 | sample-db-pg | 파라미터 그룹을 식별하는 고유한 정보 |
    | 설명 | sample parameter group | 파라미터 그룹 설명 |

## 8.4.2 파라미터 그룹 생성 순서

---

- RDS 대시보드에서 '파라미터 그룹'을 선택해 화면을 열고 [파라미터 그룹 생성] 버튼을 클릭한다.
    
    ![8-5. 파라미터 그룹 생성 시작](./image/8/Untitled%202.png)
    
    8-5. 파라미터 그룹 생성 시작
    
    ![8-6. 파라미터 그룹 생성](./image/8/Untitled%203.png)
    
    8-6. 파라미터 그룹 생성
    
- MySQL 파라미터는 생성할 애플리케이션의 용도에 따라 다양한 설정 정책을 제공한다.
- 그러나 기본 설정만으로도 기본적인 작동은 하므로 기본 설정의 복사본을 이용한다.
    - **파라미터 그룹 패밀리**: 적용할 데이터베이스를 선택한다.
    - **유형**: 'DB Parameter Group', 'DB Parameter Cluster Group' 중 하나를 선택할 수 있다.
        - 여기에서는 데이터베이스 클러스터를 이용하지 않으므로 'DB Parameter Group'을 지정한다.
    - **그룹 이름**: 파라미터 그룹을 식별할 수 있는 고유한 이름을 붙인다.
    - **설명**: 생성할 파라미터 그룹에 관한 설명을 입력한다.

![Untitled](./image/8/Untitled%204.png)

# 8.5 옵션 그룹 생성하기

---

- **옵션 그룹**(option group)
    - 기본 옵션 그룹이 있지만 설정 항목을 변경할 수 없다.
    
    → 반드시 새로운 옵션 그룹을 생성하고 이를 데이터베이스에 적용한다.
    

## 8.5.1 생성 내용

---

- 옵션 그룹 설정 항목
    
    
    | 항목 | 값 | 설명 |
    | --- | --- | --- |
    | 그룹 이름 | sample-db-og | 옵션 그룹을 식별하는 고유한 정보 |
    | 설명 | sample option group | 옵션 그룹 설명 |
    | 엔진 | mysql | 데이터베이스 유형 |
    | 메이저 엔진 버전 | 8.0 | 데이터베이스 버전 |

## 8.5.2 옵션 그룹 생성 순서

---

- RDS 대시보드에서 '옵션 그룹'을 선택해 화면을 열고 [그룹 생성] 버튼을 클릭한다.
    
    ![8-7. 옵션 그룹 생성 시작](./image/8/Untitled%205.png)
    
    8-7. 옵션 그룹 생성 시작
    
    ![8-8. 옵션 그룹 생성](./image/8/Untitled%206.png)
    
    8-8. 옵션 그룹 생성
    
    ![Untitled](./image/8/Untitled%207.png)
    

# 8.6 서브넷 그룹 생성하기

---

- **서브넷 그룹**(subnet group)
    - EC2를 생성할 때는 서브넷을 직접 지정했다.
        - 그러나 RDS를 작성할 때는 서브넷 그룹을 지정하고 어떤 서브넷에 생성될지는 AWS에 일임한다.
    - RDS는 **멀티AZ**(multi AZ)라는 기능을 제공
        - 자동으로 여러 가용 영역에 데이터베이스를 작성하고 내결함성을 높일 수 있다.

## 8.6.1 생성 내용

---

- 서브넷 그룹 설정 항목
    
    
    | 항목 | 값 | 설명 |
    | --- | --- | --- |
    | 그룹 이름 | sample-db-subnet | 서브넷 그룹을 식별하는 고유한 정보 |
    | 설명 | sample db subnet | 서브넷 그룹을 설명 |
    | VPC | sample-vpc | 서브넷이 속한 VPC |
    | 가용 영역 | ap-northeast-2a | 서브넷이 속한 가용 영역 |
    |  | ap-northeast-2c |  |
    | 서브넷 | sample-subnet-private01 | 서브넷 그룹이 사용하는 서브넷 |
    |  | sample-subnet-private02 |  |

## 8.6.2 서브넷 그룹 생성 순서

---

- RDS 대시보드에서 '서브넷 그룹'을 선택해 화면을 열고 [DB 서브넷 그룹 생성] 버튼을 클릭한다.
    
    ![8-9. 서브넷 그룹 생성 시작](./image/8/Untitled%208.png)
    
    8-9. 서브넷 그룹 생성 시작
    
    ![8-12. 선택한 서브넷](./image/8/Untitled%209.png)
    
    8-12. 선택한 서브넷
    
    <aside>
    💡 퍼블릭 서브넷을 서브넷 그룹에 추가하면 외부에 공개된 서브넷에 직접 데이터베이스가 위치하게 되므로 보안상 문제가 발생할 가능성이 있다.
    
    → 기본적으로는 퍼블릭 서브넷을 서브넷 그룹에 추가하지 않는다.
    
    </aside>
    
    ![8-13. 생성된 서브넷 그룹](./image/8/Untitled%2010.png)
    
    8-13. 생성된 서브넷 그룹
    

# 8.7 데이터베이스 생성하기

---

## 8.7.1 생성 내용

---

- 데이터베이스 설정 항목
    
    
    | 항목 | 값 | 설명 |
    | --- | --- | --- |
    | 엔진 유형 | MySQL | 사용할 데이터베이스 제품 |
    | 템플릿 | 프리 티어 | 이후의 설정 템플릿 |
    | DB 인스턴스 식별자 | sample-db | 데이터베이스를 식별하는 고유한 정보 |
    | 마스터 사용자 이름 | admin | 데이터베이스 관리용 사용자 이름 |
    | 마스터 암호 | (임의의 긴 문자열) | 데이터베이스 사용자의 비밀번호 |
    | DB 인스턴스 클래스 | db.t2.micro | DB 인스턴스 크기 |
    | Virtual Private Cloud | sample-vpc | RDS를 작성할 VPC |
    | 서브넷 그룹 | sample-db-subnet | 사전에 생성한 서브넷 그룹 |
    | 퍼블릭 액세스 가능 | 없음 | VPC 외부에서의 액세스 허가 여부 |
    | 기존 VPC 보안 그룹 | default | VPC 내부로부터의 액세스에 쓰이는 보안 그룹 |
    | 데이터베이스 인증 옵션 | 비밀번호 인증 | 데이터베이스 인증 방법 |
    | 최초 데이터베이스 이름 | (공란) | 데이터베이스 인스턴스를 작성할 때 동시에 작성하는 데이터베이스 이름 (있는 경우) |
    | DB 파라미터 그룹 | sample-db-pg | 사전 생성한 데이터베이스 파라미터 그룹 |
    | 옵션 그룹 | sample-db-og | 사전 생성한 데이터베이스 옵션 그룹 |

## 8.7.2 데이터베이스 생성 순서

---

- RDS 대시보드에서 '데이터베이스' 화면을 열고 [데이터베이스 생성] 버튼을 클릭한다.
    
    ![8-14. 데이터베이스 생성 시작](./image/8/Untitled%2011.png)
    
    8-14. 데이터베이스 생성 시작
    
    1. 데이터베이스 생성 방법 선택
        - 데이터베이스 자체의 설정 항목은 아니다.
        - 카테고리에서 선택할 수 있는 항목이 달라진다.
    2. 엔진 옵션
        - 생성할 데이터베이스 엔진을 선택한다.
            - 에디션과 버전은 최신 버전이 기본 설정됨
        - Aurora MySQL: Amazon의 엔터프라이즈급 MySQL 호환 데이터베이스
            - 특징
                - MySQL Community Edition의 최대 5배 처리량
                - 최대 128TB의 오토 스케일링 SSD 스토리지
                - 3개 가용 영역에서 6중 복제
                - 복제 지연 시간이 10밀리초 미만인 최대 15개의 읽기 전용 복제본
                - 장애 조치가 포함된 자동 모니터링
        - MySQL: 세계에서 가장 널리 사용되는 오픈 소스 데이터베이스
            - MySQL on RDS는 MySQL 커뮤니티 에디션의 풍부한 기능과, 데이터베이스를 위한 컴퓨팅 리소스 또는 스토리지 용량을 쉽게 조정할 수 있는 유연성을 함께 제공한다.
            - 특징
                - 최대 64TiB의 데이터베이스 크기를 지원합니다.
                - 범용, 메모리 최적화 및 버스트 가능 성능 인스턴스 클래스를 지원합니다.
                - 자동 백업 및 시점 복구를 지원합니다.
                - 단일 리전 또는 5개의 읽기 전용 복제본 크로스 리전 내에서 인스턴스당 최대 15개의 읽기 전용 복제본을 지원합니다.
        
        ![8-16. 엔진 옵션](./image/8/Untitled%2012.png)
        
        8-16. 엔진 옵션
        
    3. 템플릿
        - 설정 템플릿을 지정한다. 데이터베이스 자체의 설정 항목은 아니다.
        - 이후 설정에 대한 기본값을 결정하거나, 선택할 수 있는 항목을 어느 정도 필터링할 수 있다.
    4. 설정
        - DB 인스턴스 식별자: 데이터베이스를 식별하는 고유한 이름
        - 마스터 사용자 이름: 데이터베이스를 관리하는 사용자의 이름
        - 마스터 암호: 마스터 사용자가 데이터베이스에 접속할 때 이용할 비밀번호
        
        ![8-18. 설정](./image/8/Untitled%2013.png)
        
        8-18. 설정
        
    5. DB 인스턴스 클래스
    6. 스토리지
        - 최대 스토리지 임곗값은 인프라 스트럭처의 비용을 고려한 뒤 상한값으로 설정하는 게 좋다.
        
        ![8-20. 스토리지](./image/8/Untitled%2014.png)
        
        8-20. 스토리지
        
    7. 가용성 및 내구성
        - RDS의 경우에는 **멀티 AZ**를 설정하면 하나의 데이터베이스를 여러 가용 영역에 배치해준다.
            - 단, 멀티 AZ를 선택하면 실제 가동할 데이터베이스와 만약의 경우를 위해 대기하는 데이터베이스 2개를 이용하게 되므로 비용 역시 거의 두 배가 되는 점에 주의한다.
        - '프리 티어'를 선택한 경우 멀티 AZ 배치를 선택할 수 없음
    8. 연결
        - **Virtual Private Cloud(VPC)**: 앞에서 생성한 서브넷 그룹을 필두로 올바른 값이 기본값으로 설정된다.
        - **기존 VPC 보안 그룹**: default를 선택해 VPC 안에서의 접근을 허가하도록 한다.
        
        ![8-22. 연결](./image/8/Untitled%2015.png)
        
        8-22. 연결
        
    9. 데이터베이스 인증
        - 데이터베이스 인증 카테고리를 설정한다.
        - **암호 인증**: 앞에서 생성한 마스터 사용자로 데이터베이스에 연결할 수 있다.
        - **암호 및 IAM 데이터베이스 인증**: 마스터 사용자 이외에 적절하게 권한을 부여한 IAM 사용자로 데이터베이스에 연결할 수 있다.
    10. 추가 구성
        - 파라미터 그룹과 옵션 그룹을 각각 지정한다.
        
        ![8-24. 추가 설정](./image/8/Untitled%2016.png)
        
        8-24. 추가 설정
        
        ![8-25. 데이터베이스 생성](./image/8/Untitled%2017.png)
        
        8-25. 데이터베이스 생성
        
        ![Untitled](./image/8/Untitled%2018.png)
        

# 8.8 작동 확인하기

---

- 올바르게 설정되었는지 확인하려면 실행 중인 데이터베이스 서버에 접속해본다.
    - 접속은 웹 서버에서 진행한다.
    - 웹 서버에 연결했다면 MySQL 명령어를 이용해 데이터베이스에 연결한다.

- MySQL 설치
    
    ```powershell
    Last login: Sun Dec 31 23:02:57 on console
    jenny@M-N-KIMYOONHEE ~ % ssh web01
    Last login: Thu Dec 28 13:48:01 2023 from 10.0.13.148
       ,     #_
       ~\_  ####_        Amazon Linux 2
      ~~  \_#####\
      ~~     \###|       AL2 End of Life is 2025-06-30.
      ~~       \#/ ___
       ~~       V~' '->
        ~~~         /    A newer version of Amazon Linux is available!
          ~~._.   _/
             _/ _/       Amazon Linux 2023, GA and supported until 2028-03-15.
           _/m/'           https://aws.amazon.com/linux/amazon-linux-2023/
    
    [ec2-user@ip-10-0-79-10 ~]$ sudo yum -y install mysql
    Loaded plugins: extras_suggestions, langpacks, priorities, update-motd
    amzn2-core                                               | 3.6 kB     00:00
    Resolving Dependencies
    --> Running transaction check
    ---> Package mariadb.x86_64 1:5.5.68-1.amzn2.0.1 will be installed
    --> Finished Dependency Resolution
    
    Dependencies Resolved
    
    ================================================================================
     Package       Arch         Version                      Repository        Size
    ================================================================================
    Installing:
     mariadb       x86_64       1:5.5.68-1.amzn2.0.1         amzn2-core       8.8 M
    
    Transaction Summary
    ================================================================================
    Install  1 Package
    
    Total download size: 8.8 M
    Installed size: 49 M
    Downloading packages:
    mariadb-5.5.68-1.amzn2.0.1.x86_64.rpm                      | 8.8 MB   00:00
    Running transaction check
    Running transaction test
    Transaction test succeeded
    Running transaction
      Installing : 1:mariadb-5.5.68-1.amzn2.0.1.x86_64                          1/1
      Verifying  : 1:mariadb-5.5.68-1.amzn2.0.1.x86_64                          1/1
    
    Installed:
      mariadb.x86_64 1:5.5.68-1.amzn2.0.1
    
    Complete!
    [ec2-user@ip-10-0-79-10 ~]$
    ```
    

- 연결 대상지 정보
    
    ![8-26. 인스턴스 화면의 '연결&보안' 탭](./image/8/Untitled%2019.png)
    
    8-26. 인스턴스 화면의 '연결&보안' 탭
    

- 다음과 같이 명령어를 실행했을 때 mysqld is alive가 표시되면 MySQL 데이터베이스에 성공적으로 연결한 것이다.
    
    ```powershell
    [ec2-user@ip-10-0-79-10 ~]$ mysqladmin ping -u admin -p -h sample-db.cho6icgou0ko.ap-northeast-2.rds.amazonaws.com
    Enter password:
    mysqld is alive
    [ec2-user@ip-10-0-79-10 ~]$
    ```
